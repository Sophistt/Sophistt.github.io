<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Stabilizability (Control Theory Learning 6)</title>
      <link href="/2021/01/28/stabilizability/"/>
      <url>/2021/01/28/stabilizability/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><img src= "/img/loading.gif" data-lazy-src="https://i.imgur.com/PVdVrp4.png" /></p>]]></content>
      
      
      <categories>
          
          <category> Study </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Control Theory </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Observability (Control Theory Learning 5)</title>
      <link href="/2021/01/28/observability/"/>
      <url>/2021/01/28/observability/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><img src= "/img/loading.gif" data-lazy-src="https://i.imgur.com/CRoKkeA.png" /></p>]]></content>
      
      
      <categories>
          
          <category> Study </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Control Theory </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Similar Matrix and Jordan Form (Control Theory Learning 2)</title>
      <link href="/2021/01/28/similar-matrix-and-jordan-form/"/>
      <url>/2021/01/28/similar-matrix-and-jordan-form/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><img src= "/img/loading.gif" data-lazy-src="https://i.imgur.com/ljGEu7O.png" /></p>]]></content>
      
      
      <categories>
          
          <category> Study </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Control Theory </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Stability (Control Theory Learning 3)</title>
      <link href="/2021/01/28/stability/"/>
      <url>/2021/01/28/stability/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><img src= "/img/loading.gif" data-lazy-src="https://i.imgur.com/bgHJhtt.png" /></p>]]></content>
      
      
      <categories>
          
          <category> Study </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Control Theory </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Controllability (Control Theory Learning 4)</title>
      <link href="/2021/01/28/controllability/"/>
      <url>/2021/01/28/controllability/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><img src= "/img/loading.gif" data-lazy-src="https://i.imgur.com/Cy3uh0G.png" /></p>]]></content>
      
      
      <categories>
          
          <category> Study </category>
          
      </categories>
      
      
        <tags>
            
            <tag> control theory </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Fundamental Concepts (Control Theory Learning 1)</title>
      <link href="/2021/01/28/control-theory-learning-1/"/>
      <url>/2021/01/28/control-theory-learning-1/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><h1 id="fundamental-concepts">Fundamental Concepts</h1><h2 id="state-space-model">State Space Model</h2><p>Given a system, we have various methods to define its properties, including <strong>State Space Model</strong>, <strong>Transfer function</strong>, <strong>Odinary differential equations</strong> and etc. Different description methods can be interchanged.</p><h3 id="example">Example</h3><p>Given a CT(<em>Continuous-time</em>) or DT(<em>Discrete-time</em>) system,</p><p><span class="math display">\[\begin{split}&amp;\dot{x}(t) = Ax(t) + Bu(t) \quad| \quad x(t+1) &amp;= Ax(t)+Bu(t) \\&amp; y(t) = Cx(t) + Du(t)   \quad |\quad \quad \quad y(t)&amp; = Cx(t)+Du(t)\end{split}\]</span></p><p>Their transfer functions are, <span class="math display">\[\begin{split}G(s) &amp; = C(sI-A)^{-1}B+D, \quad \mathbb{Laplace} \\G(z) &amp; = C(zI-A)^{-1}B+D, \quad \mathbb{z-transfrom}\end{split}\]</span> Notice that transfer fucntion descirbes properties of the sytem in frequency domain.</p><p>Details about state space model could be seen at this link: <a href="https://sophistt.github.io/2020/11/08/state-space-model/">State Space Model</a></p><h2 id="response-of-the-system">Response of the system</h2><p>Now we connect the system with their response in time domain. Given a sytem in state space model with their inital condition <span class="math inline">\(x_0\)</span> and input <span class="math inline">\(u(t)\)</span>. Their <strong>general response</strong> satisfy the following equations <span class="math display">\[\begin{split}y(t) &amp; = Ce^{At}x_0 + \int_0^tCe^{A(t-\tau)}Bu(\tau)d\tau+Du(\tau) \quad \mathbb{(CT)}\\y(t) &amp; = Ce^{At}x_0 + \Sigma_{i=0}^{t-1}CA^{t-1-i}Bu(i)+Du(t) \quad \mathbb{(DT)}\end{split}\]</span></p><h3 id="impulse-reponse">Impulse reponse</h3><p>Impulse reponse generally refers to the output of the system when the input is a unit pulse function. In other words, the initial condition of the sytem <span class="math inline">\(x_0=0\)</span> and input <span class="math inline">\(u(t)=\delta(t)\)</span>. <span class="math display">\[y(t) = Ce^{At}B+D\delta(t) \quad | \quad y(t)=CA^{t-1}B\]</span></p><h3 id="a-simple-method-to-compute-eat">A simple method to compute <span class="math inline">\(e^{At}\)</span></h3><p>Given a state space model, if we would like to know its response in time domain. It's needed to calculate <span class="math inline">\(e^{At}\)</span>. A simple method to calculate is computing <span class="math inline">\((sI-A)^{-1}\)</span> or <span class="math inline">\(z(zI-A)^{-1}\)</span> then use inverse Laplace or Z-transform.</p><h2 id="canonical-form">Canonical Form</h2><p>Given a transfer function <span class="math inline">\(G(s)\)</span>, we can use Canonical Form to derive its state space model. <span class="math display">\[\begin{split}G(s) &amp; = \frac{b_0s^n+b_1s^{n-1}+...+b_{n-1}s+b_n}{s^n+a_1s^{n-1}+...+a_{n-1}s+a_n} \\&amp; = b_0 + \frac{c_1s^{n-1}+...+c_{n-1}s+c_n}{s^n+a_1s^{n-1}+...+a_{n-1}s+a_n}\end{split}\]</span> with <span class="math inline">\(c_i=b_i-b_0a_i, i= 1, 2,..., n\)</span></p><p>Then we can get the controllability Canonical Form <span class="math display">\[\begin{split}A &amp;=\begin{bmatrix}0 &amp; 1 &amp; 0 &amp; ... &amp; 0\\0 &amp; 0 &amp; 1 &amp; ... &amp; 0 \\\vdots &amp; \vdots &amp; \vdots &amp; \vdots &amp; \vdots \\0 &amp; 0 &amp; 0 &amp; ... &amp; 1 \\-a_n &amp; -a_{n-1} &amp; -a_{n-2} &amp; ... &amp; -a_1\end{bmatrix} \quad&amp;B=\begin{bmatrix}0 \\ 0 \\ \vdots \\ 0 \\ 1\end{bmatrix} \\C &amp;= \begin{bmatrix}c_n  &amp; c_{n-1} &amp; ... &amp; c_2 &amp; c_1\end{bmatrix} \quad&amp;D  = [b_0]\end{split}\]</span></p>]]></content>
      
      
      <categories>
          
          <category> Study </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Control Theory </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>State Space Model</title>
      <link href="/2020/11/08/state-space-model/"/>
      <url>/2020/11/08/state-space-model/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p>Given an arbitrary system, we can use various methods to describe it such as <strong>Transfer Function</strong>, <strong>Differential Equations</strong> and <strong>State Space Model</strong>. Here we mainly foucos on <strong>State Space Model</strong> and solve following questions,</p><ul><li>What is State Space Model?</li><li>How to contruct the State Space Model of a specified plant?</li><li>How to convert State Space Model to other description methods like Transfer Function?</li></ul><h2 id="what-is-state-space-model">What is State Space Model?</h2><p>State space model (SSM) refers to a class of probabilistic graphical model (Koller and Friedman, 2009) that describes the probabilistic dependence between the latent state variable and the observed measurement. The state or the measurement can be either continuous or discrete.</p><h3 id="continuous-time-system">Continuous Time System</h3><p>Here we only discuss the simple case that the system is linear and time-invariant with <span class="math inline">\(p\)</span> inputs, <span class="math inline">\(q\)</span> outputs and <span class="math inline">\(n\)</span> state variables. The SSM of the plant is written in the following form,</p><p><span class="math display">\[\dot{x}(t) = Ax(t) + Bu(t) \\y(t) = Cx(t) + Du(t)\]</span></p><p>where,</p><ul><li><span class="math inline">\(x(\cdot)\)</span> is called the "state vector", <span class="math inline">\(x(t) \in \mathbb{R}^n\)</span>;</li><li><span class="math inline">\(y(\cdot )\)</span> is called the "output vector", <span class="math inline">\(y(t)\in \mathbb {R} ^{q}\)</span>;</li><li><span class="math inline">\(u(\cdot )\)</span> is called the "input (or control) vector", <span class="math inline">\(u(t)\in \mathbb {R} ^{p}\)</span>;</li><li><span class="math inline">\({A(\cdot )}\)</span> is the "state (or system) matrix", <span class="math inline">\(A(\cdot )=n\times n\)</span>,</li><li><span class="math inline">\({B(\cdot )}\)</span> is the "input matrix", <span class="math inline">\({B (\cdot )=n\times p}\)</span>,</li><li><span class="math inline">\({C(\cdot )}\)</span> is the "output matrix", <span class="math inline">\({C (\cdot )=q\times n}\)</span>,</li><li><span class="math inline">\({D(\cdot )}\)</span> is the "feedthrough (or feedforward) matrix" (in cases where the system model does not have a direct feedthrough, <span class="math inline">\({D(\cdot )}\)</span> is the zero matrix), <span class="math inline">\({\displaystyle \operatorname {dim} [\mathbf {D} (\cdot )]=q\times p}\)</span>,</li><li><span class="math inline">\(\dot{x}(t) = \frac{d}{dt}x(t)\)</span></li></ul><h3 id="discrete-time-system">Discrete Time System</h3><p>In discrete time system, we define similar equations in the following form,</p><p><span class="math display">\[x(t+1) = Ax(t) + Bu(t) \\y(t) = Cx(t) + Du(t)\]</span></p><h3 id="whats-the-meaning-of-such-parameters">What's the meaning of such parameters?</h3><p>Matrices <span class="math inline">\(A, B, C, D\)</span> have its own features and by analyzing them we can understand characteristic features of the plant.<br /></p><p>For example, matrix <span class="math inline">\(A\)</span> represents the stability of the system. If and only if all eigenvalues of <span class="math inline">\(A\)</span> have neagtive or zero real part and all <strong>Jordan blocks</strong> corresponding to eigenvalues with zero real part are <span class="math inline">\(1 \times 1\)</span>, the plant is <strong>Lyapunov Stable</strong>.</p><p>More detals about it will be discussed in next posts.</p><h2 id="how-to-construct-a-ssm-of-a-specified-plant">How to construct a SSM of a specified plant?</h2><p>Consider the classic mass-spring-damper system as shown below. Two motors apply forces <span class="math inline">\(F_1\)</span> and <span class="math inline">\(F_2\)</span> to the mass <span class="math inline">\(m_1\)</span> and <span class="math inline">\(m_2\)</span> respectively, resulting translations <span class="math inline">\(x_1\)</span> and <span class="math inline">\(x_2\)</span>,</p><p><a href="https://imgur.com/bO4WjRx" target="_blank" rel="noopener"><img src= "/img/loading.gif" data-lazy-src="https://i.imgur.com/bO4WjRx.png" title="source: imgur.com" /></a></p><h3 id="construct-differential-equations">Construct differential equations</h3><p>By analyzing the system, we get its differential equations in the following form,</p><p><span class="math display">\[m_2 \ddot{x}_2 + d(\dot{x}_2 - \dot{x}_1) + k(x_2 - x_1) = F_2 \\m_1 \ddot{x}_1 + d(\dot{x}_1 - \dot{x}_2) + k(x_1 - x_2) = F_1\]</span></p><h3 id="define-state-vecotr-xt">Define state vecotr <span class="math inline">\(x(t)\)</span></h3><div class="note info flat"><p>Definitions of <span class="math inline">\(x(t)\)</span> are not unique. Using different defitions bring different matrices <span class="math inline">\(A, B, C, D\)</span>.</p></div><p>Here we define,</p><p><span class="math display">\[X = \begin{bmatrix}x_1(t) \\ x_2(t) \\ x_3(t) \\ x_4(t) \end{bmatrix} = \begin{bmatrix}x_1 \\ \dot{x}_1 \\ x_2 \\ \dot{x}_2\end{bmatrix}, \quad\dot{X} = \begin{bmatrix}\dot{x}_1(t) \\ \dot{x}_2(t) \\ \dot{x}_3(t) \\ \dot{x}_4(t) \end{bmatrix} = \begin{bmatrix}x_2(t) \\ \ddot{x}_1 \\ x_4(t) \\ \ddot{x}_2\end{bmatrix}\]</span></p><h3 id="sort-out-differential-equations">Sort out differential equations</h3><p>from differential equations we get,</p><p><span class="math display">\[\ddot{x}_2 = \frac{1}{m_2} [F_2 - d(\dot{x}_2 - \dot{x}_1) - k(x_2 - x_1)] \\\ddot{x}_1 = \frac{1}{m_1} [F_1 - d(\dot{x}_1 - \dot{x}_2) - k(x_1 - x_2)] \]</span></p><h3 id="turn-into-matrix-form">Turn into matrix form</h3><p>Hence we get,</p><p><span class="math display">\[\dot{X}(t) = \begin{bmatrix}0 &amp; 1 &amp; 0 &amp; 0 \\-\frac{k}{m_1} &amp; -\frac{d}{m_1} &amp; \frac{k}{m_1} &amp; \frac{d}{m_1} \\0 &amp; 0 &amp;  0 &amp; 1 \\\frac{k}{m_2} &amp; \frac{d}{m_2} &amp; -\frac{k}{m_2} &amp; -\frac{d}{m_2}\end{bmatrix} X(t) + \begin{bmatrix}0 &amp; 0 \\\frac{1}{m_1} &amp; 0 \\0 &amp; 0 \\0 &amp; \frac{1}{m_2}\end{bmatrix} U(t) \\Y(t) = \begin{bmatrix}1 &amp; 0 &amp; 0 &amp; 0 \\0 &amp; 0 &amp; 1 &amp; 0\end{bmatrix} X(t) + \begin{bmatrix}0 &amp; 0 \\0 &amp; 0\end{bmatrix} U(t)\]</span></p><p>Note that <span class="math inline">\(U(t) = [F_1 \quad F_2]^\top\)</span></p><h2 id="how-to-convert-ssm-to-transfer-function">How to convert SSM to transfer function?</h2><p>For a specified plant, we have various SSM since we can define different state vectors. However, there only exists an unique transfer function <span class="math inline">\(G(s)\)</span>. Besides, if we get a SSM of a plant, we can easily find its tranfer function through the following equation,</p><h3 id="continuous-time-system-1">Continuous Time System</h3><p><span class="math display">\[G(s) = C(sI-A)^{-1}B+D\]</span></p><h3 id="discrete-time-system-1">Discrete Time System</h3><p><span class="math display">\[G(z) = C(zI-A)^{-1}B+D\]</span></p>]]></content>
      
      
      <categories>
          
          <category> Study </category>
          
      </categories>
      
      
        <tags>
            
            <tag> System &amp; Control </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Subspace, Null Space and Col Space in Linear Algebra</title>
      <link href="/2020/08/29/subspace-nullspace-colspace/"/>
      <url>/2020/08/29/subspace-nullspace-colspace/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><h2 id="subspace">subspace</h2><p>A subspace of a vector space <span class="math inline">\(V\)</span> is a subset <span class="math inline">\(H\)</span> of <span class="math inline">\(V\)</span> that has two properties.</p><ol type="1"><li><span class="math inline">\(H\)</span> is closed under vector addition. That is, for each <span class="math inline">\(u\)</span> and <span class="math inline">\(v\)</span> in <span class="math inline">\(H\)</span>, the sum <span class="math inline">\(u+v\)</span> is in <span class="math inline">\(H\)</span>.</li><li><span class="math inline">\(H\)</span> is closed under multiplication by scalars. That is, for each <span class="math inline">\(u\)</span> in <span class="math inline">\(H\)</span> and each scalar <span class="math inline">\(c\)</span>, the vector <span class="math inline">\(cu\)</span> is in <span class="math inline">\(H\)</span>.</li></ol><p><strong>Note</strong></p><p>In some materials, <span class="math inline">\(H\)</span> has the third property that <strong>The zero vector of</strong> <span class="math inline">\(V\)</span> <strong>is in</strong> <span class="math inline">\(H\)</span>. This property could be inclued in <strong>Property 2</strong> while <span class="math inline">\(c=0\)</span>.</p><p>For example,</p><ul><li><p>A line through the origin in <span class="math inline">\(R^2\)</span> is a subspace.</p></li><li><p>The <span class="math inline">\(xy\)</span>-plane in <span class="math inline">\(R^3\)</span> is a subspace.</p></li><li><p>The set of all polynomials <span class="math inline">\(P\)</span> is a subspace of <span class="math inline">\(C[0,1]\)</span>.</p></li></ul><h3 id="proof">Proof</h3><p>如何证明一个空间是subspace？</p><p>只需要根据定义，将该空间的向量 <span class="math inline">\(x, y\)</span> 代入两个条件验证即可。</p><h2 id="span">Span</h2><p>Span（线性生成空间）is the set of all linear combination of specialized vectors.</p><p>For example, <span class="math display">\[span(v_1, v_2, ... v_n) = \{ \sum_{i=1}^{n}\alpha_iv_i|\alpha_i \in \Re \} \]</span> Means span(<span class="math inline">\(v_1, v_2, ... v_n\)</span>) is generated / spanned by <span class="math inline">\(v_1, v_2, ... v_n\)</span>.</p><p><strong>Theorem</strong></p><p>span(<span class="math inline">\(v_1, v_2, ... v_n\)</span>) is a subspace of <span class="math inline">\(V\)</span>.</p><h2 id="null-space">Null space</h2><p>Given a matrix <span class="math inline">\(A \in \Re^{m \times n}\)</span>. The null space or kernel of <span class="math inline">\(A\)</span> is defined as <span class="math display">\[Nul A = Ker A = \{ x \in \Re^n | Ax = 0\}\]</span></p><h2 id="column-space">Column space</h2><p>Given a matrix <span class="math inline">\(A \in \Re^{m \times n}\)</span>. The column space or image of <span class="math inline">\(A\)</span> is defined as the set of all linear combination of the colums of <span class="math inline">\(A\)</span>. <span class="math display">\[col A = ImA=\{b \in \Re^m | b = Ax \quad \mathrm{for \quad some} \quad x \in \Re^n\}\]</span></p><h3 id="computation">Computation</h3><p>But how to compute the null space and column space of a speified matrix?</p><p>For example, <span class="math display">\[A = \begin{bmatrix}1 \quad 2 \quad 1 \quad 3 \quad 2 \\3 \quad 4 \quad 9 \quad 0 \quad 7 \\2 \quad 3 \quad 5 \quad 1 \quad 8 \\2 \quad 2 \quad 8 \quad -3 \quad 5 \end{bmatrix}\]</span> how to get <span class="math inline">\(Nul(A)\)</span> and <span class="math inline">\(Col(A)\)</span>?</p><p><strong>Answer</strong></p><p>Convert matrix <span class="math inline">\(A\)</span> to the row minimal matrix. The specific calculation process is omitted here. <span class="math display">\[A=&gt;\begin{bmatrix}1 \quad 0 \quad 7 \quad 0 \quad 85 \\0 \quad 1 \quad -3 \quad 0 \quad 31 \\0 \quad 0 \quad 0 \quad 1 \quad -7 \\\end{bmatrix}\]</span> We know that the <strong>pivot number</strong> represents the location of <strong>dependent variables</strong> and the remaining variables are called <strong>free variables</strong>. In this row minimal matrix, the pivot numbers are 1, 2, 4.（非零行的第一个非零元所在的位置）Hence we could get two basis of the vector space: <span class="math display">\[\xi_1 = \begin{bmatrix}x_1 \\y_1 \\0 \\z_1 \\1\end{bmatrix} \quad\xi_2 = \begin{bmatrix}x_2 \\y_2 \\1 \\z_2 \\0\end{bmatrix}\]</span> let <span class="math inline">\(A\xi_1 = 0\)</span> and <span class="math inline">\(A\xi_2 = 0\)</span>, we get the values of <span class="math inline">\(x, y, z\)</span> respectively. <span class="math display">\[\xi_1 = \begin{bmatrix}-85 \\-31 \\0 \\7 \\1\end{bmatrix} \quad\xi_2 = \begin{bmatrix}-7 \\3 \\1 \\0 \\0\end{bmatrix}\]</span> <strong>Null space</strong></p><p>Use the basis to represent null space <span class="math display">\[\mathrm{Nul}A = \mathrm{span}\{\xi_1, \xi_2\}\]</span> <strong>Column space</strong></p><p>After we get <strong>pivot number</strong>, we get the column space as well since column space consists of the column vectors of pivot number in <span class="math inline">\(A\)</span>. <span class="math display">\[\mathrm{Col}A=\mathrm{span}\{\begin{bmatrix}1 \\3 \\2 \\2 \end{bmatrix},\begin{bmatrix}2 \\4 \\3 \\2 \end{bmatrix},\begin{bmatrix}3 \\0 \\1 \\-3 \end{bmatrix}\}\]</span></p><h1 id="references">References</h1><ul><li><a href="https://www.q-math.com/?p=629" target="_blank" rel="noopener">如何快速写出方程组的解</a></li><li><a href="https://www.youtube.com/watch?v=KiRKulz0OGw&amp;feature=youtu.be" target="_blank" rel="noopener">线性代数复习（六）：子空间，零空间及列空间 subspace, null and column space</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Study </category>
          
          <category> Math </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linear-algebra </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>动态系统 (System Dynamics)</title>
      <link href="/2020/08/28/system-dynamics/"/>
      <url>/2020/08/28/system-dynamics/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p>System Dynamics 研究的究竟是什么？</p><p>与单纯的Dynamics（动力学）的含义不同，system dynamics 研究是的系统的动态特性，和 static system 相对应。要理解系统的动态特性，首先要从静态系统开始阐述。</p><h2 id="静态系统">静态系统</h2><p>以电路系统为例，如果电路仅为一个电阻<strong>R</strong>，那么在受到施加在该电阻上的电压<strong>V</strong>时，电路上瞬时产生电流<strong>I</strong>，并有熟知的公式 <span class="math display">\[I = \frac{V}{R}\]</span> 此简单的系统我们称之为静态系统，因为其变化是瞬时的，当电阻上的电压变化时，电流也随之变化。</p><h2 id="动态系统">动态系统</h2><p>假如在电路中引入动态元件电感器（或电容器），那么因为该元件的动态特性，当电路中的电源电压发生变化时，电路中的电流<strong>I</strong>将不是瞬时发生变化，而是有一个渐变的过程，该过程无法用简单的代数方程表示，而是需要用<strong>微分方程</strong>来表示： <span class="math display">\[L\frac{dI}{dt} + RI(t) = v(t)\]</span> 其中<span class="math inline">\(v(t)\)</span>随时间变化的电源电压。</p><p>因此，<strong>System Dynamics</strong>研究的就是系统的动态特性，系统的某个条件发生变化时，系统在瞬时的变化是怎么样的，最终会达到什么样的状态（稳态）。在现实生活里，基本所有的系统都有自己的动态特性，但是在研究某个系统的时候，如果不关心其动态特性，可以将其化简为静态系统。（<strong>只关心条件变化所带来的最终结果，不关心条件变化后从当前状态到达最终状态中间的过程变化。</strong>）</p><p><strong>举例</strong></p><p>以直流电机为例，当将其简化为静态系统时，其输出力矩随着电压的变化而瞬时变化。</p><p>但在实际应用上，施加在直流电机上的电压发生变化时，其输出力矩并不是瞬时发生变化的，从初始位置到达新的位置需要一段时间，且变化的过程中伴随着震荡。</p><h2 id="微分方程">微分方程</h2><p>当谈及动态系统的时候，一定涉及的概念便是微分方程，微分方程又可以分为<strong>free differential equtions</strong>和<strong>forced differential equations</strong>。</p><h3 id="free-differential-equations">Free differential equations</h3><p><span class="math display">\[m\ddot{x}+c\dot{x}+x=0\]</span></p><p>方程的微分方程的右边为0时即<strong>free differential equations</strong>。</p><p>该微分方程的通解为： <span class="math display">\[x(t)=e^{-{\delta}t}(Acosw_dt+Bsinw_dt)\]</span> 在此不讨论具体如何求解微分方程，只说明该通解中各部分的含义：</p><ul><li><span class="math inline">\({\delta}\)</span>: 系统稳定性的指标，当<span class="math inline">\(-{\delta}&lt;0\)</span>时，意味着系统是稳定的，因为随着时间<span class="math inline">\(t\)</span>的增加，<span class="math inline">\(e^-{\delta}t\)</span>越来越小</li><li><span class="math inline">\(\omega_d\)</span>：该指标代表系统在变化过程中震荡的频率</li></ul><h3 id="forced-differential-equaitons">Forced differential equaitons</h3><p><a href="https://imgur.com/1qJWpqV" target="_blank" rel="noopener"><img src= "/img/loading.gif" data-lazy-src="https://i.imgur.com/1qJWpqV.png" alt="from System Dynamics and Control: Module 3 - Mathematical Modeling Part I" /></a></p><p>可以看到，当方程组的右边不等于0时，该系统再是自由系统，因此需要使用<strong>Forced differential eqautions</strong>来描述。</p><p>此方程的解为： <span class="math display">\[x(t) = x_h(t) + x_p(t)\]</span> 其中</p><ul><li><span class="math inline">\(x_h(t)\)</span>是方程的通解，为<span class="math inline">\(m\ddot{x}+c\dot{x}+x=0\)</span>的解</li><li><span class="math inline">\(x_p(t)\)</span>是方程的特解，与<span class="math inline">\(F(t)\)</span>具有同样的形式</li></ul><p><strong>举例</strong></p><p>求解： <span class="math display">\[\ddot{x}+8\dot{x}+25x = 2t\]</span> 由原式可得： <span class="math display">\[\lambda^2+8\lambda=25=0\]</span> 因此，有： <span class="math display">\[\lambda_{1,2}=-4\pm3j\]</span> 所以有解的形式为： <span class="math display">\[x(t)=e^{-4t}(Acos3t+Bsin3t)+at+b\]</span> 这意味着，当通解的部分随解时间增加而逐渐消失后，特解的部分仍然在起作用（稳态结果）。</p><h1 id="references">References</h1><ul><li><a href="https://www.youtube.com/watch?v=vwso-xHLNGc&amp;t=1056s" target="_blank" rel="noopener">Systems Dynamics and Control: Module 2 - Introduction to Modeling</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Study </category>
          
      </categories>
      
      
        <tags>
            
            <tag> System &amp; Control </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>留学在荷兰所应该知道的事</title>
      <link href="/2020/08/23/things-to-be-known-while-studying-in-netherlands/"/>
      <url>/2020/08/23/things-to-be-known-while-studying-in-netherlands/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p>兜兜转转，最终还是在新冠的危机下选择离开最安全的祖国，来到荷兰这边留学。第一次独自离开中国，来到语言不同的地方，面临的不仅有学习上的困难，更多的是生活上的种种问题。在此做个总结，算是对自己打破舒适区的一个交待，也可以给后来人一些经验。</p><h1 id="预约签证">预约签证</h1><p>从学校拿到录取通知书以后，就可以在学校的<strong>OSIRIS</strong>系统上与学校进行确定，在把offer确定以后，预约签证的事情便可以同步开始进行了。</p><ul><li><p>等待学校的IND的邮件</p><p>荷兰的学校会帮忙在荷兰的<strong>Immigration and Naturalisation Service(IND)</strong>上申请学生过来的签证许可，等拿到该邮件的许可后便等可以在荷兰学习生活了。</p></li><li><p>带着IND的approval letter在荷兰驻中国大使馆上预约</p><p>学校邮件中会包含有IND的approval letter，该letter中包含有<strong>V-number</strong>，凭借此号码可以在<a href="https://www.netherlandsandyou.nl/travel-and-residence/visas-for-the-netherlands/applying-for-a-long-stay-visa-mvv" target="_blank" rel="noopener">大使馆网站</a>上预约MVV的签证了。预约签证后，在预定的时间内带上有效的护照，录取通知书，approval letter等有效材料去大使馆采集指纹与盖章即可。盖章后的护照会在最多14个工作日后通过快递送回。</p></li></ul><h1 id="安排住宿">安排住宿</h1><p>拿到签证后，就可以安排在荷兰留学期间的住宿了。荷兰这边对于学生的这类低收入群体在租房的时候有提供津贴，称为<strong>rental allowance</strong>。有<a href="https://housingallowance.nl/form/" target="_blank" rel="noopener">专门的网站</a>可以计算看到的房子可以申请的补贴的额度。</p><p>因为是在国内来选择，预定荷兰的房源，建议通过正规的网上平台来预定房子，预防钱财损失。租房是一个比较琐碎且看运气的事情，来到再搬也是可以的。</p><div class="note info flat"><p>这边在租房的时候需要注意房子是否能<strong>报地址</strong>，可以报地址的房就是已经在市政厅注册的合法房源，否则则是黑房。非法房源虽然便宜但是可能会被检查然后被要求搬离，所以建议还是选择合法房源。</p><p>同时rental allowance一般只提供给studio，如果只是租一个room的话是没法拿到津贴的。</p></div><p>荷兰常用的租房网站：</p><ul><li><a href="https://holland2stay.com" target="_blank" rel="noopener">H2S</a> 提供优质公寓，相对来说是比较好的选择</li><li><a href="https://www.vestide.nl" target="_blank" rel="noopener">Vestide</a> 在Eindhoven提供比较便宜的学生住宿</li></ul><h1 id="购买机票">购买机票</h1><p>购买机票可以在国内的代理商，如支付宝，美团等app上预定，也可以直接到各个航司的网站上注册账号然后购买机票。国内的著名航司有<strong>南方航空</strong>等，欧洲这边比较著名的航司为<strong>温莎航空</strong>。</p><p>购买机票的时候需要注意的事情是如果机票需要中转，那么机票是否为联程机票，如果是联程机票，在首程的时候即可打印所有登机牌，并且可以将行李直接托运到目的地。</p><p>国际航班与国内航班并无差别，流程大同小异</p><ul><li>值机打印登记牌</li><li>托运行李</li><li>通过安检到达候机区</li><li>登机</li></ul><h2 id="入境">入境</h2><p>如果目的地与转机的地方都属于<strong>申根国家</strong>，那么在申根国家落地的时候便可以检查签证然后入境，后续的转机就和国内的省内旅行一样不需要签证了。可惜这次因为疫情原因，在瑞士转机没法入境，所以在机场待了一天，在苏黎世机场有提供<strong>transit hotel</strong>可以过夜。</p><h1 id="抵达荷兰后的事情">抵达荷兰后的事情</h1><p>到达荷兰以后，很多东西都和国内不太一样，有几件事情是比较简单且比较重要的。</p><h2 id="购买电话卡">购买电话卡</h2><p>欧洲这边的流量套餐都比较贵，荷兰的几家老牌运营商为<strong>KPN</strong>，<strong>T-mobile</strong>，<strong>Vodafone</strong>，<strong>Tele2</strong>和<strong>Telfort</strong>，基本套餐价格为<strong>15-25欧/月</strong>。办理长期套餐根据运营商的不同可能需要<strong>BSN</strong>码，该码是在<strong>City Hall</strong>中注册才会拿到的。（下面会说明怎么注册。）</p><p>因此，<strong>Lebara</strong>卡是一个好选择，该卡直接购买即可激活使用，带有荷兰的电话号码，购买时不需要BSN码，在机场，火车站的一些地方甚至可以免费领取。在<strong>Albert Hejin</strong>购买则需要3欧元。此卡分为预充卡和套餐卡，预充卡就是充值一个月套餐到下个月，然后下个月再使用信用卡充值即可。（充值也方便，有专用的手机app可以充值）套餐有10欧，15欧的性价比比较高的套餐，缺点是信号没有老牌运营商的好，速度也不够快。</p><h3 id="lebara使用">Lebara使用</h3><ul><li><p>激活</p><p>插入SIM卡后，拨打<strong>1244</strong>根据语音提示选择喜欢的语言即可。</p></li><li><p>查账</p><p>拨打*<strong>100#</strong></p></li><li><p>选择流量套餐</p><p>初始套餐一般为50MB的流量，因此我们下载Lebara的app，然后在里面购买当月想要的流量套餐即可。一般为10欧=500min通话，2GB流量。</p></li></ul><h2 id="办理公交卡">办理公交卡</h2><p>荷兰的公交卡称为<strong>ov-chipkaart</strong>，荷兰出行必备。该卡也分为实名卡和匿名卡，实名卡的申请需要到<a href="https://www.ov-chipkaart.nl/home.htm#/" target="_blank" rel="noopener">官网</a>上填写资料申请，费用为7.5欧元，只能使用荷兰银行卡或者PayPal支付。</p><p>如果着急使用的话，也可以直接到火车站购买一张匿名卡即可。</p><h2 id="办理银行卡">办理银行卡</h2><p>荷兰这边银行也分为老牌银行和网络银行（和国内网上银行的含义不同）。</p><p>老牌银行和国内的中国银行蕾丝，这边的为<strong>Rabobank</strong>，<strong>ABN</strong>，<strong>ING</strong>。这几家银行各有优缺点：</p><ul><li>ING：学生党无需年费，网购比较方便</li><li>ABN：要交年费</li><li>Rabobank：学生无需年费，用户相对较少</li></ul><p>网络银行是没有实体店的银行，在收费方面会比老牌银行便宜，同时在信息的获取上也比老牌银行快，但是如果出了问题，就不像老牌银行那样有实体的门面可以去办理。比较出名的网络银行为<strong><a href="https://n26.com/en-eu" target="_blank" rel="noopener">N26</a></strong>, <strong><a href="https://www.bunq.com/" target="_blank" rel="noopener">bunq</a></strong>。</p><p>建议是大额的钱财还是放在老牌银行保管，小额消费钱财可以放在网络银行，出行时交易方便。</p><h2 id="市政厅注册">市政厅注册</h2><p>在荷兰居住超过3个月的人，需要主动到市政厅（<strong>City Hall</strong>）去注册。只有注册后才能拿到自己的<strong>BSN</strong>码，拿到该号码后注册<strong>DigiD</strong>，可以用于之后的申请补贴，延长签证等操作。</p><div class="note info flat"><p>荷兰高校会为国际学生提供一条龙注册服务，一次性解决市政厅注册，荷兰居留卡，学生卡，银行卡等重要事项。（学生党等学校安排即可）</p></div><p>注意在市政厅注册的时候，大部分城市都需要<strong>出生证</strong>（当时没有的话，没有后面再补也可以）。出生证仅有原件是没用的，需要在国内做<strong>双认证</strong>，具体流程可以查看<a href="https://zhuanlan.zhihu.com/p/36745118" target="_blank" rel="noopener">该知乎专栏</a>。</p><h2 id="注册家庭医生">注册家庭医生</h2><p>荷兰这边看病和国内直接到医院的不同，这边看病需要先找<strong>家庭医生</strong>。因此，到达荷兰之后注册家庭医生是非常重要的。（注册需要<strong>居住证</strong>和<strong>保险凭证</strong>）</p><h3 id="联系家庭医生">联系家庭医生</h3><p>学校一般会有固定的家庭医生，所以学生党可以通过学校来联系，同时也可以在Google Maps上搜索<strong>Huisarts</strong>或者在<a href="https://www.independer.nl/huisarts/intro.aspx" target="_blank" rel="noopener">家庭医生登记网站</a>上面输入邮编来寻找家庭医生。</p><h1 id="荷兰日常生活">荷兰日常生活</h1><p>荷兰的日常用语和官方语言都是荷兰语，所以到街上能看到的基本都是荷兰语，在很多时候还是不太方便的。当然，荷兰人的英语水平还是比国内好很多，所以碰到问题可以大胆的用英语问别人。</p><h2 id="超市">超市</h2><p>荷兰的超市和国内不一样，分工比较明确，所以很少像国内这种一个超市什么都卖，基本都是专门的超市卖一类的东西。（分工明确在这边方方面面都能体现。）下面是一些日常超市的分类：</p><ul><li><p>食品，厨房，厕所用品</p><p>Albert Hejin（荷兰连锁大超市），Jumbo（小型便利店）</p></li><li><p>居家用品，文具，日常杂物</p><p>HEMA，IKEA</p></li><li><p>电器</p><p>MediaMarkt</p></li><li><p>亚洲超市</p><p>Amazing Oriental（俗称东方行）</p></li></ul><h2 id="网购">网购</h2><p>荷兰的网购很方便，和超市一样，这边有很多不同的网购平台贩卖不同类型的产品。靠谱的网站有：</p><ul><li><a href="https://www.bol.com/nl/" target="_blank" rel="noopener">Bol</a></li><li><a href="https://www.ikea.com" target="_blank" rel="noopener">IKEA</a></li><li><a href="https://www.mediamarkt.nl" target="_blank" rel="noopener">MediaMarkt</a></li></ul><h2 id="垃圾分类">垃圾分类</h2><p>荷兰的实行严格的垃圾分类，不按照规定倾倒垃圾可能面临罚款。因此，无论是为了入乡随俗还是为了避免罚款，垃圾分类都是很重要的一项工作。在荷兰的垃圾分类可以分为<strong>纸质垃圾</strong>，<strong>有机垃圾</strong>，<strong>家庭垃圾</strong>，<strong>塑料垃圾</strong>，<strong>玻璃瓶</strong>和<strong>小型化学垃圾</strong>等，详细的介绍可以<a href="https://www.mijnafvalwijzer.nl/en/5612WN/197/" target="_blank" rel="noopener">此网站</a>上查看，这里做一些简单的说明。</p><p>在荷兰不同分类的垃圾需要放到不同的垃圾桶，同时有的城市还有自动垃圾处理系统，称为<strong>Underground container</strong>。</p><h3 id="paper-and-cardboard">Paper and Cardboard</h3><p>Paper and cardboard are collectedso that they can be recycled into, for example, newspaper, toilet paper, packaging materials, etc. A quarter of all household waste is made of paper and cardboard.</p><p>纸类垃圾可以放到<strong>underground container</strong>或者带有<strong>蓝色</strong>标示的垃圾桶里。</p><div class="note info flat"><p>在处理纸类垃圾的时候，不要用塑料袋包裹，可以用纸带捆好或者放进硬纸箱里。</p></div><h3 id="organic-waste">Organic waste</h3><p>Organic waste (GFT in Dutch) is vegetable, fruit and garden waste. This involves natural or organic waste such as fruit peels, vegetable leftovers, weeds and tea bags.</p><p>一般来说，organic waste和household waste需要分开存放，用<strong>grey cart</strong>装household waste，用<strong>green cart</strong>装有机垃圾。</p><p>但是，住在<strong>apartment</strong>的人例外，可以将有机垃圾与生活垃圾一起堆放，然后放入到<strong>underground container</strong>中，使用该系统需要垃圾卡<strong>citypass</strong>。</p><h3 id="household-waste">Household waste</h3><p>Household waste is waste that can not be separated for reuse or recycling like cigarettes, rubber and cork. Waste types that you can separate, such as organic waste, glass and paper, are not household waste.</p><h3 id="glass-waste">Glass waste</h3><p>Glass waste refers to glass packaging, such as an empty jar of peanut butter, pasta sauces, wine bottles and perfume bottles. Glass is 100% recyclable and therefore it is important to separate it from other waste. Large glass items and sheets of glass, such as window panes, qualify as waste and should be taken to one of the waste recycling points.</p><p>对于玻璃垃圾，会有一个专门的大垃圾箱进行回收处理，其标示为<strong>Glas</strong>，有时候还会将玻璃瓶根据颜色进行分类，分为<strong>无色</strong>，<strong>绿色</strong>和<strong>棕色</strong>。</p><h3 id="plastic-waste">Plastic waste</h3><p>Plastic waste refers to plastic packaging like empty bags, bags, bottles, cups and plastic covers. It does not include old toys, videotapes, broken garden chairs and other plastic items. This kind of plastic waste is classified as household waste (garden chairs and other large plastic items are bulky household waste).</p><p>塑料垃圾也有自己专门的处理箱，一般是橙色标示。</p><h3 id="垃圾箱查询">垃圾箱查询</h3><p>在荷兰，不同垃圾箱分布在不同的位置。为了方便的寻找自己附近的特定垃圾箱子，可以通过<a href="https://www.mijnafvalwijzer.nl" target="_blank" rel="noopener">该网站</a>进行查询，输入邮编即可。</p>]]></content>
      
      
      <categories>
          
          <category> Life </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Netherlands </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hexo 中 Mathjax 渲染出错问题解决</title>
      <link href="/2020/07/22/mathjax-render-error-in-hexo/"/>
      <url>/2020/07/22/mathjax-render-error-in-hexo/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><h1 id="问题">问题</h1><p>Hexo 在使用 Mathjax 渲染数学公式的时候，由于 Markdown 语法与 Mathjax 语法冲突的问题，可能会导致使用到<code>_</code>, <code>\</code> 符号的公式渲染出现错误。</p><h1 id="解决方法">解决方法</h1><p>有多种解决该问题的方法，但是不同的方法都有各自的优缺点，根据自己的需要选择合适的方法即可。</p><ol type="1"><li><p>修改源码</p><p>优点：部署简单，渲染的兼容性最好</p><p>缺点：修改源码可能引入额外的bug，不利于自动化部署</p></li><li><p>使用<code>pandoc</code>渲染引擎</p><p>优点：操作简单，可用于自动化部署</p><p>缺点：需要安装<code>pandoc</code>, 引入额外的开销，博客的部分格式需要注意</p></li></ol><h2 id="修改源码">修改源码</h2><h3 id="更换kramed渲染引擎">更换<code>kramed</code>渲染引擎</h3><p><code>hexo-renderer-kramed</code>渲染引擎是基于<code>hexo-renderer-marked</code>引擎修改的，该引擎修复了一些<code>marked</code>引擎存在的bug，但是仍然无法完美的渲染数学公式。 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm uninstall hexo-renderer-marked --save<br>npm install hexo-renderer-kramed --save<br></code></pre></td></tr></table></figure></p><h3 id="修改kramed引擎代码">修改<code>kramed</code>引擎代码</h3><p>到博客根目录下，找到<code>node_modules/kramed/lib/rules/inline.js</code>文件，把第11行的<code>escape</code>值做出以下修改： <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">//  escape: /^\\([\\`*&#123;&#125;\[\]()#$+\-.!_&gt;])/,</span><br>  <span class="hljs-built_in">escape</span>: <span class="hljs-regexp">/^\\([`*\[\]()#$+\-.!_&gt;])/</span>,<br></code></pre></td></tr></table></figure> 在把第20行的<code>em</code>值做出相应的修改： <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">//  em: /^\b_((?:__|[\s\S])+?)_\b|^\*((?:\*\*|[\s\S])+?)\*(?!\*)/,</span><br>  em: <span class="hljs-regexp">/^\*((?:\*\*|[\s\S])+?)\*(?!\*)/</span>,<br></code></pre></td></tr></table></figure></p><h3 id="在配置文件中配置插件">在配置文件中配置插件</h3><p>在根目录下找到<code>_config.yml</code>文件，粘贴下列内容到里面： <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment">## Markdown Katex</span><br><span class="hljs-attr">kramed:</span><br>  <span class="hljs-attr">gfm:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">pedantic:</span> <span class="hljs-literal">false</span><br>  <span class="hljs-attr">sanitize:</span> <span class="hljs-literal">false</span><br>  <span class="hljs-attr">tables:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">breaks:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">smartLists:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">smartypants:</span> <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure></p><h2 id="更换pandoc作为渲染引擎">更换<code>pandoc</code>作为渲染引擎</h2><h3 id="安装pandoc">安装<code>pandoc</code></h3><p>不同的操作系统，在<code>pandoc</code><a href="https://pandoc.org/" target="_blank" rel="noopener">官网</a>提供了不同的安装包，建议下载<em>v2.0</em>以上的版本进行安装。下面以<code>ubuntu</code>64位为例：</p><p>下载链接：<a href="https://github.com/jgm/pandoc/releases/download/2.10/pandoc-2.10-1-amd64.deb" target="_blank" rel="noopener">https://github.com/jgm/pandoc/releases/download/2.10/pandoc-2.10-1-amd64.deb</a></p><p>下载完毕后在终端中输入以下命令安装<code>pandoc</code> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo dpkg -i pandoc*<br></code></pre></td></tr></table></figure> 安装完毕后，可以测试<code>pandoc</code>是否运行正常 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">pandoc --version<br></code></pre></td></tr></table></figure></p><h3 id="更换渲染引擎">更换渲染引擎</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm uninstall hexo-renderer-marked --save<br>npm install hexo-renderer-pandoc --save<br></code></pre></td></tr></table></figure><div class="note info flat"><p>如果已经安装了<code>hexo-renderer-kramed</code>，建议将其也同时卸载，只保留<code>hexo-renderer-pandoc</code>。</p></div><h3 id="自动化部署">自动化部署</h3><p>在<strong>Github Actions</strong>中也可以利用<code>pandoc</code>作为渲染引擎，在<code>main.yml</code>文件中加入以下代码即可： <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">steps:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">安装pandoc</span><br>    <span class="hljs-attr">run:</span> <span class="hljs-string">|</span><br>        <span class="hljs-string">wget</span> <span class="hljs-string">https://github.com/jgm/pandoc/releases/download/2.7/pandoc-2.7-1-amd64.deb</span><br>        <span class="hljs-string">sudo</span> <span class="hljs-string">dpkg</span> <span class="hljs-string">-i</span> <span class="hljs-string">./pandoc-2.7-1-amd64.deb</span><br>    <br>    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">安裝</span> <span class="hljs-string">Hexo</span> <span class="hljs-string">CI</span><br>    <span class="hljs-attr">run:</span> <span class="hljs-string">|</span><br>        <span class="hljs-string">export</span> <span class="hljs-string">TZ='Asia/Shanghai'</span><br>        <span class="hljs-string">npm</span> <span class="hljs-string">install</span> <span class="hljs-string">hexo-cli</span> <span class="hljs-string">-g</span> <span class="hljs-string">&amp;&amp;</span> <span class="hljs-string">npm</span> <span class="hljs-string">uninstall</span> <span class="hljs-string">hexo-renderer--marked</span> <span class="hljs-string">--save</span> <span class="hljs-string">&amp;&amp;</span> <span class="hljs-string">npm</span> <span class="hljs-string">install</span> <span class="hljs-string">hexo-renderer-pandoc</span> <span class="hljs-string">--save</span><br></code></pre></td></tr></table></figure> 完整的<code>main.yml</code>配置可以查看<a href="https://github.com/Sophistt/sophistt.github.io/blob/hexo/.github/workflows/main.yml" target="_blank" rel="noopener">main.yml</a>。</p><h1 id="参考">参考</h1><ul><li><a href="https://segmentfault.com/a/1190000007261752" target="_blank" rel="noopener">Hexo下mathjax的转义问题</a></li><li><a href="http://rennesong.com/2020/06/08/hexo-math-support-tuto/" target="_blank" rel="noopener">Hexo博客系统使用Mathjax渲染数学公式</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Frontend </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>(转载) 通过 Github Action 自动部署 Github pages</title>
      <link href="/2020/07/20/auto-deploy-github-pages-via-github-actions/"/>
      <url>/2020/07/20/auto-deploy-github-pages-via-github-actions/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><div class="note info flat"><p>转载自：<a href="https://jerryc.me/posts/74006f42/#Travis-CI" target="_blank" rel="noopener">通過 travis-ci 或者 GitHub Actions 自動化部署 GitHub Pages 和 Coding Pages</a></p></div><h1 id="github-actions">GitHub Actions</h1><p><code>GitHub Actions</code> 是 GitHub 於 2019 年底推出的自動化流程工具，它的功能很強大。而我們只需要用到它的構建。由於是 GitHub 自家的工具，我們無需再額外的註冊賬號，GitHub Actions 也集成在了 GitHub 界面上，我們只需點擊 <code>Actions</code> 進行創建。</p><h2 id="創建-actions">創建 Actions</h2><p>在 Hexo 目錄的倉庫，點擊 <code>Actions Tab</code>, 然後點擊 <code>Set up a workflow yourself</code></p><p>把以下代碼複製到代碼框去, 注意如果倉庫中使用到子模塊，則需要將<code>submodules</code>設置為<code>true</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">name:</span> <span class="hljs-string">自動部署</span> <span class="hljs-string">Hexo</span><br><br><span class="hljs-attr">on:</span><br>  <span class="hljs-attr">push:</span><br>    <span class="hljs-attr">branches:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-string">master</span><br><br><span class="hljs-attr">jobs:</span><br>  <span class="hljs-attr">build:</span><br>    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span><br>    <span class="hljs-attr">strategy:</span><br>      <span class="hljs-attr">matrix:</span><br>        <span class="hljs-attr">node-version:</span> <span class="hljs-string">[10.x]</span><br><br>    <span class="hljs-attr">steps:</span><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">開始運行</span><br>        <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v1</span><br>        <span class="hljs-attr">with:</span><br>          <span class="hljs-attr">submodules:</span> <span class="hljs-literal">true</span><br><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">設置</span> <span class="hljs-string">Node.js</span> <span class="hljs-string">$&#123;&#123;</span> <span class="hljs-string">matrix.node-version</span> <span class="hljs-string">&#125;&#125;</span><br>        <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/setup-node@v1</span><br>        <span class="hljs-attr">with:</span><br>          <span class="hljs-attr">node-version:</span> <span class="hljs-string">$&#123;&#123;</span> <span class="hljs-string">matrix.node-version</span> <span class="hljs-string">&#125;&#125;</span><br><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">安裝</span> <span class="hljs-string">Hexo</span> <span class="hljs-string">CI</span><br>        <span class="hljs-attr">run:</span> <span class="hljs-string">|</span><br>          <span class="hljs-string">export</span> <span class="hljs-string">TZ='Asia/Shanghai'</span><br>          <span class="hljs-string">npm</span> <span class="hljs-string">install</span> <span class="hljs-string">hexo-cli</span> <span class="hljs-string">-g</span><br><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">緩存</span><br>        <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/cache@v1</span><br>        <span class="hljs-attr">id:</span> <span class="hljs-string">cache-dependencies</span><br>        <span class="hljs-attr">with:</span><br>          <span class="hljs-attr">path:</span> <span class="hljs-string">node_modules</span><br>          <span class="hljs-attr">key:</span> <span class="hljs-string">$&#123;&#123;runner.OS&#125;&#125;-$&#123;&#123;hashFiles('**/package-lock.json')&#125;&#125;</span><br><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">安裝插件</span><br>        <span class="hljs-attr">if:</span> <span class="hljs-string">steps.cache-dependencies.outputs.cache-hit</span> <span class="hljs-string">!=</span> <span class="hljs-string">'true'</span><br>        <span class="hljs-attr">run:</span> <span class="hljs-string">|</span><br>          <span class="hljs-string">npm</span> <span class="hljs-string">install</span><br><br>      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">部署博客</span><br>        <span class="hljs-attr">run:</span> <span class="hljs-string">|</span><br>          <span class="hljs-string">hexo</span> <span class="hljs-string">clean</span> <span class="hljs-string">&amp;&amp;</span> <span class="hljs-string">hexo</span> <span class="hljs-string">g</span> <span class="hljs-string">&amp;&amp;</span> <span class="hljs-string">hexo</span> <span class="hljs-string">douban</span> <span class="hljs-string">&amp;&amp;</span> <span class="hljs-string">gulp</span><br>          <span class="hljs-string">cd</span> <span class="hljs-string">./public</span><br>          <span class="hljs-string">git</span> <span class="hljs-string">init</span><br>          <span class="hljs-string">git</span> <span class="hljs-string">config</span> <span class="hljs-string">user.name</span> <span class="hljs-string">"$<span class="hljs-template-variable">&#123;&#123;secrets.GIT_NAME&#125;&#125;</span>"</span><br>          <span class="hljs-string">git</span> <span class="hljs-string">config</span> <span class="hljs-string">user.email</span> <span class="hljs-string">"$<span class="hljs-template-variable">&#123;&#123;secrets.GIT_EMAIL&#125;&#125;</span>"</span><br>          <span class="hljs-string">git</span> <span class="hljs-string">add</span> <span class="hljs-string">.</span><br>          <span class="hljs-string">git</span> <span class="hljs-string">commit</span> <span class="hljs-string">-m</span> <span class="hljs-string">"Update"</span><br>          <span class="hljs-string">git</span> <span class="hljs-string">push</span> <span class="hljs-string">--force</span> <span class="hljs-string">--quiet</span> <span class="hljs-string">"https://$<span class="hljs-template-variable">&#123;&#123;secrets.GH_TOKEN&#125;&#125;</span>@$<span class="hljs-template-variable">&#123;&#123;secrets.GH_REF&#125;&#125;</span>"</span> <span class="hljs-string">master:master</span><br></code></pre></td></tr></table></figure><ul><li><code>on</code> 是要被監測的 <code>branch</code>, 等同 Travis-ci 的 <code>branches</code></li><li><code>GIT_NAME</code>, <code>GIT_EMAIL</code>, <code>GH_TOKEN</code>, <code>GH_REF</code> 均是爲了保密需要，需要在 <code>secrets</code> 進行額外設置的全局變量</li></ul><h2 id="設置隱私資料">設置隱私資料</h2><p>在 <code>Settings</code> 裏的 <code>Secrets</code> 裏設置全局變量</p><ul><li><code>GIT_NAME</code>: 用戶名</li><li><code>GIT_EMAIL</code>: 郵件</li><li><code>GH_REF</code>: 倉庫地址，以<code>.git</code>結尾</li><li><code>GH_TOKEN</code>: 在<code>Setting</code>-&gt;<code>Developer Setting</code>-&gt;<code>Personal access tokens</code>-&gt;<code>Generate new token</code>中申請一個<code>public_repo</code>的<code>token</code>即可</li></ul><h2 id="運行">運行</h2><p>現在你只要把 Hexo 的目錄推送到 GitHub 去，GitHub Actions 會自動監測到變化，然後進行編譯。</p><h1 id="參考">參考</h1><ul><li><a href="https://eallion.com/github-actions-hexo-ci/" target="_blank" rel="noopener">Github Actions 自動部署 Hexo 腳本</a></li><li><a href="https://github.com/Molunerfinn/hexo-theme-melody/blob/dev/.travis.demo.yml" target="_blank" rel="noopener">travis.demo by Molunerfinn</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Programming </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Git Submodules</title>
      <link href="/2020/07/20/git-submodules/"/>
      <url>/2020/07/20/git-submodules/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><h1 id="description">Description</h1><p>Sometimes we have to include other Git repositories which are thrid-party repositories into our own Git repository. Git <strong>sumodules</strong> allow us to get it and track changes in several repositories via a centeral one. The extra repositories could be located anypwhere in a parent Git repository's workspace and are configured through <code>.gitsubmodules</code> file located at the root of the parent repository.</p><h1 id="creating-a-submodule">Creating a submodule</h1><h2 id="add-a-submodule">Add a submodule</h2><ul><li><p>Clone a repository into the <strong>Local Folder</strong> as a submodule and initialize the submodule. <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">git add submodule add [URL to Git Repo] [Local Folder]<br>git submodule init<br></code></pre></td></tr></table></figure></p></li><li><p>Similarly, we could clone a specific branch of the repository: <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">git add submodule -b [Branch] [URL to Git Repo] [Local Folder]<br>git submodule init<br></code></pre></td></tr></table></figure></p></li></ul><p>After executing the above commands, the <code>.gitsubmodules</code> file that records the inforamtion about sub-repositories will created in the root of the parent repository.</p><h2 id="checkout-the-status-of-submodules">Checkout the status of submodules</h2><p>Use <code>git submodule</code> command to checkout the status of submoules, if <code>-</code> exists before the hash, it means this submodule is not initialized yet. <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">git submodule<br><br>e33f854d3f51f5ebd771a68da05ad0371a3c0570 assets (heads/master)<br>-x5kyt51ogia51f5ebd771a68da05ad0371a3c0570 static<br></code></pre></td></tr></table></figure></p><h2 id="update-submodules">Update submodules</h2><p>Use <code>git submodule update (--remote)</code> to pulls in new commits into the main repository and its submodules. <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git submodule update --remote<br></code></pre></td></tr></table></figure></p><h1 id="working-with-a-repository-with-submodules">Working with a repository with submodules</h1><p>There two ways to clone a repository with submodules:</p><h2 id="clone-repository-step-by-step">Clone repository step by step</h2><ol type="1"><li><p>clone the parent repository <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git <span class="hljs-built_in">clone</span> [URL to Parent Git Repo]<br></code></pre></td></tr></table></figure></p></li><li><p>Checkout the submodule status <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git submodule<br></code></pre></td></tr></table></figure></p></li><li><p>Initialize the submodule <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git submodule init<br></code></pre></td></tr></table></figure></p></li><li><p>Update the submodule <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git submodule update<br></code></pre></td></tr></table></figure></p></li></ol><h2 id="clone-repository-recursively">clone repository recursively</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git <span class="hljs-built_in">clone</span> --recursive [URL to Parent Git Repo]<br></code></pre></td></tr></table></figure><p>If you already have cloned a repository and now want to load it’s submodules you have to use submodule update. <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git submodule update --init --recursive<br></code></pre></td></tr></table></figure></p><h1 id="delete-submodules">Delete submodules</h1><p>In order to delete submodules correctly, we need to delete the folders manually.</p><ol type="1"><li><p>Delete the folder of submodules <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">git rm --cached [submodule]<br>rm -rf [submodule]<br></code></pre></td></tr></table></figure></p></li><li><p>Delete relevant configuration in <code>.gitsubmodules</code> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">[submodule <span class="hljs-string">"[submodule]"</span>]<br>    path = [submodule]<br>    url = [URL to Submodule Git Repo]<br></code></pre></td></tr></table></figure></p></li><li><p>Delete relevant configuration in <code>.git/config</code> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">[submodule <span class="hljs-string">"[submodule]"</span>]<br>    url = [URL to Submodule Git Repo]<br></code></pre></td></tr></table></figure></p></li><li><p>Delete files in <code>.git</code> folder <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">rm -rf .git/modules/[submodule]<br></code></pre></td></tr></table></figure></p></li></ol><h1 id="references">References</h1><ul><li><a href="https://www.vogella.com/tutorials/GitSubmodules/article.html" target="_blank" rel="noopener">Using submodules in Git - Tutorial</a></li><li><a href="https://www.jianshu.com/p/9000cd49822c" target="_blank" rel="noopener">Git submodule 子模块的管理和使用</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Programming </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Tutorial of Building Your Own Blog via Hexo</title>
      <link href="/2020/07/18/tutorial-of-building-your-own-blog-via-hexo/"/>
      <url>/2020/07/18/tutorial-of-building-your-own-blog-via-hexo/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><h1 id="install-dependencies">Install dependencies</h1><h2 id="install-nodejs-and-npm">Install Nodejs and npm</h2><p>In order to install <strong>hexo</strong>, <strong>Node.js</strong> and <strong>npm</strong> are required to be installed first.</p><ul><li><p>Ubuntu (install Node.js LTS - v12.x): <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl -sL https://deb.nodesource.com/setup_lts.x | sudo -E bash -<br>sudo apt-get install -y nodejs<br></code></pre></td></tr></table></figure></p></li><li><p>Windows: Download and install <strong>Node.js</strong> from its <a href="https://nodejs.org/zh-cn/" target="_blank" rel="noopener">offical website</a>.</p></li></ul><h2 id="install-hexo">Install Hexo</h2><p><strong>Hexo</strong> is a fast, simple &amp; powerful blog framework, powered by <strong>Node.js</strong>. <strong>Hexo</strong> can be installed easily by <strong>npm</strong>: <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm install hexo-cli -g<br></code></pre></td></tr></table></figure></p><div class="note info flat"><p><strong>npm</strong> will be installed automaticallly while <strong>Node.js</strong> being installed.</p></div><h1 id="build-the-blog">Build the blog</h1><h2 id="create-a-workspace">Create a workspace</h2><p>Workspace is an important folder where all your blog files are saved. <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">mkdir personal_web<br><span class="hljs-built_in">cd</span> personal_web<br></code></pre></td></tr></table></figure></p><h2 id="initialzie-the-blog">Initialzie the blog</h2><ul><li><p>New blog <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">hexo init<br>npm install<br></code></pre></td></tr></table></figure></p></li><li><p>Existing blog <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">git <span class="hljs-built_in">clone</span> https://path.to.your.git<br>npm install<br></code></pre></td></tr></table></figure></p></li></ul><h2 id="local-debugging">Local debugging</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">hexo clean <span class="hljs-comment"># clean the workspace, delete database and the public folder</span><br>hexo g(generate)<br>hexo s(serve)<br></code></pre></td></tr></table></figure><p>After executing the command <code>hexo s</code>, we could open the local website through the browser by entering <a href="localhost:4000">lcoalhost:4000</a>.</p><h2 id="deploy">Deploy</h2><p><strong>Hexo</strong> provides a fast and convenient one-click deployment function, allowing you to deploy your website to the server with just one command. Before using the deploy command, <code>_config.yml</code> is required to modified. Use <strong>Github</strong> platform as an example: <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs plain">deploy:<br>  type: git<br>  repo: &lt;repository url&gt; #https:&#x2F;&#x2F;bitbucket.org&#x2F;Sophistt&#x2F;sophistt.github.io<br>  branch: [branch]<br>  message: [message]<br></code></pre></td></tr></table></figure></p><p>After modifying <code>_config.yml</code>, use the following commands to deploy your personal website to <strong>Github</strong> platform: <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">hexo clean  <span class="hljs-comment"># if something wrong happens to your website  </span><br>hexo g -d<br></code></pre></td></tr></table></figure></p><h1 id="tricks">Tricks</h1><p>The server and repository of <strong>npm</strong> are overseas, hence some unforeseen problems may occur while executing the command <code>npm install</code> because of unstable Internet connection. In order to resolve the problem, we could reset the proxy of <strong>npm</strong> or use domestic registry.</p><ul><li><p>reset the proxy <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm config <span class="hljs-built_in">set</span> proxy 127.0.0.1:port<br>npm config <span class="hljs-built_in">set</span> https-proxy 127.0.0.1:port<br></code></pre></td></tr></table></figure></p></li><li><p>use domestic registry <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm config <span class="hljs-built_in">set</span> registry https://registry.npm.taobao.org<br></code></pre></td></tr></table></figure></p></li></ul><h1 id="references">References</h1><ul><li><a href="https://github.com/nodesource/distributions" target="_blank" rel="noopener">nodesource</a></li><li><a href="https://juejin.im/post/5d8eeb2de51d4578200cc968" target="_blank" rel="noopener">npm install安装到一半卡住的解决方案</a></li><li><a href="https://hexo.io/zh-cn/docs/one-command-deployment.html" target="_blank" rel="noopener">部署|Hexo</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Frontend </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>File Handling (Python and C++)</title>
      <link href="/2020/07/06/file-handling/"/>
      <url>/2020/07/06/file-handling/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p>All functions to handle file are provdied by operating system. In modern operating system, common programs are forbidden to read and write disk direcctly. Hence, file handling is an operation which requests operating system to provide a file object and common programs operate files via handling the file object.</p><h1 id="python">Python</h1><h2 id="create-a-file-object">Create a File Object</h2><p>To create a file object, we need to use the built-in <code>open</code> function. The <code>open</code> function returns the file object that contains methods and attributes to perform various operations on the file.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">file_object = open(<span class="hljs-string">"filename"</span>, <span class="hljs-string">"mode"</span>)<br></code></pre></td></tr></table></figure><p>Here,</p><ul><li><strong>filename</strong>: gives name of the file that the file object has opened.</li><li><strong>mode</strong>: attribute of a file object tells you which mode a file was opened in.</li></ul><h2 id="read-a-file">Read a File</h2><p>Use the <code>open</code> function and gives the <code>r</code> attribute in <strong>mode</strong> as a flag, we could open a file in <em>read</em> mode. <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">f = open(<span class="hljs-string">"/Users/Carlos/test.txt"</span>, <span class="hljs-string">"r"</span>)<br></code></pre></td></tr></table></figure> Note that <code>open</code> function will throw an <code>IoError</code> if the file does not exist and print the detailed information about errors. <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">Traceback (most recent call last):<br>File <span class="hljs-string">"&lt;stdin&gt;"</span>, line <span class="hljs-number">1</span> <span class="hljs-keyword">in</span> &lt;module&gt;<br>FileNotFoundError: [Errno <span class="hljs-number">2</span>] No such file <span class="hljs-keyword">or</span> directory: <span class="hljs-string">'/Users/Carlos/test.txt'</span><br></code></pre></td></tr></table></figure> if open the file successfully, use <code>f.read</code> to read file datat and store it in variable content. <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">contents = f.read()<br></code></pre></td></tr></table></figure> Finally, use <code>f.close</code> to close the file and release system resources. Note that each file should be closed correctly after being operated. <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">f.close()<br></code></pre></td></tr></table></figure> However, if <code>IOError</code> occurs while reading or writing the file object, the following <code>f.close</code> function will not be called. In order to close the file correctly, using <code>with</code> syntax block to open an file could gurantee that <code>close</code> function will be called whatever happens: <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">with</span> open(<span class="hljs-string">'/Users/Carlos/test.txt'</span>, <span class="hljs-string">'r'</span>) <span class="hljs-keyword">as</span> f:<br>    contents = f.read()<br></code></pre></td></tr></table></figure></p><h3 id="read-a-file-line-by-line">Read a File line by line</h3><p>The <code>read</code> function may lead to memory leak since it will read and save all the contents of the file. Therefore, we could use another function <code>f.readlines()</code> or <code>f.read(size)</code> to read contents in fixed size. <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">with</span> open(<span class="hljs-string">'/User/Carlos/test.txt'</span>, <span class="hljs-string">'r'</span>) <span class="hljs-keyword">as</span> f:<br>    lines = f.readlines()<br>    <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> lines:<br>        print(line)<br></code></pre></td></tr></table></figure></p><h2 id="write-a-file">Write a File</h2><p>Use the same <code>open</code> function and gives the <code>w</code> attribute in <strong>mode</strong> as a flag, wec could opend a file in <em>write</em> mode. <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">f = open(<span class="hljs-string">'/Users/Carlos/test.txt'</span>, <span class="hljs-string">'w'</span>)<br></code></pre></td></tr></table></figure> After opening a file object, <code>f.write</code> function could be called repeatedly to write contents into the file. Note that the file object have been closed correctly through <code>f.close</code> function after all contents being written in it. <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">f.write(<span class="hljs-string">'Hello, world!'</span>)<br>f.close()<br></code></pre></td></tr></table></figure> <code>with</code> block also could be use in <code>w</code> mode: <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">with</span> open(<span class="hljs-string">'/User/Carlos/test.txt'</span>, <span class="hljs-string">'w'</span>) <span class="hljs-keyword">as</span> f:<br>    f.write(<span class="hljs-string">'Hello, world!'</span>)<br></code></pre></td></tr></table></figure></p><h2 id="append-data-to-a-file">Append Data to a File</h2><p>whatever we write will cover the existing contents in the file if we use <code>w</code> mode to open a file object. Hence we could use <code>a</code> mode to add a new text to the already existing file. <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">f = open(<span class="hljs-string">"/Users/Carlos/test.txt"</span>, <span class="hljs-string">"a+"</span>):<br>f.write(<span class="hljs-string">'Hello world!'</span>)<br>f.close()<br></code></pre></td></tr></table></figure></p><h2 id="files-modes-in-python">Files Modes in Python</h2><table><colgroup><col style="width: 29%" /><col style="width: 70%" /></colgroup><thead><tr class="header"><th style="text-align: center;">Mode</th><th style="text-align: center;">Description</th></tr></thead><tbody><tr class="odd"><td style="text-align: center;">'r'</td><td style="text-align: center;">This is the default mode. It opens file for reading.</td></tr><tr class="even"><td style="text-align: center;">'w'</td><td style="text-align: center;">This Mode opens file for writing <br> If file does not exist, it creates a new files. <br> If file exists it truncates the file.</td></tr><tr class="odd"><td style="text-align: center;">'x'</td><td style="text-align: center;">Creates a new file. If file already exists, the operation fails.</td></tr><tr class="even"><td style="text-align: center;">'a'</td><td style="text-align: center;">Open file in append mode. <br> if file does not exist, it creates a new file.</td></tr><tr class="odd"><td style="text-align: center;">'t'</td><td style="text-align: center;">This is the default mode. It opens in text mode.</td></tr><tr class="even"><td style="text-align: center;">'b'</td><td style="text-align: center;">This opens in binary mode.</td></tr><tr class="odd"><td style="text-align: center;">'+'</td><td style="text-align: center;">This will open a file for reading <strong>and</strong> writing.</td></tr></tbody></table><h1 id="c">C++</h1><h2 id="standard-library">Standard Library</h2><p>In C++, the <code>fstream</code> standard library allows us to work with files.</p><p>To use the <code>fstream</code> library, include both the standard <code>&lt;iostream&gt;</code> <strong>and</strong> the <code>&lt;fstream&gt;</code> header file:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;fstream&gt;</span></span><br></code></pre></td></tr></table></figure><h2 id="write-a-file-1">Write a File</h2><p>To create a file, use either the <code>ofstream</code> and <code>fstream</code> object, and specify the name of the file.</p><p>To write to the file, use the insertion operator (<code>&lt;&lt;</code>).</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;fstream&gt;</span></span><br><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;<br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-comment">// Create and open a text file</span><br>    <span class="hljs-function">ofstream <span class="hljs-title">MyFile</span><span class="hljs-params">(<span class="hljs-string">"filename.txt"</span>)</span></span>;<br><br>    <span class="hljs-comment">// Write to the file</span><br>    MyFile &lt;&lt; <span class="hljs-string">"Files can be tricky, but it is fun enough!"</span>;<br><br>    <span class="hljs-comment">// Close the file</span><br>    MyFile.<span class="hljs-built_in">close</span>();<br>&#125;<br></code></pre></td></tr></table></figure><div class="note info flat"><p>Close the file is a good practice, and it can clean up unnecessary memory space.</p></div><h2 id="read-a-file-1">Read a file</h2><p>To read from a file, use either the <code>ifstream</code> or <code>fstream</code> object, and the name of the file.</p><p>Note that we also use a <code>while</code> loop together with the <code>getline()</code> function or other functions.</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;fstream&gt;</span></span><br><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;<br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-comment">// Create a text string, which is used to output the text file</span><br>  <span class="hljs-built_in">string</span> myText;<br><br>  <span class="hljs-comment">// Read from the text file</span><br>  <span class="hljs-function">ifstream <span class="hljs-title">MyReadFile</span><span class="hljs-params">(<span class="hljs-string">"filename.txt"</span>)</span></span>;<br><br>  <span class="hljs-comment">// Use a while loop together with the getline() function to read the file line by line</span><br>  <span class="hljs-keyword">while</span> (getline (MyReadFile, myText)) &#123;<br>    <span class="hljs-comment">// Output the text from the file</span><br>    <span class="hljs-built_in">cout</span> &lt;&lt; myText;<br>  &#125;<br>  <span class="hljs-comment">// Close the file</span><br>  MyReadFile.<span class="hljs-built_in">close</span>();<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="references">References</h1><ul><li><a href="https://www.runoob.com/python/python-files-io.html" target="_blank" rel="noopener">Python 文件I/O</a></li><li><a href="https://www.guru99.com/reading-and-writing-files-in-python.html" target="_blank" rel="noopener">Python File Handling: Create, Open, Append, Read, Write</a></li><li><a href="https://www.w3schools.com/cpp/cpp_files.asp" target="_blank" rel="noopener">C++ Files</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Programming </category>
          
      </categories>
      
      
        <tags>
            
            <tag> fileIO </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Model Predictive Controller</title>
      <link href="/2020/05/15/model-predictive-controller/"/>
      <url>/2020/05/15/model-predictive-controller/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong>Model Predictive Control</strong> (MPC) is an advanced method of process control that is used to control a process while satisfying a set of constraints. It has been in use in the process industries in chemical plants and oil refineries since the 1980s. In recent years it has also been used in power system balancing models and in power electronics. Model predictive controllers rely on dynamic models of the process, most often linear empirical models obtained by system identification. The main advantage of MPC is the fact that it allows the current timeslot to be optimized, while keeping future timeslots in account. This is achieved by optimizing a finite time-horizon, but only implementing the current timeslot and then optimizing again, repeatedly, thus differing from Linear-Quadratic Regulator (LQR). Also MPC has the ability to anticipate future events and can take control actions accordingly. PID controllers do not have this predictive ability. MPC is nearly universally implemented as a digital control, although there is research into achieving faster response times with specially designed analog circuitry.</p><h1 id="state-matrix">State Matrix</h1><p>In order to use MPC, we have to model the plant by state variables. State variable models are basically time domain models where we are interested in the dynamics of some characterizing variables called state variables which along with the input represent the state of a system at a given time.</p><p>The general structure of a state-space model of a <span class="math inline">\(n^{th}\)</span> order continuous time dynamical system with <span class="math inline">\(m\)</span> input is given by:</p><p><span class="math display">\[\dot{x}(t) = Ax(t) + Bu(t) : \quad State \quad Equation \\y(t) = Cx(t) + Du(t)       : \quad Output \quad Equation\tag{1}\]</span></p><p>Where <span class="math inline">\(x(t)\)</span> is the <span class="math inline">\(n\)</span> dimensional state vector, <span class="math inline">\(u(t)\)</span> is the <span class="math inline">\(m\)</span> dimensional input vector, <span class="math inline">\(y(t)\)</span> is the <span class="math inline">\(p\)</span> dimensional output vector and <span class="math inline">\(A \in R^{n \times n}, B \in R^{n \times m}, C \in R^{p \times n}, D \in R^{p \times m}\)</span></p><h2 id="derivation">Derivation</h2><p>But how to get this <strong>State Matrix</strong> from differential equations? Consider a <span class="math inline">\(n^{th}\)</span> order differential equation,</p><p><span class="math display">\[\frac{d^ny}{dt^n} + a_1\frac{d^{n-1}y}{dt^{n-1}}+ ... + a_ny = u\]</span></p><p>Define following variables,</p><p><span class="math display">\[y  = x_1 \\\frac{dy}{dt}  = x_2 \\\vdots = \vdots \\\frac{d^{n-1}y}{dt^{n-1}} = x_n \\\frac{d^y}{dt^n} = -a_1x_{n-1} - a_2x_{n-2} - ... - a_nx_1 + u\]</span></p><p>The n^{th} order differential equation may be written in the form of <span class="math inline">\(n\)</span> first order differential equation as,</p><p><span class="math display">\[\dot{x}_1 = x_2 \\\dot{x}_2 = x_3 \\\vdots = \vdots \\\dot{x_n} = -a_1x_{n-1} - a_2x_{n-2} - ... - a_nx_1 + u\]</span></p><p>or in matrix forms as,</p><p><span class="math display">\[\dot{x} = Ax + Bu\]</span></p><p>where</p><p><span class="math display">\[A = \begin{bmatrix}0 \quad 1 \quad 0 \quad ... \quad 0 \\0 \quad 0 \quad 1 \quad ... \quad 0 \\\vdots  \quad ... \quad \quad ... \quad \vdots \\0 \quad 0 \quad 0 \quad ... \quad 1\end{bmatrix} \quad B =\begin{bmatrix}0 \\0 \\\vdots \\1\end{bmatrix}\]</span></p><p>The output can be one of states or a combination of many states. Since <span class="math inline">\(y=x_1\)</span>,</p><p><span class="math display">\[y = [1 \quad 0 \quad ... \quad 0]x\]</span></p><h2 id="solution">Solution</h2><p>Solve the equation (1), we could get its solution as,</p><p><span class="math display">\[x(t) = e^{A(t-t_0)}x(t_0) + {\int}_{t_0}^t e^{A(t-\tau)}Bu(\tau)d\tau\]</span></p><p>where, <span class="math inline">\(e^{At}=\Phi(t)\)</span> is known as the state transition matrix and <span class="math inline">\(x(t_0)\)</span> is the intial state of the system.</p><h2 id="discretization">Discretization</h2><p>To be continued ...</p><h1 id="references">References</h1><ul><li><a href="url">name</a></li><li><a href="url">name</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Study </category>
          
          <category> Control Theory </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Use SNOPT as A ROS Service</title>
      <link href="/2020/05/08/use-snopt-as-ros-service/"/>
      <url>/2020/05/08/use-snopt-as-ros-service/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p>As a mathematical solver, SNOPT is good enough to solve optimization problems such as <strong>L</strong>inear-<strong>Q</strong>uadratic-<strong>R</strong>egulator and <strong>M</strong>odel-<strong>P</strong>redictive-<strong>C</strong>ontroller. In ROS framework, packing SNOPT as a service is an efficient method to get the optimized result. Here we will introduce the whole configuraiton and setting step by step.</p><h1 id="build-a-serverc">Build a Server(C++)</h1><p>In order to use SNOPT service, a server is required to receive the request and response the result.</p><div class="note info flat"><p>Actually, a specified <code>srv</code> file is also needed to transfer information in the interactive process. The tutorial that creates a <code>srv</code> file could be seen at <a href="https://sophistt.github.io/linux/2020/04/26/ros-services">this link</a>.</p></div><p>Here we will use the subroutines of snOptA in the book <em>User's Guide for SNOPT Version 7: Software for Large-Scale Nonlinear Programming</em> as the example to build the SNOPT server. The <code>srv</code> file is described as following: <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># snopt_msgs/SnoptCal</span><br><br>float64 c1<br>float64 c2<br>---<br>float64[] x<br></code></pre></td></tr></table></figure></p><h2 id="code">Code</h2><p>The full code of the server node could be seen at <a href="">this link</a>. Here we only describe some significant code blocks.</p><h3 id="head-file-and-static-variables">Head file and Static Variables</h3><p>In order to use <code>snOptA</code> class, a specified <strong>head file</strong> is required and we also need to define some static variables for <strong>Callback function</strong>. <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"snopt_msgs/SnoptCal.h"</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"snoptProblem.hpp"</span></span><br><br><span class="hljs-comment">// SNOPT Constraints and Variables</span><br><span class="hljs-keyword">static</span> snoptProblemA sp;<br><br><span class="hljs-keyword">static</span> <span class="hljs-keyword">double</span> c1, c2;<br><br><span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> n, neF, nS, nInf;<br><span class="hljs-keyword">static</span> <span class="hljs-keyword">double</span> sInf;<br><span class="hljs-keyword">static</span> <span class="hljs-keyword">double</span> *x, *xlow, *xupp, *xmul;<br><span class="hljs-keyword">static</span> <span class="hljs-keyword">double</span> *F, *Flow, *Fupp, *Fmul;<br><span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> *xstate, *Fstate;<br><span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span>    ObjRow;<br><span class="hljs-keyword">static</span> <span class="hljs-keyword">double</span> ObjAdd;<br><br><span class="hljs-keyword">const</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> Cold = <span class="hljs-number">0</span>, Basis = <span class="hljs-number">1</span>, Warm = <span class="hljs-number">2</span>;<br></code></pre></td></tr></table></figure></p><h3 id="main-function">main function</h3><p>In the <code>main</code> function, a ROS node and a ROS server are created. The snOptA problem is also initialized here with defining the constraints according to our own optimization problems. <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> **argv)</span></span><br><span class="hljs-function"></span>&#123;   <br>    <span class="hljs-comment">// Ros Node Init</span><br>    ros::init(argc, argv, <span class="hljs-string">"snopt_server"</span>);<br>    ros::NodeHandle nh;<br>    ros::ServiceServer service = nh.advertiseService(<span class="hljs-string">"snopt"</span>, snopt_callback);<br><br>    <span class="hljs-comment">// SNOPT Init</span><br>    sp.initialize(<span class="hljs-string">""</span>, <span class="hljs-number">1</span>);<br>    sp.setIntParameter(<span class="hljs-string">"Deriviative"</span>, <span class="hljs-number">0</span>);<br>    sp.setIntParameter(<span class="hljs-string">"Verify level"</span>, <span class="hljs-number">3</span>);<br><br>    <span class="hljs-comment">// SNOPT Variables and Constraints Init (n, neF, x, F)</span><br>    ... <br><br>    ros::spin();<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure></p><h3 id="callback-funtion-and-optimization-problem">Callback funtion and Optimization Problem</h3><p>Callback function is the most import part in the server. In this function, we need to update the state of SNOPT problem through <strong>request</strong> from the client and solve the optimization problem. At the end, return the solved result to the client through <code>srv</code>.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">snopt_callback</span><span class="hljs-params">(snopt_msgs::SnoptCal::Request &amp;req,</span></span><br><span class="hljs-function"><span class="hljs-params">    snopt_msgs::SnoptCal::Response $res)</span></span><br><span class="hljs-function"></span>&#123;<br>    c1 = req.c1;<br>    c2 = req.c2;<br>    <br>    <span class="hljs-comment">// Solve the optimization problem</span><br>    sp.solve(Cold, neF, n, objAdd, ObjRow, solveUsrf,<br>     xlow, xupp, Flow, Fupp,<br>     x, xstate, xmul, F, Fstate, Fmul,<br>     ns, nInf, sInf);<br><br>    res.x.clear();<br>    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; n; i++)<br>        res.x.pushback(x[i]);<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>The optimization problem has its own function prototype in <code>snoptProblem.hpp</code>, we use its prototype and define our own optimization problem in it.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">solveUsrf</span><span class="hljs-params">(<span class="hljs-keyword">int</span> *Status, <span class="hljs-keyword">int</span>   *n, <span class="hljs-keyword">double</span> x[],</span></span><br><span class="hljs-function"><span class="hljs-params">       <span class="hljs-keyword">int</span>  *needf, <span class="hljs-keyword">int</span> *neF, <span class="hljs-keyword">double</span> F[],</span></span><br><span class="hljs-function"><span class="hljs-params">       <span class="hljs-keyword">int</span>  *needG, <span class="hljs-keyword">int</span> *neG, <span class="hljs-keyword">double</span> G[],</span></span><br><span class="hljs-function"><span class="hljs-params">       <span class="hljs-keyword">char</span>    *cu, <span class="hljs-keyword">int</span> *lencu,</span></span><br><span class="hljs-function"><span class="hljs-params">       <span class="hljs-keyword">int</span>    iu[], <span class="hljs-keyword">int</span> *leniu,</span></span><br><span class="hljs-function"><span class="hljs-params">       <span class="hljs-keyword">double</span> ru[], <span class="hljs-keyword">int</span> *lenru)</span></span><br><span class="hljs-function"></span>&#123;<br>    F[<span class="hljs-number">0</span>] = x[<span class="hljs-number">1</span>];<br>    F[<span class="hljs-number">1</span>] = x[<span class="hljs-number">0</span>] * x[<span class="hljs-number">0</span>] + c1 * x[<span class="hljs-number">1</span>] * x[<span class="hljs-number">1</span>];<br>    F[<span class="hljs-number">2</span>] = (x[<span class="hljs-number">0</span>] - c2) * (x[<span class="hljs-number">0</span>] - c2) + x[<span class="hljs-number">1</span>] * x[<span class="hljs-number">1</span>];<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="build-a-clientc">Build a Client(C++)</h1><p>Compared to the server, the client node is more straightforward, which only need to send request to the server through <code>srv</code>. <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> **argv)</span></span><br><span class="hljs-function"></span>&#123;<br>    ros::init(argc, argv, <span class="hljs-string">"snopt_client"</span>);<br>    ros::NodeHandle nh;<br>    ros::ServiceClient client = nh.serviceclient&lt;snopt_msgs::SnoptCal&gt;(<span class="hljs-string">"snopt"</span>);<br><br>    <span class="hljs-comment">// Update request</span><br>    snopt_msgs::SnoptCal srv;<br>    srv.request.c1 = atoll(argv[<span class="hljs-number">1</span>]);<br>    srv.request.c2 = atoll(argv[<span class="hljs-number">2</span>]);<br>    <br>    <span class="hljs-comment">// Send request throgh client.call()</span><br>    <span class="hljs-keyword">if</span> ( client.call(srv) )<br>         ROS_INFO(<span class="hljs-string">"x[0]: %ld, x[1]: %ld"</span>, (<span class="hljs-keyword">long</span> <span class="hljs-keyword">int</span>)srv.response.x[<span class="hljs-number">0</span>], (<span class="hljs-keyword">long</span> <span class="hljs-keyword">int</span>)srv.response.x[<span class="hljs-number">1</span>]);<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure></p><h1 id="modify-the-cmakelists.txt">Modify the CMakeLists.txt</h1><p>To bulid and link the executable file successfully, the final step is modifying the <code>CMakeLists.txt</code> file. The example is showed as following:</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs cmake"><br><span class="hljs-keyword">cmake_minimum_required</span>(VERSION <span class="hljs-number">2.8</span>.<span class="hljs-number">3</span>)<br><span class="hljs-keyword">project</span>(snopt_service)<br><br><span class="hljs-comment">## Compile as C++11, supported in ROS Kinetic and newer</span><br><span class="hljs-keyword">add_compile_options</span>(-std=c++<span class="hljs-number">11</span>)<br><br><span class="hljs-comment">## Find catkin macros and libraries</span><br><span class="hljs-comment">## if COMPONENTS list like find_package(catkin REQUIRED COMPONENTS xyz)</span><br><span class="hljs-comment">## is used, also find other catkin packages</span><br><span class="hljs-keyword">find_package</span>(catkin REQUIRED COMPONENTS<br>  roscpp<br>  std_msgs<br>  snopt_msgs<br>)<br><br><span class="hljs-keyword">set</span>(SNOPT_DIR /path/to/SNOPT)<br><span class="hljs-keyword">set</span>(SNOPT_INCLUDE_DIR <span class="hljs-variable">$&#123;SNOPT_DIR&#125;</span>/<span class="hljs-keyword">include</span>)<br><br>catkin_package(<br>   INCLUDE_DIRS<br>   LIBRARIES<br>   CATKIN_DEPENDS<br>)<br><br><span class="hljs-keyword">include_directories</span>(<br>  <span class="hljs-keyword">include</span>/snopt_service<br>  message_runtime<br>  <span class="hljs-variable">$&#123;catkin_INCLUDE_DIRS&#125;</span><br>  <span class="hljs-variable">$&#123;SNOPT_INCLUDE_DIR&#125;</span><br>)<br><br><span class="hljs-keyword">find_library</span>(SNOPT_LIB1 libsnopt7_cpp.so <span class="hljs-variable">$&#123;SNOPT_DIR&#125;</span>/lib)<br><br><span class="hljs-comment"># Declare a C++ executable</span><br><span class="hljs-keyword">add_executable</span>(snopt_client src/snopt_client.cpp)<br><span class="hljs-keyword">target_link_libraries</span>(snopt_client <span class="hljs-variable">$&#123;catkin_LIBRARIES&#125;</span>)<br><span class="hljs-keyword">add_dependencies</span>(snopt_client snopt_msgs_generate_messages_cpp)<br><br><span class="hljs-keyword">add_executable</span>(snopt_server src/snopt_server.cpp)<br><span class="hljs-keyword">target_link_libraries</span>(snopt_server <span class="hljs-variable">$&#123;catkin_LIBRARIES&#125;</span> <span class="hljs-variable">$&#123;SNOPT_LIB1&#125;</span>)<br><span class="hljs-keyword">add_dependencies</span>(snopt_server snopt_msgs_generate_messages_cpp)<br></code></pre></td></tr></table></figure><h1 id="references">References</h1><ul><li><a href="https://web.stanford.edu/group/SOL/guides/sndoc7.pdf" target="_blank" rel="noopener">User's Guide for SNOPT Version 7: Software for Large-Scale Nonlinear Programming</a></li><li><a href="https://wiki.ros.org/roscpp/Overview/Services" target="_blank" rel="noopener">ROS Services</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Robot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Optimization </tag>
            
            <tag> ROS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linear-Quadratic-Regulator(LQR) Controller</title>
      <link href="/2020/05/02/lqr-controller-theory/"/>
      <url>/2020/05/02/lqr-controller-theory/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p>The theory of <strong>optimal control</strong> is concerned with <strong>operating a dynamic system at minimum cost</strong>. The case where the system dynamics are described by a set of linear differential equations and the cost is described by a quadratic function is called the LQ problem. One of the main results in the theory is that the solution is provided by the <strong>linear–quadratic regulator (LQR)</strong>, a feedback controller whose equations are given below.</p><h1 id="general-description">General Description</h1><div class="note info flat"><p><strong>From Wikipedia</strong> The settings of a (regulating) controller governing either a machine or process (like an airplane or chemical reactor) are found by using a mathematical algorithm that minimizes a cost function with weighting factors supplied by a human (engineer). The <strong>cost function is often defined as a sum of the deviations of key measurements, like altitude or process temperature, from their desired values.</strong> The algorithm thus finds those controller settings that minimize undesired deviations. The <strong>magnitude of the control action itself may also be included in the cost function.</strong> The LQR algorithm <font color="green">reduces the amount of work</font> done by the control systems engineer to optimize the controller. However, <strong>the engineer still needs to specify the cost function parameters, and compare the results with the specified design goals.</strong> Often this means that controller construction will be an iterative process in which the engineer judges the "optimal" controllers produced through simulation and then adjusts the parameters to produce a controller more consistent with design goals. The <strong>LQR algorithm is essentially an automated way of finding an appropriate state-feedback controller.</strong> As such, it is not uncommon for control engineers to prefer alternative methods, like full state feedback, also known as pole placement, in which there is a clearer relationship between controller parameters and controller behavior. <font color="red">Difficulty in finding the right weighting factors limits the application of the LQR based controller synthesis.</font></p></div><h2 id="method">Method</h2><p>Here only <strong>finite-horizon, discrete-time LQR problem</strong> will be discussed</p><h2 id="goal">Goal</h2><p>In this problem, the discrete-time linear system described by:</p><p><span class="math display">\[x_{k+1} = Ax_k + Bu_k\]</span></p><p>Its performance could be defined by the following cost function:</p><p><span class="math display">\[J = {\sum}^T_{t=1}(x^T_tQx_t + u^T_tRu_t + 2x^T_tNu_k)\]</span></p><p><em>This equation could be simplified by removing the last Gaussian Coefficient.:</em></p><p><span class="math display">\[J = {\sum}^T_{t=1}(x^T_tQx_t + u^T_tRu_t)\]</span></p><h2 id="solution">Solution</h2><p>But how to minimize the cost function <span class="math inline">\(J\)</span>? Algebraic Riccati equation provides a common method to resolve this problem, which is named <strong>DARE</strong> in discrete-time problem.</p><p>From terminal condition <span class="math inline">\(P_T=Q, P_t\)</span> is found iteratively backwards in time by the dynamic Riccati equation:</p><p><span class="math display">\[P_{t−1}=A^TP_tA − A^TP_tB(B^TP_tB+R)^{−1} B^T P_t A+Q\]</span></p><p>The steady-state characterization of <span class="math inline">\(P\)</span>, relevant for the infinite-horizon problem in which <span class="math inline">\(T\)</span> goes to infinity, can be found by iterating the dynamic equation repeatedly until it converges; then <span class="math inline">\(P\)</span> is characterized by removing the time subscripts from the dynamic equation.</p><p>The optimal control sequence minimizing the performance index is given by:</p><p><span class="math display">\[u_t^∗=−Kx_{t−1}\]</span></p><p>Where:</p><p><span class="math display">\[K=(R+B^T PB)^{−1} B^T PA\]</span></p><h2 id="conclusion">Conclusion</h2><p>Therefore, the whole process of LQR algorithm could be concluded as, 1. Set <span class="math inline">\(P_t\)</span> equal to <span class="math inline">\(Q\)</span> 2. Iterate <span class="math inline">\(P_t\)</span> through Algebraic Riccati equation 3. Terminate iteration of <span class="math inline">\(P\)</span> while <span class="math inline">\(P_{t−1} −P_t\)</span> is small enough and calculate feedback matrix <span class="math inline">\(K\)</span> 4. Calculate the optimal control signal <span class="math inline">\(u^∗\)</span> through <span class="math inline">\(K\)</span></p><h2 id="application">Application</h2><p><a href="https://zhuanlan.zhihu.com/p/72702387" target="_blank" rel="noopener">Analysis of Apollo control algorithm</a> In the field of autonomous driving, how to track the planning path well is a really core problem. Geometry algorithm such as <strong>Pure Pursuit Algorithm, Stanley Algorithm</strong> is only suitable for low-speed and simple conditions. In city working condition, modern advanced control theories such as <strong>Model Predictive Control</strong> and <strong>Linear-Quadratic Regulator control</strong> are more appropriate in these conditions.</p><p>Here we will discuss how to use LQR Algorithm to track the planning trajectory of self-driving vehicles.</p><div data-align="center"><p><img src= "/img/loading.gif" data-lazy-src="https://i.imgur.com/bcIh4nV.png" width="20%" alt="Path Tracking"/><br></p></div><p>If the state <span class="math inline">\(x=[s, \dot{s}, \theta, \dot{\theta}]\)</span> of the self-driving vehicle and the planned trajectory (black points) is known, the state of the vehicle in the soon future (showed as the red points) could be calculated through a sequence fo given control signals u according to the state model <span class="math inline">\(x_{t+1}=Ax_t+Bu_t.\)</span></p><p>We can use a quadratic cost function to evaluate the performance of the vehicle as followed,</p><p><span class="math display">\[J = \sum_{t=1}^T((x_t - x_t^*)^TQ(x_t-x_t^*) + u^T_tRu_t)\]</span></p><p>Where <span class="math inline">\(x_t^∗\)</span> represents the sequences of desired states in planned trajectory and <span class="math inline">\(x_t\)</span> represents the predicted points. We can minimize this objective by linearizing the dynamics around the target trajectory and applying LQR algorithm to the resulting linearized system. This optimization is done in an online fashion, each time a new control command will be calculated and sent to controller of the vehicle.</p><p>However, in the condition without considering the rate of vehicle's heading angle, the <strong>lateral deviation</strong> <span class="math inline">\(e\)</span> and <strong>heading deviation</strong> <span class="math inline">\(θ_e\)</span> are relevant to the curvature of the road. LQR algorithm can leads the system to the stable state, but it cannot eliminate the steady-state error from the curvature of the road. Therefore, <strong>a feedforward control signal</strong> <span class="math inline">\(δ_{ff}\)</span> is introduced to suppress the steady-state error. In simplified cases, <span class="math inline">\(δ_{ff}=arctan⁡(L ∗k)\)</span>, where <span class="math inline">\(L\)</span> is wheel base of the vehicle and k is the curvature of the road.</p><p>Therefore,</p><p><span class="math display">\[δ=δ_{fb}+δ_{ff}=−Kx_{t−1}+arctan⁡(L ∗k)\]</span></p><h1 id="bonus">Bonus</h1><p>But how to define the suitable matrices A, B, Q, R in different systems? The following gives detailed steps to define these matrices as an example. (from Apollo)</p><h2 id="example">Example</h2><p>In autonomous driving, LQR Controller can be used for lateral steering wheel control. Therefore, dynamic analysis is required to build a vehicle dynamic model.</p><h2 id="dynamic-analysis">Dynamic analysis</h2><p>Firstly, we should analyze the forces of vehicles.</p><div data-align="center"><p><img src= "/img/loading.gif" data-lazy-src="https://i.imgur.com/mlCMAbP.png" width="60%" alt="Vehicle Dynamics"/><br></p></div><p>As for lateral steering wheel control, we should pay more attention on <strong>lateral forces</strong>.</p><p>Analyze the forces on the front and read wheels of the vehicle,</p><p><span class="math display">\[ma_y=F_{yf}+F_{yr}    (1)\]</span></p><p>According to momenta balance of the vehicle,</p><p><span class="math display">\[I_z ψ ̈=l_f F_{yf}−l_r F_{yr}   (2)\]</span></p><p>In equations (1), (2), the car quality <span class="math inline">\(m\)</span>, monenta of inertia <span class="math inline">\(I_z\)</span>, distance from front or rear axle to center <span class="math inline">\(l_f\)</span>, <span class="math inline">\(l_r\)</span> are measurable. To resolve the equations, lateral acceleration <span class="math inline">\(a_y\)</span> and lateral forces <span class="math inline">\(F_{yf}\)</span>, <span class="math inline">\(F_{yr}\)</span> are needed.</p><p>Lateral acceleration <span class="math inline">\(a_y\)</span> can be decomposed into acceleration caused by lateral displacement and centripetal acceleration.</p><p><span class="math display">\[a_y=y ̈+V_x ψ ̇   (3)\]</span></p><p>Where <span class="math inline">\(y\)</span> is lateral displacement, <span class="math inline">\(ψ\)</span> is heading angle and <span class="math inline">\(V_x\)</span> is longitudinal speed.</p><p>Lateral forces <span class="math inline">\(F_{yf}\)</span> and <span class="math inline">\(F_{yr}\)</span> can be deduced by the below equations,</p><p><span class="math display">\[F_{yf}=2C_{af} (δ−θ_{Vf} )  (4) \\F_{yr}=2C_{ar} (−θ_{Vr})   (5)\]</span></p><p>Where <span class="math inline">\(C_{af}\)</span> and <span class="math inline">\(C_{ar}\)</span> are <strong>lateral stiffness</strong> of front and rear wheels respectively, <span class="math inline">\(δ\)</span> is front wheel angle and <span class="math inline">\(θ_{Vf}\)</span> and <span class="math inline">\(θ_{Vr}\)</span> are <strong>velocity deviation angle</strong> of front and rear wheels.</p><div data-align="center"><p><img src= "/img/loading.gif" data-lazy-src="https://i.imgur.com/f1tGIac.png" width="60%" /><br></p></div><p>From the image above, we can get the below equations,</p><p><span class="math display">\[tan⁡(θ_{Vf})=(V_y+l_f ψ ̇)/V_x  \\tan⁡(θ_{Vr})=(V_y−l_r ψ ̇)/V_x \]</span></p><p>In assumption of small angle,</p><p><span class="math display">\[θ_{Vf}=(V_y+l_f ψ ̇)/V_x  \\θ_{Vr}=(V_y−l_r ψ ̇)/V_x \]</span></p><p>Back to formula (1) and (2), we can get,</p><p><span class="math display">\[y ̈=a_y=−\frac{2C_{af}+2C_{ar}}{mV_x}y ̇+ (−V_x−\frac{2C_{af} l_f−2C_{ar} l_r}{mV_x} ψ ̇+ \frac{2C_{af}}{m} δ  (6)  \\ψ ̈=−\frac{2l_f C_{af}−2l_r C_{ar}}{I_z V_x}y ̇+ (−\frac{2l_f^2 C_{af}+2l_r^2 C_{ar}}{I_z V_x}) ψ ̇+ \frac{2l_f C_{af}}{I_z}  δ  (7)\]</span></p><p>To get the state space expression of vehicle motion, we introduce lateral error <span class="math inline">\(e_1\)</span> and heading angle error <span class="math inline">\(e_2\)</span>. Hence we get the below equations,</p><div data-align="center"><p><img src= "/img/loading.gif" data-lazy-src="https://i.imgur.com/0Qm7f1d.png" /><br></p></div><p>In the assumption of uniform motion, a further deduction is,</p><div data-align="center"><p><img src= "/img/loading.gif" data-lazy-src="https://i.imgur.com/wikvooY.png" /><br></p></div><p>Similarly,</p><div data-align="center"><p><img src= "/img/loading.gif" data-lazy-src="https://i.imgur.com/hqMxWKH.png" /><br></p></div><p>And back to the equations (6) and (7), we can get the equations based on <span class="math inline">\(e_1\)</span> and <span class="math inline">\(e_2\)</span>,</p><div data-align="center"><p><img src= "/img/loading.gif" data-lazy-src="https://i.imgur.com/E7lxHPm.png" /><br></p></div><p>Finally, change it to state space expression and we get the vehicle dynamics model expression.</p><div data-align="center"><p><img src= "/img/loading.gif" data-lazy-src="https://i.imgur.com/chncUWK.png" /><br></p></div><p>Set</p><div data-align="center"><p><img src= "/img/loading.gif" data-lazy-src="https://i.imgur.com/9ysTDUl.png" /><br></p></div><p>The final state expression is</p><p><span class="math display">\[\frac{dx}{dt} = Ax + Bu + C\]</span></p><p>In this equation, lateral stiffness of front wheel Caf and rear wheel <span class="math inline">\(C_{ar}\)</span>, car quality <span class="math inline">\(m\)</span>, momenta of inertia <span class="math inline">\(I_z\)</span>, distance from front or rear axle to center <span class="math inline">\(l_f\)</span>, <span class="math inline">\(l_r\)</span> are constant.</p><p>Lateral error <span class="math inline">\(e_1\)</span>, heading angle error <span class="math inline">\(e_2\)</span>, longitudinal speed <span class="math inline">\(V_x\)</span> and front wheel angle <span class="math inline">\(δ\)</span> are measurable.</p><p>In this way, the target trajectory can be tracked by the corresponding algorithm using this model by updating the value measured by sensors every calculation cycle.</p><h2 id="discretization">Discretization</h2><p>However, in practical applications, continuous model is not suitable in most cases. Hence we need a discrete model for calculation.</p><p><span class="math display">\[x((k+1)T)=A_D x(kT)+B_D u(kT)+C_D\]</span></p><p>Where,</p><p><span class="math display">\[A_D = \frac{e^{\frac{AT}{2}}}{e^{-\frac{AT}{2}}} = \frac{I + \frac{AT}{2}}{I - \frac{AT}{2}} = (I - \frac{AT}{2})^{-1}(I + \frac{AT}{2})  \\B_D = \int_0^T e ^{At}dtB = TB \\ C_D = TC\]</span></p><h1 id="references">References</h1><ul><li><a href="https://en.wikipedia.org/wiki/Linear%E2%80%93quadratic_regulator" target="_blank" rel="noopener">Linera-quadratic regulator</a></li><li><a href="https://zhuanlan.zhihu.com/p/72702387" target="_blank" rel="noopener">Apollo控制算法LQR分析（二）</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Study </category>
          
          <category> Control Theory </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ROS Services</title>
      <link href="/2020/04/26/ros-services/"/>
      <url>/2020/04/26/ros-services/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p>ROS Services are defined by <code>srv</code> files, which contains a request message and a response message. These are identical to the messages used with ROS Topics. <strong>roscpp</strong> converts these <code>srv</code> files into C++ source code and creates three classes that you need to be familiar with: services defitions, request messages and response messages.</p><h1 id="using-srv">Using srv</h1><p>Before creating a service server and service clients, the <code>srv</code> file is required. <code>srv</code> files are saved in the folder named <strong>srv</strong> in the same diretory as the folder named <strong>msg</strong>. We can create a messages package with <strong>msg</strong> and <strong>srv</strong> folders in it.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; <span class="hljs-built_in">cd</span> work_space/src<br>&gt;&gt; catkin_create_pkg tutorial_msgs<br>&gt;&gt; <span class="hljs-built_in">cd</span> tutorial_msgs<br>&gt;&gt; mkdir msg srv<br></code></pre></td></tr></table></figure><p>Then we should define our own <code>srv</code> file in the <strong>srv</strong> folder. The <code>srv</code> file need types of request messages and response messages respectively, using "---" to divide them.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; <span class="hljs-built_in">cd</span> srv<br>&gt;&gt; vim AddTwoInts.srv<br><br><span class="hljs-comment"># Add the following contents in AddTwoInts.srv </span><br>int64 a <br>int64 b<br>---<br>int64 sum<br></code></pre></td></tr></table></figure><p>There's one mroe step, though. We need to make sure that the <code>srv</code> file is turned into source code for C++, Python, and other languages. Open <code>package.xml</code> and uncomment two lines as follow:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">build_depend</span>&gt;</span>message_generation<span class="hljs-tag">&lt;/<span class="hljs-name">build_depend</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">exec_depend</span>&gt;</span>message_runtime<span class="hljs-tag">&lt;/<span class="hljs-name">exec_depend</span>&gt;</span><br></code></pre></td></tr></table></figure><p>As before, note that at build time, we need "message_generation", while at runtime, we only need "message_runtime". Besides, we also need to add <em>message_generation</em> dependency at <code>CMakeLists.txt</code>. (Despite its name, <em>message_generation</em> works for both <code>msg</code> and <code>srv</code>) Adding your <code>srv</code> file in <code>add_services_files</code> is also required.</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs cmake"><span class="hljs-keyword">find_package</span>(catkin REQUIRED COMPONENTS<br>roscpp<br>rospy<br>std_msgs<br>message_generation<br>)<br><br>add_services_files (<br>FILES<br>AddTwoInts.srv<br>)<br></code></pre></td></tr></table></figure><p>Similar to <code>msg</code> files, we need to add <code>generate_messages</code> in the <code>CMakeLists.txt</code>:</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs cmake">generate_messages(<br>DEPENDENCYIES<br>std_msgs<br>)<br></code></pre></td></tr></table></figure><p>After finish the above steps, now we can make a new <code>srv</code> by compiling the package:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; <span class="hljs-built_in">cd</span> work_space<br>&gt;&gt; catkin_make install<br></code></pre></td></tr></table></figure><h1 id="writing-a-simple-service-and-client-c">Writing a Simple Service and Client (C++)</h1><div class="note info flat"><p>Please make sure that you have followed the directions in the previous tutorial for creating the <code>AddTwoInts.srv</code> needed in the communication.</p></div><h2 id="writing-a-service-node">Writing a Service Node</h2><p>Here we'll create the service("add_two_ints_server") node which will receive two ints and return the sum. Create a new package and create the <code>src/add_two_ints_server.cpp</code> file in the folder, and then paste the following inside it.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"ros/ros.h"</span> </span><br><span class="hljs-comment">// tutorial_msgs is the package which the srv file locates in</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"tutorial_msgs/AddTwoInts.h"</span> </span><br><br><span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">add</span><span class="hljs-params">(tutorial_msgs::AddTwoInts::Request &amp;req,</span></span><br><span class="hljs-function"><span class="hljs-params"> tutorial_msgs::AddTwoInts::Response &amp;res)</span></span><br><span class="hljs-function"></span>&#123;<br>    res.sum = req.a + req.b;<br>    ROS_INFO(<span class="hljs-string">"request: x=%ld, y=%ld"</span>, (<span class="hljs-keyword">long</span> <span class="hljs-keyword">int</span>)req.a, (<span class="hljs-keyword">long</span> <span class="hljs-keyword">int</span>)req.b);<br>    ROS_INFO(<span class="hljs-string">"sending back response: [%ld]"</span>, (<span class="hljs-keyword">long</span> <span class="hljs-keyword">int</span>)res.sum);<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> **argv)</span> </span><br><span class="hljs-function"></span>&#123;<br>    ros::init(argc, argv, <span class="hljs-string">"add_two_ints_server"</span>);<br>    ros::NodeHandle n;<br><br>    ros::ServiceServer service = n.advertiseService(<span class="hljs-string">"add_two_ints"</span>, add);<br>    ROS_INFO(<span class="hljs-string">"Ready to add two ints."</span>);<br>    ros::spin();<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>The key is that we have to provdie a callback function with the operation needed inside it. In the routines above, <code>add</code> is the callback function and <code>res.sum = req.a + req.b</code> is the key operation.</p><h2 id="writing-a-client-node">Writing a Client Node</h2><p>Create the <code>src/add_two_ints_client.cpp</code> file:</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"ros/ros.h"</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"tutorial_msgs/AddTwoInts.h"</span></span><br><span class="hljs-meta">#incldue <span class="hljs-meta-string">&lt;cstdlib&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> **argv)</span></span><br><span class="hljs-function"></span>&#123;<br>    ros::init(argc, argv, <span class="hljs-string">"add_two_ints_client"</span>);<br>    <span class="hljs-keyword">if</span> (argc != <span class="hljs-number">3</span>)<br>    &#123;<br>        ROS_INFO(<span class="hljs-string">"usage: add_two_inits_client X Y"</span>);<br><span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>    &#125;<br><br>    ros::NodeHandle n;<br>    ros::ServiceClient client = n.serviceClient&lt;tutorial_msgs::AddTwoInts&gt;(<span class="hljs-string">"add_two_ints"</span>);<br><br>    tutorial_msgs::AddTwoInts srv;<br>    srv.request.a = atoll(argv[<span class="hljs-number">1</span>]);<br>    srv.request.b = atoll(argv[<span class="hljs-number">2</span>]);<br><br>    <span class="hljs-keyword">if</span> (client.call(srv)) <br>    &#123;<br>        ROS_INFO(<span class="hljs-string">"Sum: %ld"</span>, (<span class="hljs-keyword">long</span> <span class="hljs-keyword">int</span>)srv.response.sum);<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>        ROS_ERROR(<span class="hljs-string">"Failed to call service add_two_ints"</span>);<br><span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>Codes of client are simple. The key is that we create a <code>ros::ServiceClient</code> object for to call the service later on. The key is that we instantiate an autogenerated service class, and assign values into its request member. A service class contains two members, <code>request</code> and <code>response</code>. It also contains two definitions, <code>Request</code> and <code>Reponse</code>.</p><p><code>client.call(srv)</code> actually calls teh service. If the service call succeeded, <code>call()</code> will return <code>true</code> and the value in <code>srv.response</code> will be valid. otherwise, <code>call()</code> will return <code>false</code> and the value in <code>srv.response</code> will be invalid if the call did not succeed.</p><h2 id="building-nodes">Building nodes</h2><p>Finally, edit the <code>CMakeLists.txt</code> in the package to compile and link codes. Add the following within <code>CMakeLists.txt</code>:</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs cmake"><span class="hljs-keyword">add_executable</span>(add_two_ints_server src/add_two_ints_server.cpp)<br><span class="hljs-keyword">target_link_libraries</span>(add_two_ints_server <span class="hljs-variable">$&#123;catkin_LIBRARIES&#125;</span>)<br><span class="hljs-keyword">add_dependencies</span>(add_two_ints_server tutorial_msgs_gencpp)<br><br><span class="hljs-keyword">add_executable</span>(add_two_ints_client src/add_two_ints_client.cpp)<br><span class="hljs-keyword">target_link_libraries</span>(add_two_ints_client <span class="hljs-variable">$&#123;catkin_LIBRARIES&#125;</span>)<br><span class="hljs-keyword">add_dependencies</span>(add_two_ints_client tutorial_msgs_gencpp)<br></code></pre></td></tr></table></figure><p>Now run <code>catkin_make</code> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; <span class="hljs-built_in">cd</span> work_space<br>&gt;&gt; catkin_make<br></code></pre></td></tr></table></figure></p><h1 id="appendix">Appendix</h1><p>Sometimes error occurs when we compile multiple packages because interdependence. To solve the problem, editing <code>package.xml</code> to clear the dependency of each package is a good habit. Besides, the command of compiling a single package is also useful here. <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; catkin_make -DCATKIN_WHITELIST_PACKAGES=<span class="hljs-string">"<span class="hljs-variable">$&#123;PACAKGE_NAME&#125;</span>"</span><br></code></pre></td></tr></table></figure></p><h1 id="references">References</h1><ul><li><a href="https://wiki.ros.org/ROS/Tutorials/CreatingMsgAndSrv/" target="_blank" rel="noopener">Creating a ROS msg and srv</a></li><li><a href="https://wiki.ros.org/ROS/Tutorials/WritingServiceClient%28c%2B%2B%29" target="_blank" rel="noopener">Writing a Simple Service and Client(C++)</a></li><li><a href="https://blog.csdn.net/lxlong89940101/article/details/88893792" target="_blank" rel="noopener">ROS工作空间之编译某一单一功能包的小技巧</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Robot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ROS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Configuration of SNOPT</title>
      <link href="/2020/04/22/configuration-of-snopt/"/>
      <url>/2020/04/22/configuration-of-snopt/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p>SNOPT (<strong>S</strong>parse <strong>N</strong>onlinear <strong>OPT</strong>imizer) is a general-purpose system for constrained optimization, which requires a license to be executed. It minimizes a linear or nonlinear function subject to bounds on the variables and sparse linear or nonlinear constraints. It is suitable for large-scale linear and quadratic programming and for linearly constrained optimization, as well as for general nonlinear programs.</p><h1 id="simple-tutorial-in-2d">Simple Tutorial in 2D</h1><h2 id="apply-the-license">Apply the license</h2><p>UCSD offers evaluations versions (for 3 months) of optimization libraries <strong>SNOPT7</strong> and <strong>SQOPT7</strong> for macOS, Windows and Linux systems. <a href="https://ccom.ucsd.edu/~optimizers/downloads/#" target="_blank" rel="noopener">Click here</a> to apply the license.</p><h2 id="donwload-libraries">Donwload libraries</h2><p>After receiving the email from USCD, we can click the link approached to the email to download the libraries in different versions. As I would like to use the C++ version, <code>libsnopt7_cpp.so</code> has to be downloaded. Besides, the C++ interface is compiled from the <a href="https://github.com/snopt/snopt-interface" target="_blank" rel="noopener">snopt-interface github repository</a>. For Linux and MacOS, a C++ compiler must be used to link programs to the libraries above. For example, if we would like to compile and execute a C++ example named <code>myProb.cpp</code>:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; g++ -O -I<span class="hljs-variable">$SNOPT</span>/include -c myProb.cpp -o myProb.o<br>&gt;&gt; g++ -O myProb.o -o myProb -L<span class="hljs-variable">$SNOPT</span>/lib -lsnopt_cpp<br></code></pre></td></tr></table></figure><h1 id="step-by-step-tutorial">Step by Step Tutorial</h1><p>Actually, as for a beginner, we need to do some extra works to compile and execute the program successfully. Here I will provide a step-by-step tutorial to install and configure the <strong>SNOPT</strong>: 1. Apply the license. 2. Download <a href="https://github.com/snopt/snopt-interface" target="_blank" rel="noopener">snopt-interface github repository</a> and extract in the <code>$HOME</code> folder. Then we can rename the folder to <strong>SNOPT</strong>. 3. Enter to the folder and create folders named <strong>lib</strong> and <strong>lic</strong> in it. <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; <span class="hljs-built_in">cd</span> SNOPT<br>&gt;&gt; mkdir lib lic<br></code></pre></td></tr></table></figure> 4. Download the license approached to the UCSD email and move it to the <strong>lic</strong> folder. 5. Download the library <code>libsnopt7_cpp.so</code> in Linux version from the links approached to the UCSD email and move it into the <strong>lib</strong> folder. 6. Edit the <code>~/.bashrc</code> file as follow: <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; <span class="hljs-built_in">export</span> SNOPT_LICENSE=<span class="hljs-variable">$HOME</span>/SNOPT/lic/snopt7.lic<br>&gt;&gt; <span class="hljs-built_in">export</span> LD_LIBRARY_PATH=<span class="hljs-variable">$HOME</span>/SNOPT/lib<br>&gt;&gt; <span class="hljs-built_in">export</span> SNOPT=<span class="hljs-variable">$HOME</span>/SNOPT<br></code></pre></td></tr></table></figure> 7. Test if we configure the environment successfully by compiling and executing the routines in <strong>cppexamples</strong> folder. <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; <span class="hljs-built_in">cd</span> SNOPT/cppexamples<br>&gt;&gt; g++ -O -I<span class="hljs-variable">$SNOPT</span>/include -c sntoya.cpp -o sntoya.o<br>&gt;&gt; g++ -O sntoya.o -o sntoya -L<span class="hljs-variable">$SNOPT</span>/lib -lsnopt7_cpp<br></code></pre></td></tr></table></figure></p>{% note info %}  If utilizing shared libraries `.dylib/.so`, the location of the library files must be added to `LD_LIBRARY_PATH` on Linux.  If the error `libgfortran.so.4` required occurs, it means that gcc-7 and gfortran7 are required to be installed to meet the dependencies.{% endnote %}<ul><li>Install gfortran7 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">&gt;&gt; sudo add-apt-repository ppa:jonathonf/gcc-7.1<br>&gt;&gt; sudo apt-get update<br>&gt;&gt; sudo apt-get install gcc-7 g++-7 gfortran-7<br></code></pre></td></tr></table></figure></li></ul><p>In the end, after compiling the linking the <code>sntoya.cpp</code>, we get an executable file <code>sntoya</code>. If no error throws while we execute it, it means the we configure <strong>SNOPT</strong> successfully.</p><h1 id="references">References</h1><ul><li><a href="https://ccom.ucsd.edu/~optimizers/docs/snopt/index.html" target="_blank" rel="noopener">SNOPT7 Reference Guide</a></li><li><a href="https://web.stanford.edu/group/SOL/snopt.htm" target="_blank" rel="noopener">User guide for SNOPT7</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Programming </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Optimization </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Smart Pointer in C++</title>
      <link href="/2020/01/04/smart-pointer/"/>
      <url>/2020/01/04/smart-pointer/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p>C++ 编程中，指针一直是重要且深奥的一项，在很多时候因为指针使用不当会导致内存泄漏，产生严重后果。</p><h2 id="example">Example</h2><p>如以下代码所示，在类中存在类型为指针的成员变量，如果该类<strong>没有重新编写拷贝，赋值构造函数</strong>，在对该类的对象进行拷贝，赋值操作时， 会调用编译器生成的默认的拷贝，赋值构造函数。此时，当执行<code>c2(c1)</code>或者<code>c3 = c2</code>时，指针<code>data</code>的地址被复制了多次， <code>c1</code>，<code>c2</code>，<code>c3</code>各持有一份，因此在进行析构的时候便会产生内存错误。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ErrClass</span> &#123;</span><br><br><span class="hljs-keyword">private</span>:<br>    <span class="hljs-keyword">int</span>* data;<br><br><span class="hljs-keyword">public</span>:<br>    ErrClass(<span class="hljs-keyword">int</span> _data):data(<span class="hljs-literal">NULL</span>) &#123;<br>        init(_data);<br>        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"construct"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">virtual</span> ~ErrClass() &#123;<br>        <span class="hljs-keyword">if</span> (data) <span class="hljs-keyword">delete</span> data;<br>        data = <span class="hljs-literal">NULL</span>;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">init</span><span class="hljs-params">(<span class="hljs-keyword">int</span> _data)</span> </span>&#123;<br>        <span class="hljs-keyword">if</span> (data) <span class="hljs-keyword">delete</span> data;<br>        data = <span class="hljs-keyword">new</span> <span class="hljs-keyword">int</span>(_data);<br>    &#125;<br>&#125;;<br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>    <br>    <span class="hljs-function">ErrClass <span class="hljs-title">c1</span><span class="hljs-params">(<span class="hljs-number">10</span>)</span></span>;<br>    <span class="hljs-function">ErrClass <span class="hljs-title">c2</span><span class="hljs-params">(c1)</span></span>;<br>    ErrClass c3 = c1;<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="solution">Solution</h2><p>要解决或避免此错误的产生，方法便是在类中自定义拷贝，赋值构造函数，令该对象在进行此类操作的时候使用深拷贝。 但是，<code>boost</code>库提供了智能指针，可以方便的完成简单情况下的指针赋值，避免重复造轮子，在这里不对自定义拷贝，赋值函数进行讨论， 只讨论如何使用智能指针解决该问题。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;boost/smart_ptr.hpp&gt;</span></span><br><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> boost;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RealClass</span> &#123;</span><br><br><span class="hljs-keyword">private</span>:<br>    <span class="hljs-built_in">shared_ptr</span>&lt;<span class="hljs-keyword">int</span>&gt; ptr;<br><br><span class="hljs-keyword">public</span>:<br>    RealClass(<span class="hljs-keyword">int</span> _data):ptr(<span class="hljs-keyword">new</span> <span class="hljs-keyword">int</span>) &#123;<br>        set_data(_data);<br>        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"construct"</span> &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">virtual</span> ~RealClass() &#123;&#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">get_data</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> *ptr;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">set_data</span><span class="hljs-params">(<span class="hljs-keyword">int</span> data)</span> </span>&#123;<br>        *ptr = data;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">long</span> <span class="hljs-title">ptr_count</span><span class="hljs-params">()</span> <span class="hljs-keyword">const</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> ptr.use_count();<br>    &#125;<br><br>&#125;;<br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>    <br>    <span class="hljs-function">RealClass <span class="hljs-title">c1</span><span class="hljs-params">(<span class="hljs-number">10</span>)</span></span>;<br>    <span class="hljs-function">RealClass <span class="hljs-title">c2</span><span class="hljs-params">(c1)</span></span>;<br>    RealClass c3 = c2;<br>    <br>    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; c1.ptr_count() &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;<br>    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; c2.get_data() &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;<br>    c1.set_data(<span class="hljs-number">12</span>);<br>    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; c2.get_data() &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;<br>    <br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>如上面代码所示，在调用编译器自动生成的拷贝，赋值构造函数后，智能指针赋值拷贝的同时，引用计数也加1了。在调用析构函数的时候， 只有检查了指针的引用指数为0，才会调用<code>delete</code>方法删除掉内存，从而保证不会出现内存报错。</p><h2 id="warning">Warning</h2><p>但是，<code>shared_ptr</code>也有无法解决的问题：不能管理循环引用的对象。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs c++"><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;string&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;boost/lexical_cast.hpp&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;boost/smart_ptr.hpp&gt;</span></span><br><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> boost;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Parent</span>;</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Child</span>;</span><br><br><span class="hljs-keyword">typedef</span> boost::<span class="hljs-built_in">shared_ptr</span>&lt;Parent&gt; parent_ptr;<br><span class="hljs-keyword">typedef</span> boost::<span class="hljs-built_in">shared_ptr</span>&lt;Child&gt; child_ptr;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Parent</span> &#123;</span><br><br><span class="hljs-keyword">public</span>:<br>    child_ptr child;<br>    ~Parent() &#123;<span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"destorying parent\n"</span>;&#125;<br>    <br>&#125;;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Child</span> &#123;</span><br><br><span class="hljs-keyword">public</span>:<br>    parent_ptr parent;<br>    ~Child() &#123;<span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"destorying child\n"</span>;&#125;<br>&#125;;<br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;<br>    <br>    <span class="hljs-function">parent_ptr <span class="hljs-title">father</span><span class="hljs-params">(<span class="hljs-keyword">new</span> Parent())</span></span>;<br>    <span class="hljs-function">child_ptr <span class="hljs-title">son</span><span class="hljs-params">(<span class="hljs-keyword">new</span> Child())</span></span>;<br>    <br>    father-&gt;child = son;<br>    son-&gt;parent = father;<br>    <br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>在上面的程序中，因为<code>father</code>对象中的<code>child</code>成员指针指向了<code>son</code>对象，而<code>son</code>对象中的<code>parent</code>成员指针重新只想<code>father</code>， 导致循环引用，所以指针的引用数永远不为0,导致无法调用析构函数，因此产生了<strong>内存泄漏</strong>。</p><h2 id="solution-1">Solution</h2><p>为了解决此问题，只需要将其中一个类中的<code>shared_ptr</code>转换为<code>weak_ptr</code>即可。<code>weak_ptr</code>是只是提供了对管理对象的一个访问手段。 弱引用不更改引用计数，类似普通指针，只要把循环引用的一方使用弱引用，即可解除循环引用。弱引用还有两个常用的功能函数： <code>expired()</code>用于检测所管理的对象是否已经释放，<code>lock()</code>用于获取所管理对象的强引用指针。 <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Child</span> &#123;</span><br><br><span class="hljs-keyword">public</span>:<br>    boost::weak_ptr&lt;Parent&gt; parent;<br>    ~Child() &#123;<span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"destorying child\n"</span>;&#125;<br>&#125;;<br></code></pre></td></tr></table></figure></p><h1 id="references">References</h1><ul><li><a href="https://blog.einverne.info/post/2015/12/boost-learning-note-4.html" target="_blank" rel="noopener">boost学习笔记4：智能指针 smart_ptr</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Programming </category>
          
          <category> C++ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Proportional-Integral-Derivative(PID) Controller</title>
      <link href="/2019/12/04/pid-controller/"/>
      <url>/2019/12/04/pid-controller/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p>A <strong>proportional-integral-derivative controller</strong> (PID controller) is a control loop mechanism employing feedback taht is widely used in industrial control systems and a variety of other applications requiring continously modulated control.</p><h1 id="principle">Principle</h1><p>A PID controller continuously calculates an error value <span class="math inline">\(e(t)\)</span> as the difference between a desired setpoint (SP) and a measured process variable (PV) and applies a correction based on proportional, integral, and derivate terms (denoted <em>P</em>, <em>I</em> and <em>D</em> respectively), hence the name.</p><div data-align="center"><p><img src= "/img/loading.gif" data-lazy-src="https://i.imgur.com/ci6iFtK.png" alt="Image of PID Controller"/><br></p></div><h2 id="positional-pid-controller">Positional PID Controller</h2><p>From the above image, we can get the equation of Postional PID controller:</p><div data-align="center"><p><img src= "/img/loading.gif" data-lazy-src="https://i.imgur.com/LDFUNlL.png"/><br></p></div><p>In this equation, <span class="math inline">\(e(t)\)</span> means the error between target output and current output; <span class="math inline">\(K_P\)</span> is the coefficient of the proportional process; <span class="math inline">\(T_I\)</span> is the coefficient of the integral process; <span class="math inline">\(T_D\)</span> is the coefficient of the derivative process.</p><p>However, in industrial control systems, the input and output values are discrete and we obtain them by sampling periodically by sensors. Therefore, the equation of PID controller should be transfromed into the discrete equation, in which <span class="math inline">\(T\)</span> is the sampling period.</p><div data-align="center"><p><img src= "/img/loading.gif" data-lazy-src="https://i.imgur.com/izO8g6R.png"/><br></p></div><p>Through the above equation, the control signal <span class="math inline">\(u\)</span> could be calculated by sampling the output <span class="math inline">\(y\)</span> of the discrete system each step. Therefore, such equation is named <strong>Positional PID Controller</strong>, since it calculates the input signals each step.</p><p>Unfortunately, <strong>Positional PID controller</strong> needs to save and compute all the errors between target output and actual output from the beginning till now, which cost numerous computing resources. Hence, <strong>Incremental PID Controller</strong> is introduced to resolve the problem.</p><h2 id="incremental-pid-controller">Incremental PID Controller</h2><p>A new equation of positional PID controller in the <span class="math inline">\(e_{k-1}\)</span> moment is introduced,</p><div data-align="center"><p><img src= "/img/loading.gif" data-lazy-src="https://i.imgur.com/FLoSUkB.png"/><br></p></div><p>Use the equation (1) minus eqution (2), equation (3) could be obtained.</p><div data-align="center"><p><img src= "/img/loading.gif" data-lazy-src="https://i.imgur.com/Rjk3kJs.png"/><br></p></div><p>Through equation (3), we can calculate the increment of control signals only by saving past errors <span class="math inline">\(e_{k-1}\)</span>, <span class="math inline">\(e_{k-2}\)</span>.</p><h1 id="bonus">Bonus</h1><p>So, how to choose the optimal value of parameters <span class="math inline">\(K_P\)</span>, <span class="math inline">\(T_D\)</span> and <span class="math inline">\(T_I\)</span>?</p><h2 id="kp"><em>KP</em></h2><p>The parameter <span class="math inline">\(K_P\)</span> has an impact on the proportional process of PID controller and decide the tracking speed. However, if the plant is affected by an external load, the pure P Controller cannot reach the target output, which introduces the steady-state error.</p><h2 id="ti"><em>TI</em></h2><p>In order to eliminate the steady-state error, integral process is introduced and this procedure depends on the parameter <span class="math inline">\(T_I\)</span>. Although the integral process is able to eliminate the steady-state error, it brings the problem of <strong>overshooting and oscillation</strong>.</p><h2 id="td"><em>TD</em></h2><p>To resolve the problem of overshooting, derivative process use errors <span class="math inline">\(e_k\)</span> and <span class="math inline">\(e_{k-1}\)</span> to output the correction value.</p><h2 id="adjust-parameters">Adjust Parameters</h2><p>Hence, we can optimize the parameters of PID Controller through the following processes,</p><h3 id="common-method">Common Method</h3><ul><li>Set a small <span class="math inline">\(K_P\)</span> and an infinite <span class="math inline">\(T_I\)</span> with <span class="math inline">\(T_D\)</span> eqaulling to 0. Then gradually increase <span class="math inline">\(K_P\)</span> until getting an opportune tracking speed and a satisfactory quarter attenuation transition curve.</li><li>If the steady-state error occurs, increase the effect of the integral process by decrease the parameter <span class="math inline">\(T_I\)</span> until we think the integral process is enough, meanwhile, <span class="math inline">\(K_P\)</span> should be set to <span class="math inline">\(5/6K_P\)</span>.</li><li>If the problem of overshooting and oscillation occurs, set <span class="math inline">\(T_D = (1/3 \sim 1/4)T_I\)</span> and increase it, which can miligate the problem but it will slow down the tracking speed.</li></ul><h3 id="critical-ratio-method">Critical Ratio Method</h3><ul><li>Set a small <span class="math inline">\(K_P\)</span> and an infinite <span class="math inline">\(T_I\)</span> with <span class="math inline">\(T_D\)</span> eqaulling to 0. Then gradually increase <span class="math inline">\(K_P\)</span> until getting an equal amplitude oscillation, then record the critical coefficient <span class="math inline">\(K_u\)</span> and the critical period of ascillation <span class="math inline">\(T_u\)</span>.</li><li>Calculate the coefficients of <span class="math inline">\(K_P, T_I, T_D\)</span> according to empirical formula.</li><li>Set coefficients of PID controller to the computed parameter and optimize them if necessary.</li></ul><div data-align="center"><p><img src= "/img/loading.gif" data-lazy-src="https://i.imgur.com/ErCxwpD.png" alt="Image of Empirical Formula"/><br></p></div><h1 id="references">References</h1><ul><li><a href="https://en.wikipedia.org/wiki/PID_controller" target="_blank" rel="noopener">PID Controller in Wikipedia</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Study </category>
          
          <category> Control Theory </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Self-driving Hardware and Software Architectures</title>
      <link href="/2019/09/24/self-driving-hardware-and-software/"/>
      <url>/2019/09/24/self-driving-hardware-and-software/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p>本篇为多伦多大学的自动驾驶车辆课程中的第二周课程笔记，涉及到自动驾驶车辆的软硬件设计。</p><h1 id="sensors-and-computer-hardware">Sensors and Computer Hardware</h1><h2 id="sensors">Sensors</h2><p>传感器(Sensors)作为检测外界和车辆自身情况的硬件，在无人驾驶车辆中是必不可少的。传感器可以根据其感知数据范围的不同分为两类：</p><ul><li><strong>Exteroceptive</strong>：extero = surroundings</li><li><strong>proprioceptive</strong>：proprio = internal</li></ul><h3 id="摄像机">摄像机</h3><p>摄像机(Camera)作为感知外界环境的核心，主要有以下3个评价指标(Comparison metrics):</p><ul><li><strong>分辨率(Resolution)</strong>：分辨率影响摄像机的清晰度，分辨率越高，则可以观察到的物体细节越多</li><li><strong>视场角(Field of View)</strong>：视场角顾名思义为摄像头可以观察到的范围</li><li><strong>动态范围(Dynamic Range)</strong>：动态范围指的是摄像头从黑暗到明亮环境时的成像调节能力</li></ul><p>有的摄像机通过两个镜头加上融合算法处理，可以得到深度信息，被称作双目摄像机，得到出来的图像除了三个颜色通道外(RGB)， 还有一个通道存储深度信息(Depth)。</p><h3 id="激光雷达">激光雷达</h3><p>激光雷达(Lidar)在无人驾驶车辆中也得到很好的应用，通过测量激光反射的强度和时间形成的激光点云(Point Cloud)数据可以很好的反映周围环境的几何信息。 主要的评价指标为：</p><ul><li><strong>线数(Number of beams)</strong>：线数越多的Lidar，检测物体的精度也越高，常见的线数有8, 16 ,32 ,64</li><li><strong>每秒点数(Points per second)</strong>：每秒点数决定了Lidar的检测数率</li><li><strong>旋转速率(Rotation Rate)</strong>：旋转速率指的是Lidar旋转一圈所需要的时间</li><li><strong>视场角(Field of View)</strong>：视场角为Lidar的上下可观察到的范围</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://i.imgur.com/yIosdBv.png" alt="激光雷达点云图"/></p><h3 id="毫米波雷达">毫米波雷达</h3><p>毫米波雷达(Radar)在无人驾驶中主要应用与目标检测和相对速度测量，也分为WFOV(短距)和NFOV(长距)两类：</p><ul><li><strong>探测范围</strong>：最大的有效检测距离</li><li><strong>视场角</strong></li><li><strong>检测精度(Accuracy)</strong>：检测精度指的是检测位置(Position)以及速度(Speed)的精度</li></ul><h3 id="超声波雷达">超声波雷达</h3><p>超声波雷达(Ultrasonics)可以提供短距的，全天候下的距离检测，而且不会受到外界光照等条件的影响，是低成本自动泊车解决方案的必备选择， 主要缺点为探测距离短。</p><ul><li><strong>探测范围</strong></li><li><strong>视场角</strong></li><li><strong>成本(Cost)</strong></li></ul><h3 id="定位模块">定位模块</h3><p>在无人驾驶车辆中，定位模块由GNSS模块(Global Navigation Satellite Systems)和IMU模块(Inertial Measurement Units)组成, 其中GNSS模块提供车辆的经纬度，航向角信息；IMU模块提供车辆的3轴角速度，角加速度，加速度等信息。</p><h3 id="轮速计">轮速计</h3><p>轮速计可以通过测量车辆转速与摆角得到较为精确的车辆速度与车辆朝向，也是无人驾驶车辆可以使用的传感器之一。</p><h2 id="computing-hardware">Computing Hardware</h2><p>当前成熟的，符合车规级的自动驾驶硬件平台并不多，其中最具有代表性的就是 <strong>NVIDIA PX/AGX</strong> 和 <strong>Intel &amp; Mobile EyeQ</strong>。</p><p>硬件平台需求： 因为需要实时处理大量来自Lidar，Camera的数据，甚至需要进行深度学习，因此<strong>GPU</strong>和<strong>FPGAs</strong>是其中的核心部件之一。</p><h1 id="hardware-configuration-design">Hardware Configuration Design</h1><p>在硬件选型以及设计中，核心环节之一是传感器的布置方案。 下面将探讨如何在无人驾驶车辆上布置上文提到的6种传感器，从而保证行车安全。</p><h2 id="需求分析">需求分析</h2><p>可以将无人驾驶分解为两种基础场景，高速道路行驶以及城市道路行驶：</p><h3 id="高速道路行驶">高速道路行驶</h3><p>高速道路行驶场景中，无人驾驶车辆主要处理以下三个任务：</p><ul><li>紧急停车(Emergency Stop)： 假设车速为 120 <em>kmph</em>, 紧急停车制动距离约为 120 <em>meters</em></li><li>速度保持(Matain Speed)： 高速行驶中，为了维持车速和保持足够的制动距离，需要和前车保持的距离约为 100 <em>meters</em></li><li>变道(Lane Change)： 为了顺利变道，传感器应当探测临近车道及其过去的一个车道，防止变道过程中发生碰撞</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://i.imgur.com/zIT5QpK.png" alt=">传感器横向探测图"/&gt;</p><h2 id="城市道路行驶">城市道路行驶</h2><p>城市道路行驶场景中，无人驾驶车辆<strong>不仅需要</strong>关注高速道路行驶的任务，<strong>还需要</strong>关注以下三个额外的任务：</p><ul><li>绕障(Overtaking)：在绕障过程中，需要的传感器与高速公路场景下的变道相似</li><li>转弯，通过路口(Turning, Crossing at Intersections)：通过路口时，自动驾驶车辆不仅需要关注对向车i狼，还需要关注横向来车。</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://i.imgur.com/IrMhtp4.png" alt="十字路口传感器探测图"/></p><ul><li>通过环岛(Passing Roundabouts)：因为环岛的特殊性，车辆的速度会比平时更低，同时需要一个视场角更宽的传感器以提高探测效果。</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://i.imgur.com/yqqkdIU.png" alt="环岛传感器探测范围图"/></p><h3 id="传感器布置图">传感器布置图</h3><p>结合高速道路驾驶场景与城市道路驾驶场景，自动驾驶车辆传感器布置图的模式如下：</p><p><img src= "/img/loading.gif" data-lazy-src="https://i.imgur.com/sF24xcJ.png" alt="传感器总布置图"/></p><h1 id="software-architecture">Software Architecture</h1><p>自动驾驶汽车的软件基础架构可以分为5大模块，分别为：<strong>环境感知</strong>，<strong>环境匹配</strong>，<strong>动作规划</strong>，<strong>动作控制</strong>，<strong>系统监察</strong>。</p><p><img src= "/img/loading.gif" data-lazy-src="https://i.imgur.com/vhDwQc6.png" title="source: imgur.com" alt="自动驾驶软件架构"/></p><h2 id="环境感知">环境感知</h2><p>环境感知模块需要接收几乎所有的传感器输入，从而完成<strong>自定位</strong>，<strong>动态目标检测</strong>和<strong>静态目标检测</strong>三个功能。</p><ul><li>自定位：根据 GPS/IMU/Wheel Odometry 等传感器的输入，得到车辆的位置信息</li><li>动态目标检测：根据 Lidar/Cameras/Radar 的传感器的输入，不仅需要完成<strong>目标识别</strong>，还需要完成<strong>目标跟踪</strong>和<strong>目标预测</strong>。</li><li>静态目标检测：根据 HD Road Map 和 Lidar 的数据，识别出地面标志，Road Signs 等指示标志和路沿等障碍。</li></ul><h2 id="环境匹配">环境匹配</h2><p>环境匹配模块和环境感知模块密切相关，其任务是利用和传感器的数据和环境感知模块的结果，根据已经录制好的高精地图，更精确地匹配出车辆所在位置，得到详细的周边环境信息。 其模块包含3个类型的地图。</p><ul><li>栅格地图(Occupancy Grid Map)：栅格地图将地图划分为小格，并且将静态障碍物和可通行区域划分为不同的属性，利用该地图可以查询到可通行区域。</li><li>定位地图(Localizaiton Map)：定位地图有预先采集到的点云构成，通过将实时扫描到的点云与定位地图进行匹配，可以得到精度极高的自定位信息。</li><li>道路地图(Detailed Road Map)：道路地图一般以拓扑图的形式存在，将车道等信息连接起来，通过查询道路地图可以得到从A到B点的最优全局导航路径。</li></ul><h2 id="动作规划">动作规划</h2><p>动作规划模块是环境感知模块的下游，输入环境感知模块的结果，根据当前车辆所处的环境，输出当前时刻的最优轨迹到动作控制模块中。动作规划模块一般有三个子模块构成， 分别是<strong>任务规划</strong>，<strong>行为规划</strong>，<strong>局部轨迹规划</strong>三个模块。</p><ul><li>任务规划(Mission Planner)：任务规划模块利用当前车辆位置信息和<strong>道路地图</strong>，根据所给出的终点，使用算法得到合理的全局路径</li><li>行为规划(Behaviour Planner)：行为规划模块，根据全局导航路径和检测到的动态，静态障碍物，做出合适的行为决策，指导无人驾驶汽车行驶</li><li>局部轨迹规划(Local Planner)：局部轨迹规划模块根据行为规划模块的输出结果，根据车辆特性和驾驶舒适性等要求，输出合理的行车轨迹</li></ul><p><img src= "/img/loading.gif" data-lazy-src="https://i.imgur.com/dpKbzxb.png" title="source: imgur.com" alt="动作决策模块架构图"/></p><h2 id="系统监察">系统监察</h2><p>系统监察模块主要是利用运行在自动驾驶系统之外的另外一套系统来监听自动驾驶系统的各个模块运行，通讯是否正常，同时监管每个传感器是否正常工作，在传感器或者自动驾驶系统失效的情况下，监察系统需要<strong>发出告警</strong>且退出自动驾驶模式。</p><h1 id="environment-representation">Environment Representation</h1><p>环境表征主要分为将周围环境分为三个地图，分别为<strong>栅格地图</strong>,<strong>定位地图</strong>和<strong>道路地图</strong>，在前面的<em>环境匹配</em>模块中已经进行过介绍，此处不再赘述，可以在 <strong>Refernces</strong> 的 <em>Environment Representation</em> 进行查看。</p><h1 id="references">References</h1><ul><li><a href="https://d3c33hcgiwev3.cloudfront.net/qOzjLiP0Eem9HA6xGGaRfg_a92f911023f411e9b54e6d5a03316a13_C1M2L1---Sensors-and-Computing-Hardware.pdf?Expires=1569456000&amp;Signature=Rpji2USvyDoqtj1aSkHXWnYHq1D2NIyt6wOf6-Z5YCVSma32WldGhXtmqrqLFE96s8nHAMZ0iuV5A-GsA6mEghxltC~Q~TkGlqTsw1s-7oCBEUKCkDC4CwOvQzl~cCjzu3fv3Jev7aE5Mf-ulltznh6g9De05D~~QP8q~aatO6g_&amp;Key-Pair-Id=APKAJLTNE6QMUY6HBC5A" target="_blank" rel="noopener">Sensors and Computer Hardware</a></li><li><a href="https://d3c33hcgiwev3.cloudfront.net/rqAg6SP1EemdvRIYWfQePg_aee0846023f511e9ac6401043cf68a79_C1M2L2---Hardware-Configuration-Design.pdf?Expires=1569456000&amp;Signature=DI1Hgzlq4ydcBcdQjf2~zaL2BOx4-X8tP269lLA7TbQjmnXRqutAT2J-3-D394e5bT4fvsOdHBp9etDAP7IVQoJ6FZu72FxfbBz3TheLhXUM6nUqY6o2KkftxNAsGlM5vvUivWe-twYMyjQ8sjvn4t~ccL2zvgDw9YyPqqj6Nx8_&amp;Key-Pair-Id=APKAJLTNE6QMUY6HBC5A" target="_blank" rel="noopener">Hardware Configuration Design</a></li><li><a href="https://d3c33hcgiwev3.cloudfront.net/SE0ZMCP2EemdvRIYWfQePg_48711bd023f611e9b54e6d5a03316a13_C1M2L3---Autonomous-Vehicle-Software.pdf?Expires=1569628800&amp;Signature=aQ9LzEWYB4gjQJQ8FoX5ZhlBDx8ZDI4DDn5eebnuW7nUPE643iu12DWMMcQ8YTAl6ic1M~3cezgL-zcWqGJLK~~LE7PrZOz~c0L018T33HF63d9xWPASnj8Mb~I3nPacfhwNgJfYvwXhlqsX9Y5A6kJh5zwMVgJ5WnD4Wwjx5rI_&amp;Key-Pair-Id=APKAJLTNE6QMUY6HBC5A" target="_blank" rel="noopener">Software Architecture</a></li><li><a href="https://d3c33hcgiwev3.cloudfront.net/SE2OYSP2EemdvRIYWfQePg_4881bda023f611e9bdd6579bce97d1d3_C1M2L4---Environment-Representation.pdf?Expires=1569628800&amp;Signature=HqCrkIUjxVVDJu43Ua3Sfhj1yDf6OKxiMBroTbErsdzb-j3nsYJ7qCGnL~5EKxGNEHYnWzA05hIkmKGpeJzJh63uW6gBgErsZdFdG~G1SjNA8TBvM6JprDW6ZZv3DXlBMpmVSQSgY6-22rayhoQN5LiUTvxwF-cCJ-01HTDfsMI_&amp;Key-Pair-Id=APKAJLTNE6QMUY6HBC5A" target="_blank" rel="noopener">Environment Representation</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Study </category>
          
          <category> Autonomous Driving </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>VIM 的主题配色与语法高亮设置</title>
      <link href="/2019/09/11/vim-configuration-of-colorscheme-and-syntax/"/>
      <url>/2019/09/11/vim-configuration-of-colorscheme-and-syntax/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p>在 <strong>VIM</strong> 编辑器中，想要源代码语法高亮，不仅需要有配色方案，还需要有对应的 syntax 文件。</p><h1 id="配色方案">配色方案</h1><p><strong>VIM</strong> 中，所有的配色方案都可以存放到 <code>~/.vim/colors</code> 文件夹下, 以 <code>[name].vim</code> 文件的形式存储。 配色方案中存储的是针对所有文件的基础语法高亮的配色。</p><p>以 <code>Monokai.vim</code> 为例，将网上下载到的配色方案放入到 <code>~/.vim/colors</code> 文件夹下后，在 <code>~/.vimrc</code> 中加入以下内容： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">syntax on  <span class="hljs-string">"Open syntax highlight"</span><br><span class="hljs-built_in">set</span> background=dark <span class="hljs-string">"Set color of background"</span><br>colorscheme Monokai <span class="hljs-string">"Set colorscheme"</span><br></code></pre></td></tr></table></figure></p><h1 id="语法高亮">语法高亮</h1><p>但是，只设置了配色方案的话，是无法针对某种类型的源代码进行语法高亮的。 为了实现针对不同语言的源码进行语法高亮，需要有对应的 syntax 文件，所有的 syntax 文件都存放到 <code>~/.vim/syntax</code> 文件夹下。</p><p>syntax 文件中存放的是<strong>语法通配的规则以及何种语法对应哪种配色方案</strong>。 以 <strong>Python</strong> 为例，从 Github 上可以下载到已经配置好的 <code>python.vim</code> 文件，将其放入到 <code>~/.vim/syntax</code> 文件夹下后，在 <code>~/.vimrc</code> 中加入以下内容： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">let</span> python_highlight_all = 1<br>filetype plugin indent on<br>hi Comment cterm=italic <span class="hljs-string">"Set comment to italics"</span><br></code></pre></td></tr></table></figure> 完成上面的设置后，即可实现对应类型的源码的语法高亮。</p><h1 id="个人配置">个人配置</h1><p>下面是强烈推荐的配色方案以及<strong>Python</strong>的通配文件：</p><p>配色方案： <a href="https://github.com/liuchengxu/space-vim-theme/blob/master/colors/space_vim_theme.vim" target="_blank" rel="noopener">space-vim-theme</a> 通配文件： <a href="https://github.com/Sophistt/Small_Projects/blob/master/vim_configuration/syntax/python.vim" target="_blank" rel="noopener">python.vim</a></p><h1 id="references">References</h1><ul><li><a href="https://github.com/liuchengxu/space-vim-theme" target="_blank" rel="noopener">space-vim-theme</a></li><li><a href="https://stackoverflow.com/questions/4746579/syntax-highlighting-in-vim-for-python" target="_blank" rel="noopener">Syntax highlighting in vim for python</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Writing </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vim </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Use Vimdiff as Git Mergetool</title>
      <link href="/2019/08/21/use-vimdiff-as-git-merge-tools/"/>
      <url>/2019/08/21/use-vimdiff-as-git-merge-tools/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><h1 id="什么是-vimdiff">什么是 vimdiff ？</h1><p><strong>vimdiff</strong> 是 vim 文本编辑器自带的用于对比文件差异的工具，详细说明 <a href="https://sophistt.github.io/linux/2019/08/20/vimdiff.html">点击此处</a>。 因此，<strong>vimdiff</strong> 可以用于解决 git 合并的产生的冲突。</p><h1 id="使用方法">使用方法</h1><h2 id="git-配置">Git 配置</h2><p>使用 <strong>vimdiff</strong> 之前需要对 <code>git mergetool</code> 进行配置，指定 <strong>vimdiff</strong> 作为其默认的查看工具。 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">git config merge.tool vimdiff  <span class="hljs-comment"># 指定vimdiff作为默认mergetool</span><br>git config merge.conflictsytle diff3  <span class="hljs-comment"># 设定mergetool风格</span><br>git config mergetool.prompt <span class="hljs-literal">false</span>  <span class="hljs-comment"># 取消打开文件时的warning显示</span><br></code></pre></td></tr></table></figure> ## 使用流程 当我们在使用<code>git pull</code>或者<code>git merge</code>命令因为文件冲突报错而不能成功合并时，通过执行<code>git mergetool</code>命令打开 vimdiff.</p><p>vimdiff 打开后，可以看到4个窗口排列成两行：</p><p>第一行的3个窗口从左到右分别被命名为<code>LOCAL</code>,<code>BASE</code>,<code>REMOTE</code>，分别代表了当前分支上文件的内容，两个分支的上游分支的内容，远程另一分支的内容。</p><p>第二行的窗口命名为<code>MERGED</code>，显示了合并结果，通过修改<code>MERGED</code>窗口的内容得到最终想要保留的结果后即可保存提交。</p><h3 id="命令">命令</h3><p>移动到<code>MERGED</code>窗口后，将光标移动到冲突处 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">:diffget LOCAL  <span class="hljs-comment"># 冲突内容采用LOCAL分支的内容</span><br>:diffget BASE   <span class="hljs-comment"># 冲突内容采用BASE分支的内容</span><br>:diffget REMOTE <span class="hljs-comment"># 冲突内容采用REMOTE分支的内容</span><br></code></pre></td></tr></table></figure></p><p>修改完毕后，使用<code>:wa</code>命令保存修改，然后使用<code>:qa</code>退出编辑器，执行<code>git commit</code>即可提交修改。</p><h1 id="references">References</h1><ul><li><a href="https://kinboyw.github.io/2018/10/09/Use-Vimdiff-As-Git-Mergetool/" target="_blank" rel="noopener">使用vimdiff作为git mergetool</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Programming </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vimdiff</title>
      <link href="/2019/08/20/vimdiff/"/>
      <url>/2019/08/20/vimdiff/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p>对比文本文件（源文件）是项目开发中经常会碰到的情况，现在很多专业的IDE已经提供了文件对比的功能, 但是这些IDE在远程连接服务器的时候必须通过虚拟桌面才能使用，因此<code>vimdiff</code>成为了远程连接服务器的对比文件工具的首选。</p><h1 id="启动方法">启动方法</h1><p><code>vimdiff</code> 是文本编辑器<code>vim</code>的功能之一，依赖于系统的<code>diff</code>功能。启动命令如下： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">vimdiff &lt;file1&gt; &lt;file2&gt;<br></code></pre></td></tr></table></figure></p><p>除了上面的方法，也可以在<code>vim</code>中使用窗口分割模式来启动<code>diff</code>命令 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">vim &lt;file1&gt;  <span class="hljs-comment"># 打开第一个文件</span><br><br>:vertical diffsplit &lt;file2&gt;  <span class="hljs-comment"># 使用diff模式打开第二个文件在右边的窗口</span><br></code></pre></td></tr></table></figure></p><h1 id="合并文本">合并文本</h1><p>文件比较的最终目的就是为了减少差异或者合并文件，通过下面的基本命令可以方便地进行文件合并的操作。</p><h2 id="将差异内容拉取到当前文件">将差异内容拉取到当前文件</h2><p>如果想快速修改一个差异点内的内容，即将另一个文件的内容拉取到当前文件，通过<code>do</code>命令即可实现。</p><h2 id="将差异内容推送到另外一文件">将差异内容推送到另外一文件</h2><p>反之，如果想要将当前文件的某个差异点的内容推到另外一个文件，可以通过<code>dp</code>命令实现。</p><h2 id="刷新比较文件">刷新比较文件</h2><p>当内容被修改后，<code>vimdiff</code>会自动刷新文件比较的内容，但是有时候刷新失败的话，可以通过<code>:diffupdate</code>命令来手动刷新。</p><h1 id="折叠展开文本">折叠展开文本</h1><p>比较和合并文件的时候需要通过对比上下文来进行，<code>vimdiff</code>默认将差异点的上下6行的文本都显示出来，差异点以外的相同文本内容则会被折叠起来, 如果想要手动展开或者折叠某些内容的话，可以通过以下命令来操作。</p><h2 id="展开文本">展开文本</h2><p>通过命令<code>zo</code>既可实现文本展开的操作。</p><h2 id="折叠文本">折叠文本</h2><p>通过命令<code>zc</code>可以将展开的文本重新折叠。</p><h1 id="references">References</h1><ul><li><a href="https://www.ibm.com/developerworks/cn/linux/l-vimdiff/index.html" target="_blank" rel="noopener">技巧：Vimdiff 使用</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Writing </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vim </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Build Your Own Git Server</title>
      <link href="/2019/08/08/build-your-own-git-server/"/>
      <url>/2019/08/08/build-your-own-git-server/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p>当我们在做团队项目时，如果需要进行代码管理而代码又不方便开源上传到 Github，则有两种方法可以满足<strong>多人协作</strong>以及<strong>代码版本管理</strong>的需求： - 升级Github企业用户 - 搭建自己的代码托管服务器</p><p>下面主要介绍如何<strong>搭建自己的代码托管服务器</strong>。</p><h1 id="远程服务器准备工作">远程服务器准备工作</h1><h2 id="创建-git-用户">创建 git 用户</h2><p>创建一个新的 git 用户专门用于管理远程 git 代码仓库，可以防止 git 用户的配置文件与当前用户的配置文件发生冲突。 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo adduser git <span class="hljs-comment"># 创建 git 用户</span><br>su git           <span class="hljs-comment"># 切换到 git 用户下</span><br></code></pre></td></tr></table></figure></p><h2 id="创建远程仓库">创建远程仓库</h2><p>在远程服务器中， 需要创建项目代码仓库文件夹，然后在该文件夹下初始化一个空的代码仓库: <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">mkdir -p ~/Repositories/Project.git  <span class="hljs-comment"># 创建文件夹</span><br><span class="hljs-built_in">cd</span> ~/Repositories/Project.git  <span class="hljs-comment"># 进入到仓库文件夹</span><br>git init --bare  <span class="hljs-comment"># 初始化一个空仓库</span><br></code></pre></td></tr></table></figure></p><h1 id="免密码提交">免密码提交</h1><p>在创建了远程仓库后，已经可以通过 <code>git clone ssh://server.ip:/path/to/*.git</code> 的命令来进行远程仓库的使用了，但是每次 <code>git push/pull/fetch</code> 等操作都会要求输入密码，十分的麻烦，因此下面我们通过生成 <strong>ssh</strong> 密钥来实现免密码连接远程仓库。</p><h2 id="本地电脑生成密钥">本地电脑生成密钥</h2><p>使用 <code>ssh-keygen</code> 命令即可在本地电脑生成密钥，第一次询问是生成密钥的路径，第二次询问是生成密钥的密码。按照自己想要的方式设置好后，在 <code>~/.ssh</code> 目录下回生成 <code>id_rsa</code> 和 <code>id_rsa.pub</code> 两个文件，分别是私钥和公钥。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ssh-keygen -t rsa <span class="hljs-comment"># 生成密钥</span><br></code></pre></td></tr></table></figure><h2 id="远程仓库授权公钥">远程仓库授权公钥</h2><p>在本地电脑中生成的公钥需要在远程仓库中授权才能使用免密码操作。</p><p>打开 <code>id_ras.pub</code> 文件，将里面的内容添加到远程服务器的 <code>~/.ssh/authorized_keys</code> 文件里面即可。</p><h1 id="关联远程仓库">关联远程仓库</h1><p>承接第一节的内容，在远程建立的一个空的仓库之后，如果想将本地的仓库关联到远程仓库并推送，可以通过以下代码实现。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">git remote add origin ssh://git@server.ip:/path/to/*.git <span class="hljs-comment"># 将本地仓库关联到远程仓库</span><br><br>git push -u origin master <span class="hljs-comment"># 只有第一次远程推送需要加入 -u 参数</span><br></code></pre></td></tr></table></figure><h1 id="利用gitlab搭建私有代码管理平台">利用Gitlab搭建私有代码管理平台</h1><p>Gitlab是一个开源的GIT仓库管理平台，主要面向中型代码团队，允许代码的成员在上面创建，修改代码库，并且追踪，修复bugs。搭建私有的Gitlab代码管理平台即相当于拥有一个部署在内网的Github，Gitlab网站，团队成员可以通过内网的网页访问代码。</p><h2 id="安装必须的ubuntu-packages">安装必须的Ubuntu Packages</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo apt-get update<br>sudo apt-get install -y curl openssh-server ca-certificates<br></code></pre></td></tr></table></figure><h2 id="安装邮件通知服务">安装邮件通知服务</h2><p>Gitlab提供多种方式发送邮件通知，其中推荐是的<strong>Postfix</strong>和<strong>SMTP</strong>服务：</p><ul><li>使用<strong>Postfix</strong>: <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo apt-get install -y postfix<br></code></pre></td></tr></table></figure></li><li>使用<strong>SMTP</strong>服务不需要安装额外的依赖库，只需要在部署好Gitlab后修改<code>/etc/gitlab/gitlab.rb</code>文件并执行<code>gitlab-ctl reconfigure</code>命令即可。通过<a href="https://docs.gitlab.com/omnibus/settings/smtp.html" target="_blank" rel="noopener">此链接</a>可以查看配置样例。 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">gitlab_rails[<span class="hljs-string">'smtp_enable'</span>] = <span class="hljs-literal">true</span><br>gitlab_rails[<span class="hljs-string">'smtp_address'</span>] = <span class="hljs-string">"smtp.server"</span><br>gitlab_rails[<span class="hljs-string">'smtp_port'</span>] = 465<br>gitlab_rails[<span class="hljs-string">'smtp_user_name'</span>] = <span class="hljs-string">"smtp user"</span><br>gitlab_rails[<span class="hljs-string">'smtp_password'</span>] = <span class="hljs-string">"smtp password"</span><br>gitlab_rails[<span class="hljs-string">'smtp_domain'</span>] = <span class="hljs-string">"example.com"</span><br>gitlab_rails[<span class="hljs-string">'smtp_authentication'</span>] = <span class="hljs-string">"login"</span><br>gitlab_rails[<span class="hljs-string">'smtp_enable_starttls_auto'</span>] = <span class="hljs-literal">true</span><br>gitlab_rails[<span class="hljs-string">'smtp_openssl_verify_mode'</span>] = <span class="hljs-string">'peer'</span><br><br><span class="hljs-comment"># If your SMTP server does not like the default 'From: gitlab@localhost' you</span><br><span class="hljs-comment"># can change the 'From' with this setting.</span><br>gitlab_rails[<span class="hljs-string">'gitlab_email_from'</span>] = <span class="hljs-string">'gitlab@example.com'</span><br>gitlab_rails[<span class="hljs-string">'gitlab_email_reply_to'</span>] = <span class="hljs-string">'noreply@example.com'</span><br></code></pre></td></tr></table></figure></li></ul><h2 id="安装gitlab">安装Gitlab</h2><ul><li>完成Gitlab依赖包的安装以后，即可通过添加Gitlab的下载链接来安装Gitlab： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl -sS https://packages.gitlab.com/install/repositories/gitlab/gitlab-ce/script.deb.sh | sudo bash<br></code></pre></td></tr></table></figure></li><li>安装Gitlab并修改访问地址： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo EXTERNAL_URL=<span class="hljs-string">"http://gitlab.example.com"</span> apt-get install gitlab-ce<br></code></pre></td></tr></table></figure> 安装完毕后，即可通过在浏览器中输入 <a href="">http://gitlab.example.com</a> 来访问Gitlab代码部署平台。</li></ul><h2 id="配置gitlab">配置Gitlab</h2><p>如果想修改Gitlab相关的内容，可以通过修改其配置文件，修改后需要通过<code>gitlab-ctl reconfigure</code>命令来重新启动Gitlab <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo vim /etc/gitlab/gitlab.rb<br>sudo gitlab-ctl reconfigure<br></code></pre></td></tr></table></figure> <div class="note info flat"><p>如果想要搭建公网的Gitlab代码管理平台，需要租借域名和购买证书，并进行额外的配置。</p></div></p><h1 id="referencs">Referencs</h1><ul><li><a href="https://zhuanlan.zhihu.com/p/40371444" target="_blank" rel="noopener">搭建属于你自己的 Git 服务器</a></li><li><a href="https://www.aneasystone.com/archives/2018/12/build-your-own-git-server.html" target="_blank" rel="noopener">搭建自己的 Git 服务器</a></li><li><a href="https://about.gitlab.com/install/#ubuntu" target="_blank" rel="noopener">Install self-managed Gitlab</a></li><li><a href="https://www.howtoforge.com/tutorial/how-to-install-and-configure-gitlab-on-ubuntu-16-04/" target="_blank" rel="noopener">How to Install and Configure GitLab on Ubuntu 16.04</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Programming </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Differences in Serveral Executable Commands in Linux</title>
      <link href="/2019/07/31/differences-in-commands-source-sh-bash/"/>
      <url>/2019/07/31/differences-in-commands-source-sh-bash/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p>In Linux, there are several commands to execute shell scripts such as <code>bash</code>, <code>source</code>, <code>sh</code>, <code>./</code>. So, what are the differences of them?</p><h1 id="source"><code>source</code></h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">source</span> a.sh<br></code></pre></td></tr></table></figure><p>Execute the specified shell script in current bash, and the <strong>executable</strong> authority of this script is unneccesary. Besides, <code>.</code> equals <code>source</code>:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">. a.sh<br></code></pre></td></tr></table></figure><h1 id="bashsh"><code>bash/sh</code></h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">sh a.sh<br>bash a.sh<br></code></pre></td></tr></table></figure><p>Execute the specified shell script in the <strong>subshell</strong>, and the <strong>executable</strong> authority of this script is also unneccesary.</p><h1 id="section"><code>./</code></h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">./ a.sh<br></code></pre></td></tr></table></figure><p>Execute the specified shell script in the <strong>subshell</strong>, and the <strong>executable</strong> authority of this script is also <strong>neccesary</strong> so that <code>chmod u+x .</code> can be used to change the authority of the scirpt.</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> bash </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>How to Use Bibtex and Latex in Sublime Text</title>
      <link href="/2019/07/26/how-to-use-bibtex-and-latex-in-sublime-text/"/>
      <url>/2019/07/26/how-to-use-bibtex-and-latex-in-sublime-text/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p>Before using <em>Latex</em> in <strong>Sublime text 3</strong>, latex release should be installed in your computer. TeX Live in an excellent release version which can be instlled in Unix, Windows and Mac. Please read documents in its website to install TeX Live.</p><p>Download link: <a href="https://www.tug.org/texlive/acquire-netinstall.html" target="_blank" rel="noopener">TeX Live</a></p><h1 id="latex-tools">Latex Tools</h1><p>In order to use TeX Live in sublime text 3, a plugin named <strong>LaTeXTools</strong> should be installed first. Use <code>ctrl+shift+P</code> to open command line in sublime text 3 and use the <code>package control</code> plugin to instll <strong>LaTexTools</strong>.</p><p>Open <code>LaTexTools.sublime-settings</code> and find <code>windows</code> setting in it to change <code>texpath</code> variable according to you TeXLive installed path.</p><p>Finally, use <code>Build With: LaTeX - XeLaTeX</code> to create PDF file.</p><h1 id="bibtex">Bibtex</h1><h2 id="knowledge-base">Knowledge Base</h2><p>Firstly, we can install <code>CiteBibtex</code> plugin in sublime text 3 to manage our knowledge base. we can Create a file named <code>ciation.bib</code> and add its path to 'CiteBibtex.sumlime-setting' for saving paper.</p><h2 id="insert-references-in-latex">Insert References in LaTeX</h2><p>To insert references in LaTeX documents, a file named <code>ciation.bib</code> should be added in the same folder as <code>paper.tex</code>. Next, in the place where you would like to insert references, use command <code>cite{}</code> to cite references and add two commands about bibtex to <code>paper.tex</code> as follow:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs latex">\bibliographystyle&#123;plain&#125;<br>\bibliography&#123;ciation&#125;<br></code></pre></td></tr></table></figure><p>Finally, use <code>Build With: LaTeX - XeLaTeX</code> to create PDF file.</p><h1 id="references">References</h1><ul><li><a href="blog.baoduge.com/Use_ST3_manage_reference/">用Sublime Text 3 管理文献</a></li><li><a href="https://www.cnblogs.com/yifdu25/p/8330652.html" target="_blank" rel="noopener">Latex技巧：插入参考文献</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Writing </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Latex </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Kalman Filter</title>
      <link href="/2019/07/24/kalman-filter/"/>
      <url>/2019/07/24/kalman-filter/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong>Kalman filter</strong> is a technology to achieve <em>Bayes filter</em>. It's an <strong>optimal linear state estimation method</strong> (eqauls to <strong>optimal linear filter under the minimum mean square error criterion</strong>), which seeks the state vector that best fits the observed data by mathematical methods.</p><p>In localization and navigation of robots, kalman filter is the most commonly used method to estimante the robot's status, as it solve the problem recursively and only the estimation value in the last sampling period and the measurement in the current sampling period are needed, which saves memory and calculating time.</p><h1 id="principle">Principle</h1><h2 id="prerequisite">Prerequisite</h2><p>Before using kalman filter, 3 prerequisites should be statisfied:</p><ul><li>State transition probability must be the linear function fo parameters with random Gaussian noise</li><li>Measurement probabilty also has to contain Gaussian component</li><li>Initial confidence is normally distributed</li></ul><h2 id="problem-description">Problem Description</h2><p>Define a status vector with random-Gaussian-noise parameters:</p><p><span class="math display">\[\begin{align*}  x_t  = A_tx_{t-1} + B_tu_t + \epsilon_t\end{align*}\]</span></p><p>In this equation, <span class="math inline">\(x_t\)</span> and <span class="math inline">\(x_{t-1}\)</span> represents the status vector (<span class="math inline">\(n \times 1\)</span>) in moment <span class="math inline">\(t\)</span> and <span class="math inline">\(t-1\)</span> respectively; <span class="math inline">\(A\)</span> is the state transition matrix in <span class="math inline">\(n x n\)</span> dimension; <span class="math inline">\(u_t\)</span> represents the control vector (<span class="math inline">\(m \times 1\)</span>) on moment <span class="math inline">\(t\)</span>; <span class="math inline">\(B_t\)</span> is an optional gain matrix of control vector in <span class="math inline">\(n \times m\)</span> dimension; <span class="math inline">\(\epsilon_t\)</span> is a random Gaussian vector that represents the uncertainty introduced by status transition.</p><p>Note: all vectors are column vectors in the following form:</p><p><span class="math display">\[\begin{align*}  x_t =  \begin{bmatrix}  x_{1, t} \\ x_{2, t} \\ . \\ . \\ x_{n, t}  \end{bmatrix} \quad  and \quad   u_t =  \begin{bmatrix}  u_{1, t} \\ u_{2, t} \\ . \\ . \\ u_{m, t}  \end{bmatrix}\end{align*}\]</span></p><p>Define another observation vector (<span class="math inline">\(k * 1\)</span>):</p><p><span class="math display">\[\begin{align*}  z_t  = H_tx_{t} + \delta_t\end{align*}\]</span></p><p>In this equation, <span class="math inline">\(H_t\)</span> is the gain matrix in <span class="math inline">\(k * n\)</span> dimension; <span class="math inline">\(\delta_t\)</span> is the observation noise.</p><h2 id="example">Example</h2><p>Give an example to explain the above equations. Suppose that we are tracking a car in uniform motion through GPS and other sensors. In general, we would like to get information about its position and velocity (or orientation) when we observe a vehicle. Therefore, status vector could be defined as <span class="math inline">\(x_t = (x_t, y_t, v^x, v^y)^T\)</span>. Simultanenously, it's known that in uniform motion the control vector is <span class="math inline">\(u_t = (v^x, v^y)^T\)</span>.</p><p>As a result, the matrix <span class="math inline">\(A\)</span> and <span class="math inline">\(B\)</span> are defined as follow:</p><p>$$ <span class="math display">\[\begin{align*}  A =   \begin{bmatrix}  1 \quad 0 \quad 0 \quad 0 \\  0 \quad 1 \quad 0 \quad 0 \\  0 \quad 0 \quad 1 \quad 0 \\  0 \quad 0 \quad 0 \quad 1 \\  \end{bmatrix}  \quad and \quad  B =   \begin{bmatrix}  dt \quad 0 \\  0 \quad dt \\  0 \quad 0 \\  0 \quad 0 \\  \end{bmatrix}\end{align*}\]</span> $$</p><p>Finally, we can get the status equation:</p><p><span class="math display">\[\begin{align*}  x_t  = A_tx_{t-1} + B_tu_t + \epsilon_t  \Rightarrow  \begin{bmatrix}  x_t \\ y_t \\ v^x \\ v^y  \end{bmatrix} =    \begin{bmatrix}  1 \quad 0 \quad 0 \quad 0 \\  0 \quad 1 \quad 0 \quad 0 \\  0 \quad 0 \quad 1 \quad 0 \\  0 \quad 0 \quad 0 \quad 1 \\  \end{bmatrix}  \begin{bmatrix}  x_{t-1} \\ y_{t-1} \\ v^x \\ v^y  \end{bmatrix} +  \begin{bmatrix}  dt \quad 0 \\  0 \quad dt \\  0 \quad 0 \\  0 \quad 0 \\  \end{bmatrix}  \begin{bmatrix}  v^x \\ v^y  \end{bmatrix} + \epsilon_t =   \begin{bmatrix}  x_{t-1} + v^x * dt \\ y_{t-1} + v^y * dt \\ v^x \\ v^y  \end{bmatrix} + \epsilon_t  \end{align*}\]</span></p><p>Similarly, <span class="math inline">\(H\)</span> is also required to be defined. As we can get the information about vehicle's position from GPS sensor, the observation vector is defined as <span class="math inline">\(z_t = (x_t, y_t)^T\)</span>. <span class="math inline">\(H\)</span> is a <span class="math inline">\(k * n\)</span> dimensional matrix, so that we can get the equation as follow:</p><p><span class="math display">\[\begin{align*}  z_t  = H_tx_{t} + \delta_t  \Rightarrow  \begin{bmatrix}  1 \quad 0 \quad 0 \quad 0 \\  0 \quad 1 \quad 0 \quad 0 \\  \end{bmatrix}   \begin{bmatrix}  x_t \\ y_t \\ v^x \\ v^y  \end{bmatrix} + \delta_t =  \begin{bmatrix}  x_t \\ y_t   \end{bmatrix} + \delta_t\end{align*}\]</span></p><h1 id="algorithm">Algorithm</h1><p>After defining <span class="math inline">\(x_t\)</span>, <span class="math inline">\(z_t\)</span>, <span class="math inline">\(A\)</span> and <span class="math inline">\(H\)</span>, we can use kalman fitler algorithm to estimate <span class="math inline">\(x_t\)</span>.</p><h2 id="prediction">Prediction</h2><p><span class="math display">\[\begin{align*}  \hat{x}^-_t = A\hat{x_{t-1}} + Bu_t \\  \hat{P}^-_t = A\hat{P_{t-1}}A^T + Q\end{align*}\]</span></p><h2 id="update">Update</h2><p><span class="math display">\[\begin{align*}  K_t = \frac{\hat{P}^-_tH^T}{H^T\hat{P}^-_tH^T + R} \\  \hat{x}_t = \hat{x}^-_t + K_t(z_t - H\hat{x}^-_t) \\  \hat{P}_t = (I - K_tH)\hat{P}^-_t\end{align*}\]</span></p><p>Explanaiton of parameters in these equations:</p><ul><li><span class="math inline">\(\hat{x}^-_t\)</span>: the priori estimated value of status vector at moment <span class="math inline">\(t\)</span></li><li><span class="math inline">\(\hat{x}_t\)</span>: the posterior estimated value of status vector at moment <span class="math inline">\(t\)</span>, the result of kalman filter</li><li><span class="math inline">\(\hat{x}_{t-1}\)</span>: the posterior estimated value of status vector at moment <span class="math inline">\(t-1\)</span></li><li><span class="math inline">\(A\)</span>: status transition matrix</li><li><span class="math inline">\(B\)</span>: an optional gain matrix of control vector</li><li><span class="math inline">\(u_{t}\)</span>: control vector at moment <span class="math inline">\(t\)</span></li><li><span class="math inline">\(\hat{P}^-_t\)</span>: the priori estimated covariance at moment <span class="math inline">\(t\)</span></li><li><span class="math inline">\(\hat{P}_{t-1}\)</span>: the posterior estimated covariance at moment <span class="math inline">\(t\)</span>, a part of result of filter</li><li><span class="math inline">\(K_t\)</span>: kalman gain coefficient, intermediate variable of equation</li><li><font color="red"><span class="math inline">\(Q\)</span></font><font color="black">: covariance of process noise that represents the error between status transition matrix and actual process.It's difficult to seek the best value of <span class="math inline">\(Q\)</span>, but it follows some priciples: In general, <span class="math inline">\(Q\)</span> is diagonal matrix and the values are small for prompt convergence.</font></li><li><font color="red"><span class="math inline">\(R\)</span></font><font color="black">: covariance of measured noise that relates to measured instruments, the smaller of this value, the higher of the convergence speed</font></li></ul><h1 id="expansion">Expansion</h1><p>Unfortunately, <strong>kalman fitler</strong> only can be applied to problems with linear status transition matrix and measurement, which confine it in simple robotic problem. Therefore, <strong>Extended Kalman Filter</strong> is introduced to break the limitation.</p><h2 id="reality">Reality</h2><p>Essentially, the linear prediction and measurement in kalman filter are replaced by no-linear prediction and measurement in extended kalman filter. As the result, <span class="math inline">\(Ax_{t-1} + Bu_t\)</span> is replaced by Jacobi Matrix <span class="math inline">\(g(x_{t-1}, u_t)\)</span> and <span class="math inline">\(Hx_t\)</span> is replaced by Jacobi Matrix <span class="math inline">\(h(x_t)\)</span> .</p><table><thead><tr class="header"><th style="text-align: center;">KF</th><th style="text-align: center;">EKF</th></tr></thead><tbody><tr class="odd"><td style="text-align: center;"><span class="math inline">\(A\hat{x_{t-1}} + Bu_t\)</span></td><td style="text-align: center;"><span class="math inline">\(g(x_{t-1}, u_t)\)</span></td></tr><tr class="even"><td style="text-align: center;"><span class="math inline">\(H\hat{x}^-_t\)</span></td><td style="text-align: center;"><span class="math inline">\(h(\hat{x}^-_t)\)</span></td></tr></tbody></table><h2 id="compute-jacobi-matrix">Compute Jacobi Matrix</h2><p>Take the above vehicle as an example:</p><p><span class="math display">\[\begin{align*}  J_{A} =   \begin{bmatrix}  \frac{dx}{dx} \quad \frac{dx}{dy} \quad \frac{dx}{dv^x} \quad \frac{dx}{dv^y} \\  \frac{dy}{dx} \quad \frac{dy}{dy} \quad \frac{dy}{dv^x} \quad \frac{dy}{dv^y} \\  \frac{dv^x}{dx} \quad \frac{dv^x}{dy} \quad \frac{dv^x}{dv^x} \quad \frac{dv^x}{dv^y} \\  \frac{dv^y}{dx} \quad \frac{dv^y}{dy} \quad \frac{dv^y}{dv^x} \quad \frac{dv^y}{dv^y}   \end{bmatrix} =  \begin{bmatrix}  1 \quad 0 \quad dt \quad 0 \\  0 \quad 1 \quad 0 \quad dt \\  0 \quad 0 \quad 1 \quad 0 \\  0 \quad 0 \quad 0 \quad 1 \\  \end{bmatrix}  \\ \\   J_{H} =   \begin{bmatrix}  \frac{dx}{dx} \quad \frac{dx}{dy} \quad \frac{dx}{dv^x} \quad \frac{dx}{dv^y} \\  \frac{dy}{dx} \quad \frac{dy}{dy} \quad \frac{dy}{dv^x} \quad \frac{dy}{dv^y} \\  \end{bmatrix} =  \begin{bmatrix}  1 \quad 0 \quad 0 \quad 0 \\  0 \quad 1 \quad 0 \quad 0 \\  \end{bmatrix}\end{align*}\]</span></p><h2 id="prediction-and-update">Prediction and Update</h2><p><span class="math display">\[\begin{align*}  \hat{x}^-_t = g(x_{t-1}, u_t) \\  \hat{P}^-_t = A\hat{P_{t-1}}A^T + Q \\  K_t = \frac{\hat{P}^-_tH^T}{H^T\hat{P}^-_tH^T + R} \\  \hat{x}_t = \hat{x}^-_t + K_t(z_t - h(\hat{x}^-_t)) \\  \hat{P}_t = (I - K_tH)\hat{P}^-_t\end{align*}\]</span></p><h1 id="codes">Codes</h1><ul><li><a href="https://github.com/Sophistt/Small_Projects/blob/master/kalman_filter/kalman_filter.py" target="_blank" rel="noopener">kalman_filter.py</a></li></ul><h1 id="references">References</h1><ul><li><a href="http://www.probabilistic-robotics.org/" target="_blank" rel="noopener">Probabilistic Robotics</a></li><li><a href="https://blog.csdn.net/u013453604/article/details/50301477" target="_blank" rel="noopener">卡尔曼滤波的理解以及参数调整</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Study </category>
          
          <category> Math </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Bash Scripts Exploration</title>
      <link href="/2019/07/17/bash-scripts-exploration/"/>
      <url>/2019/07/17/bash-scripts-exploration/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p><strong>What is bash script?</strong></p><p>Bash is a Unix shell, which is a command line interface(CLI) for interacting with the operating system(OS).</p><p>Bash script which contains command lines can be run in <strong>Bash</strong> and finish extremely excellent work.</p><h1 id="prepared-work">Prepared work</h1><h2 id="create-a-bash-script">Create a bash script</h2><p>In Linux operating system, suffix name is not necessary so that we can name the bash script whatever we want. For example, we can create a folder named <code>scripts</code> and a bash script named <code>experiment</code> in it. <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">mkdir scripts<br><span class="hljs-built_in">cd</span> scripts<br>touch experiment<br></code></pre></td></tr></table></figure> In order to access scripts in this folder anywhere, adding this directory to <strong>ENV PATH</strong> is recommended. <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># optional</span><br><span class="hljs-built_in">export</span> PATH=/path/to/scripts:<span class="hljs-variable">$PATH</span><br></code></pre></td></tr></table></figure></p><h2 id="make-the-bash-script-executable">Make the bash script executable</h2><p>To run the <code>experiment</code> script, it's necessary to change its mode. <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">chmod u+x experiment<br></code></pre></td></tr></table></figure></p><h2 id="add-symbol">Add symbol</h2><p>Each bash script should begins with the following line for specifying the interpreter. <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br></code></pre></td></tr></table></figure></p><h1 id="basic-syntax">Basic syntax</h1><h2 id="echo">Echo</h2><p>Keyword <code>echo</code> can be used to output contents to the screen. Add the following line in <code>experiment</code> script and run the script, <strong>Hello world</strong> can be seen in the terminal. <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">echo</span> Hello world<br></code></pre></td></tr></table></figure></p><h2 id="variables">Variables</h2><p>Variables must be declared before being invoked. Use <code>=</code> to assign variables and use <code>$</code> to call them. <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br>name=<span class="hljs-string">"Jack"</span><br><br><span class="hljs-built_in">echo</span> Hello, I am <span class="hljs-variable">$name</span><br></code></pre></td></tr></table></figure></p><h2 id="read">Read</h2><p><code>read</code> can be used to assign variables from input on ternimal. <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br><span class="hljs-built_in">echo</span> what are you?<br><br><span class="hljs-built_in">read</span> who<br><br><span class="hljs-built_in">echo</span> Hello, <span class="hljs-variable">$who</span><br></code></pre></td></tr></table></figure></p><h2 id="conditions">Conditions</h2><p>Structures like <code>for</code>, <code>if...else</code> can also be used in bash scripts. But operators used in bash are different from those in programming languages.</p><h3 id="judgment">Judgment</h3><table><thead><tr class="header"><th style="text-align: center;">Bash Operators</th><th style="text-align: center;">Operators</th><th style="text-align: center;">Description</th></tr></thead><tbody><tr class="odd"><td style="text-align: center;">-eq</td><td style="text-align: center;">==</td><td style="text-align: center;">equal</td></tr><tr class="even"><td style="text-align: center;">-ne</td><td style="text-align: center;">!=</td><td style="text-align: center;">not equal</td></tr><tr class="odd"><td style="text-align: center;">-gt</td><td style="text-align: center;">&gt;</td><td style="text-align: center;">greater than</td></tr><tr class="even"><td style="text-align: center;">-ge</td><td style="text-align: center;">&gt;=</td><td style="text-align: center;">greater than or equal</td></tr><tr class="odd"><td style="text-align: center;">-lt</td><td style="text-align: center;">&lt;</td><td style="text-align: center;">less than</td></tr><tr class="even"><td style="text-align: center;">-le</td><td style="text-align: center;">&lt;=</td><td style="text-align: center;">less than or equal</td></tr><tr class="odd"><td style="text-align: center;">-z</td><td style="text-align: center;">== null</td><td style="text-align: center;">is null</td></tr></tbody></table><p>For example:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br><span class="hljs-built_in">echo</span> How much is it?<br><br><span class="hljs-built_in">read</span> prize<br><br><span class="hljs-keyword">if</span> [ <span class="hljs-variable">$prize</span> -gt 100 ]<br><span class="hljs-keyword">then</span> <br>    <span class="hljs-built_in">echo</span> Too expensive<br><span class="hljs-keyword">else</span><br>    <span class="hljs-built_in">echo</span> Great<br><span class="hljs-keyword">fi</span><br></code></pre></td></tr></table></figure><h3 id="looping">Looping</h3><p>Looping is another powerful structure in programming language, we also can use it in bash scripts as follow. <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br>FILES=/opt/*<br><br><span class="hljs-keyword">for</span> file <span class="hljs-keyword">in</span> <span class="hljs-variable">$FILES</span><br><span class="hljs-keyword">do</span><br>    <span class="hljs-built_in">echo</span> $(basename <span class="hljs-variable">$file</span>)<br><span class="hljs-keyword">done</span><br></code></pre></td></tr></table></figure></p><h1 id="open-another-terminal">Open another terminal</h1><p>Sometimes multiple screens are required to display different messages. To satisfy this requirment, <code>gnome-ternimal</code> can be used to open another ternimal and run commands in it. Add <code>gnome-terminal</code> in a bash script, a new ternimal will open when we run the script.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br>gnome-ternimal<br></code></pre></td></tr></table></figure><h2 id="optional-arguments">Optional arguments</h2><p>Some arguments are used for customizing the new ternimal.</p><ul><li><code>--maximize</code>: Maximize the ternimal</li><li><code>--full-screen</code>: The terminal Occupy the full screen after opening.</li><li><code>--window --window</code>: Open two terminals</li><li><code>--window --tab --window --tab --tab</code>: Open two ternimals and open tabs in them</li><li><code>--geometry=80x25+10+10</code>: Set size of the terminal</li><li><code>-e</code>: run the following commands in the new terminal, the following commands should be included in ''.</li></ul><p>Fro example: <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br>gnome-terminal --geometry=80x25 -e <span class="hljs-string">'echo $PATH'</span><br></code></pre></td></tr></table></figure></p><p>However, the terminal will disappear after executing commands. In order to retain the terminal after executing commands, we can use the following commands to maintain the window. <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br>gnome-terminal --geometry=80x25 -e <span class="hljs-string">'bash -c "echo $PATH;exec bash"'</span><br></code></pre></td></tr></table></figure></p><h1 id="references">References</h1><ul><li><a href="https://www.taniarascia.com/how-to-create-and-use-bash-scripts/" target="_blank" rel="noopener">How to Create and Use Bash Scripts</a></li><li><a href="https://blog.csdn.net/weixin_39465823/article/details/83786685" target="_blank" rel="noopener">linux下使用shell脚本打开多个terminal并在其中运行程序的方法</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> bash </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ROS Launch Exploration</title>
      <link href="/2019/07/05/roslaunch/"/>
      <url>/2019/07/05/roslaunch/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p>在 Ros 中，要启动多个节点的时候，如果要一个一个节点的去启动，将十分麻烦而且浪费时间。因此 Ros 提供了 <strong>roslaunch</strong> 方法来同时启动多个节点。<strong>roslaunch</strong> 在启动任何一个节点前，都会确定 <strong>roscore</strong> 节点是否已经在运行，如果没有则自动启动它。</p><p>要使用 <strong>roslaunch</strong> 方法，首先需要编写 <code>.launch</code> 文件，该文件以 <code>xml</code> 的格式编写。</p><h1 id="basic-knowledge">Basic knowledge</h1><p><strong>roslaunch</strong> 启动多个节点的时候，<strong>无法控制节点的启动顺序</strong>。因此，如果需要顺序启动节点的话，可以使用<code>bash script</code>来控制节点的启动。</p><p><code>launch</code> 文件的存放位置并不做要求，也就是说一个<code>launch</code>文件可以启动多个 <strong>workspaces</strong> 内的多个 <strong>packages</strong>。但是在使用 <strong>roslaunch</strong> 命令调用 <code>launch</code> 文件之前，必须通过 <code>source ws/devel/setup.bash</code> 将该 <strong>workspace</strong> 加入到环境变量中， 否则会出现 <strong>Package not found</strong> 的错误。</p><p>因此，推荐的运行 <code>launch</code> 文件的方式为：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># In launch file directory</span><br><span class="hljs-built_in">source</span> /path/to/ws/devel/setup.bash<br>roslaunch ./example.launch<br></code></pre></td></tr></table></figure><h1 id="example">Example</h1><p>一个基础的 <code>.launch</code> 文件如下： <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">launch</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">arg</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"csv_path"</span> <span class="hljs-attr">default</span>=<span class="hljs-string">"/home/wcy/code/gac_path_track/path_data/csv/huagong-donghu-osm.csv"</span>/&gt;</span><br>  <br>    <span class="hljs-tag">&lt;<span class="hljs-name">group</span> <span class="hljs-attr">ns</span>=<span class="hljs-string">"pathTrack"</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">node</span> <span class="hljs-attr">pkg</span>=<span class="hljs-string">"path_track"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"path_track_node"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"path_track_node"</span> <span class="hljs-attr">output</span>=<span class="hljs-string">"screen"</span> <span class="hljs-attr">launch-prefix</span>=<span class="hljs-string">"xterm -fa 'Monospace' -fs 10 -e"</span> /&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">node</span> <span class="hljs-attr">pkg</span>=<span class="hljs-string">"pub_path"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"pub_path_node"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"talker.py"</span> <span class="hljs-attr">args</span>=<span class="hljs-string">"$(arg csv_path)"</span> <span class="hljs-attr">output</span>=<span class="hljs-string">"screen"</span> <span class="hljs-attr">launch-prefix</span>=<span class="hljs-string">"xterm -fa 'Monospace' -fs 10 -e"</span>/&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">group</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">launch</span>&gt;</span><br></code></pre></td></tr></table></figure></p><h1 id="example-explained">Example explained</h1><p><code>&lt;launch&gt; ... &lt;/launch&gt;</code>: 根元素(root element), 作为放置其他元素的容器，其他元素必须放在该标志之间。 <br> <code>&lt;arg name="" default=""/&gt;</code>: 设置全局变量，通过<code>name</code>和<code>default</code>分别设置变量名和值，在节点启动需要参数时可以使用。 <code>&lt;group ns=""&gt; ... &lt;/group&gt;</code>: 组，将制定的节点组织起来，令其使用相同的命名空间从而有效管理多个节点。 <br> <code>&lt;node pkg="" name="" type=""&gt;</code>: 定义想要启动的 ROS 节点。包含三个必须的属性，<code>pkg</code>，<code>type</code>，<code>name</code>。同时还有<code>output</code>，<code>launch-prefix</code>等可选属性。 - <code>pkg</code>: 节点所在的程序包的名字。 - <code>type</code>: 节点可执行文件的名字。 - <code>name</code>: 节点名，该属性覆盖原有文件中 <code>ros::init</code> 的 <code>name</code>。 - <code>args</code>: 如果该节点启动的时候需要输入参数，可以通过<code>args</code>传入参数。 - <code>output</code>: 指定该节点输出的位置，<code>screen</code>设置为当前终端，也可以设置成将内容输出到指定文件内。 - <code>launch-prefix</code>: 该属性指定开启新的窗口显示输出内容，<code>xterm -e</code> 或 <code>gnome-terminal</code> 分别是使用不同的终端显示内容。</p><h1 id="references">References</h1><ul><li><a href="http://wiki.ros.org/roslaunch/XML" target="_blank" rel="noopener">roslaunch/XML</a></li><li><a href="http://wiki.ros.org/roslaunch/Commandline%20Tools" target="_blank" rel="noopener">roslaunchCommandline/Tools</a></li><li><a href="http://ttshun.com/2018/05/24/ROS%E5%AD%A6%E4%B9%A0%E4%B9%8Broslaunch/" target="_blank" rel="noopener">ROS学习之roslaunch</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Robot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ROS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Basic Operation of Git and Git Flow Strategy</title>
      <link href="/2019/06/28/basic-operation-of-git/"/>
      <url>/2019/06/28/basic-operation-of-git/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><h1 id="basic-operation-of-git">Basic Operation of Git</h1><h2 id="fundamental-conception">Fundamental Conception</h2><p><strong>Git</strong> 是一个很强大的代码版本管理软件，通过使用 <strong>Git</strong> 我们可以很方便地管理我们的代码，包括撤销操作，回退到某个版本，临时修改代码等。 <strong>Git</strong> 有四个基本空间，名为工作区(working directory)，暂存区(stage)，本地仓库(local repository)， 远程仓库(remote repository)。 - 工作区 就是电脑里的代码目录，所有的操作都在此处进行。 - 暂存区 也叫 index ，我们 <code>git add</code> 后的信息会被存放到此处，一般用于我们在开发过程中遇到另外的情况需要恢复 到未修改的代码状态，但是又想保留已经更改的代码下次开发时，可以将修改的内容放到暂存区。 - 本地仓库 <strong>Git</strong> 的版本库，通过本地仓库我们可以实现回退代码到某个版本的操作。 - 远程仓库 服务器端的版本库，通过<code>git push</code>, <code>git pull</code>指令进行本地仓库和远程仓库的同步。</p><p><img src= "/img/loading.gif" data-lazy-src="https://i.imgur.com/GXW3rPh.png" title="source: imgur.com" alt="From http://files.zeroturnaround.com/pdf/zt_git_cheat_sheet.pdf"/></p><h2 id="common-commands">Common Commands</h2><h3 id="提交">提交</h3><p>日常最常用的指令就是修改代码后将修改提交到代码库。 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">git add .                 <span class="hljs-comment"># 将所有修改加入到暂存库</span><br>git commit -m <span class="hljs-string">"comments"</span>  <span class="hljs-comment"># 将暂存库的内容提交到本地仓库</span><br></code></pre></td></tr></table></figure></p><h3 id="查看状态">查看状态</h3><p>了解当前工作环境的状态也是日常工作中的一部分。 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">git status           <span class="hljs-comment"># 查看当前工作区的状态</span><br>git diff [filename]  <span class="hljs-comment"># 查看某文件的不同</span><br></code></pre></td></tr></table></figure></p><h3 id="仓库同步">仓库同步</h3><p>如果创建为本地仓库创建了远程仓库，在日常工作完毕后需要将工作推送到远程仓库。 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">git pull <span class="hljs-comment"># 合并远程分支到本地</span><br>git push <span class="hljs-comment"># 推送本地分支到远程</span><br></code></pre></td></tr></table></figure></p><h3 id="撤销回滚">撤销&amp;回滚</h3><p>当因为某些原因想要撤销修改的时候，<strong>Git</strong> 同样可以方便地完成我们想要的操作。<br></p><ol type="1"><li><p>只是修改了文件，没有<code>git add .</code>, 没有<code>git commit</code> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">git checkout -- [filename]/.  <span class="hljs-comment"># 可以选择单独撤销某个文件或本地所有文件</span><br>git clean -xdf                <span class="hljs-comment"># 删除所有新文件</span><br></code></pre></td></tr></table></figure></p></li><li><p>已经<code>git add .</code>, 没有<code>git commit</code> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git reset HEAD  <span class="hljs-comment"># 将暂存区的内容放回到工作区, 还需要继续 1 的操作</span><br></code></pre></td></tr></table></figure></p></li><li><p>已经<code>git commit</code>, 但是没有<code>git push</code> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git reset --hard &lt;commit-id&gt;  <span class="hljs-comment"># 直接将代码重置到之前的某个版本</span><br></code></pre></td></tr></table></figure></p></li><li><p>已经<code>git push</code>，所以需要修改远程仓库 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">git revert &lt;commit-id&gt; -m<br>git push<br></code></pre></td></tr></table></figure></p></li></ol><h3 id="储藏代码">储藏代码</h3><p>当我们在开发代码的过程中，项目出现了意外情况（如 Bug 修复）需要我们用未修改过的代码进行项目开发的时候，我们又不想放弃当前修改的内容，便可以将修改内容先存放到暂存区。 然后再新的分支上进行 Bug 修复，最后再恢复暂存区的代码继续进行原有的开发。 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">git stash -u <span class="hljs-comment"># 将修改的内容存放到暂存区，包括未跟踪的文件</span><br><br>git stash pop <span class="hljs-comment"># 将暂存区的内容重新放入到工作区，继续开发</span><br></code></pre></td></tr></table></figure></p><h3 id="对比差异">对比差异</h3><p>在项目开发的过程中，有时候需要对比代码修改前后的差异，<code>git diff</code> 命令可以帮助我们完成这项工作。 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">git diff  <span class="hljs-comment"># 默认为对比工作区和暂存区的所有文件的异同</span><br>git diff --cached  <span class="hljs-comment"># 对比暂存区(git add . 以后)和最新本地版本库(上一次 commit)的区别</span><br>git diff HEAD  <span class="hljs-comment"># 比较工作区和最新本地版本库的区别</span><br>git diff branch_name  <span class="hljs-comment"># 比较工作区和指定分知名的差别</span><br>git diff &lt;commit-id&gt; &lt;commit-id&gt;  <span class="hljs-comment"># 比较两次提交之间的差异</span><br></code></pre></td></tr></table></figure></p><h2 id="git-branch">Git Branch</h2><p><strong>Git</strong> 通过 <em>branch</em> 来实现版本管理的功能，通过在不同的分支上进行代码开发，只需要进行分支切换即可 实现使用不同版本的代码。</p><ol type="1"><li><p>查看分支 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git branch -a  <span class="hljs-comment"># 查看当前所有分支</span><br></code></pre></td></tr></table></figure></p></li><li><p>创建分支 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git checkout -b &lt;branchName&gt;  <span class="hljs-comment"># 创建并切换到新的分支上</span><br></code></pre></td></tr></table></figure></p></li><li><p>切换分支 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git checkout &lt;branchName&gt;  <span class="hljs-comment"># 切换到已存在的分支上</span><br></code></pre></td></tr></table></figure></p></li><li><p>删除分支 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">git branch -d &lt;branchName&gt; <span class="hljs-comment"># 删除本地仓库分支</span><br>git push origin --delete &lt;branchName&gt; <span class="hljs-comment"># 删除远程仓库分支</span><br></code></pre></td></tr></table></figure></p></li><li><p>查看当前分支是否关联了远程分支 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git branch -vv<br></code></pre></td></tr></table></figure></p></li><li><p>合并分支 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">git merge --no-ff &lt;branchName&gt;  <span class="hljs-comment"># 将 branchName 分支合并到当前分支</span><br>git reset --hard &lt;the number before merge&gt; <span class="hljs-comment"># 撤销合并（合并后没有push）</span><br></code></pre></td></tr></table></figure></p></li></ol><h3 id="推荐的工作流">推荐的工作流</h3><p>在日常代码迭代中，不提倡直接在原有分支上进行改动，而是切换到新的特性分支上进行代码迭代，经过测试后 再合并到原有分支上。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">git checkout -b dev-newFeature dev   <span class="hljs-comment"># 基于 dev 分支创建新的特性分支</span><br>git commit -a -m <span class="hljs-string">"comments"</span>          <span class="hljs-comment"># 修改代码并提交</span><br>git checkout dev                     <span class="hljs-comment"># 切换到 dev 分支</span><br>git pull                             <span class="hljs-comment"># 从远程仓库更新 dev 分支代码</span><br>git merge --no-ff dev-newFeature     <span class="hljs-comment"># 合并特性分支到 dev</span><br>git push                             <span class="hljs-comment"># 推送</span><br>git branch -d dev-newFeature         <span class="hljs-comment"># 删除特性分支direction))</span><br></code></pre></td></tr></table></figure><h2 id="remote-repository">Remote repository</h2><p>本地仓库与远程仓库的关联，同步是十分重要的操作，根据不同的情况又有不同的操作，下面讲述在不同的情况下较好的操作方式。</p><h3 id="创建本地仓库并关联远程仓库">创建本地仓库并关联远程仓库</h3><p>假设在本地已经有现存的代码想加入到 <strong>Git</strong> 版本控制系统中，首先需要在本地建立仓库。 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">git init<br>git add .<br>git commmit -m <span class="hljs-string">"Repository initialization"</span><br></code></pre></td></tr></table></figure></p><p>接下来需要在远程服务器或在 <strong>Github</strong> 上创建一个空仓库 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git init --bare <span class="hljs-comment"># Input this command in the remote server</span><br></code></pre></td></tr></table></figure></p><p>为本地仓库和远程仓库添加关联 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">git remote add origin ssh://server.name@server.ip:/path/to/project.git <span class="hljs-comment"># 为本地仓库添加远程仓库关联</span><br>git push -u origin master <span class="hljs-comment"># 推送到远程仓库，第一次推送需要加上 -u</span><br></code></pre></td></tr></table></figure></p><p>删除本地仓库和某远程仓库的关联 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git remote remove origin<br></code></pre></td></tr></table></figure></p><h3 id="新建本地分支和远程分支并关联">新建本地分支和远程分支并关联</h3><p>假设想创建一个 <code>dev</code> 本地分支并创建其对应的远程分支，首先需要在本地创建新的分支 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git checkout -b dev <span class="hljs-comment"># 创建本地 dev 分支</span><br></code></pre></td></tr></table></figure> 然后创建一个新的远程 <code>dev</code> 分支 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git push origin dev <span class="hljs-comment"># 创建一个新的远程 dev 分支</span><br></code></pre></td></tr></table></figure> 为本地分支和远程分支添加关联 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git branch --<span class="hljs-built_in">set</span>-upstream-to origin/dev<br></code></pre></td></tr></table></figure></p><h3 id="基于远程分支创建新的本地分支">基于远程分支创建新的本地分支</h3><p>如果想要基于某个远程分支创建新的本地分支，首先需要拉取整个仓库到本地，然后查看该仓库拥有的远程分支，最后基于远程分支创建新的本地分支。 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">git fetch <span class="hljs-comment"># 拉取远程仓库到本地</span><br>git branch -a <span class="hljs-comment"># 查看本地分支及远程分支</span><br>git checkout -b dev origin/dev <span class="hljs-comment"># 基于 origin/dev 分支创建本地 dev 分支</span><br></code></pre></td></tr></table></figure></p><h3 id="只克隆某一特定分支的-git-仓库">只克隆某一特定分支的 Git 仓库</h3><p>如果只想克隆某一特定分支的 <strong>Git</strong> 仓库，可以使用以下命令 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git <span class="hljs-built_in">clone</span> -b [branch_name] server.name@repository.git<br></code></pre></td></tr></table></figure></p><h1 id="git-flow-strategy">Git Flow Strategy</h1><p>持续代码交付方案中，有不同的代码分支策略，目前主流的代码分支策略中有两种，一是<strong>主干开发</strong>, 另外一种就是<strong>Git Flow</strong>。 <strong>Git Flow</strong> 模式下，有6个主要的分支，分别为： - 主分支(master) 稳定版本分支，对外可以随时编译发布的分支，不允许直接<code>push</code>代码，只能请求合并(<code>pull request</code>)， 且只接受 hotfix, release 分支的代码合并 - 热修复分支(hotfix) 针对现场紧急问题，bug 修复的分支，修复完后合并到主分支，开发分支<br />- 发布分支(release) 版本发布分支，用于迭代版本的发布。迭代完成后，合并 dev 代码到 release，在 release 分支上编译发布 版本，以及修复 bug，测试完成后此版本可以作为发行版，然后把稳定的代码<code>push</code>到 master 上。 - 开发分支(dev) 开发版分支，日常开发都应该在此分支上，迭代完成后合并到 release 分支。 - 特性开发分支(dev-feature) 开发人员针对自己开发特性创建的基于 dev 的分支，开发完成后合并到 dev 分支上。</p><p><img src= "/img/loading.gif" data-lazy-src="https://i.imgur.com/UbwLdqs.png" title="source: imgur.com" alt="Git Branch Control"/></p><h2 id="初始化配置">初始化配置</h2><p>创建一个新的仓库时，可以按照下面的初始化各种分支。 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">git checkout -b hotfix                        <span class="hljs-comment"># 创建 hotfix 分支</span><br>git push origin hotfix                        <span class="hljs-comment"># 创建远程 hotfix 分支</span><br>git branch --<span class="hljs-built_in">set</span>-upstream-to origin/hotfix    <span class="hljs-comment"># 关联 hotfix 分支到远程</span><br><br>git checkout -b dev                           <span class="hljs-comment"># 创建 dev 分支</span><br>git push origin dev                           <span class="hljs-comment"># 创建远程 dev 分支</span><br>git branch --<span class="hljs-built_in">set</span>-upstream-to origin/dev       <span class="hljs-comment"># 关联 dev 分支到远程</span><br>   <br>git checkout -b release                       <span class="hljs-comment"># 常见 release 分支</span><br>git push origin release                       <span class="hljs-comment"># 创建远程 release 分支</span><br>git branch --<span class="hljs-built_in">set</span>-upstream-to origin/release   <span class="hljs-comment"># 关联 release 分支到远程</span><br></code></pre></td></tr></table></figure></p><h2 id="紧急bug修复">紧急Bug修复</h2><p>当代码出现一个紧急 bug 的时候，可以按照以下的工作流程来进行 bug 修复。 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">git checkout -hotfix                   <span class="hljs-comment"># 切换到 hotfix 分支</span><br>git pull gitlab master                 <span class="hljs-comment"># 从远程 master 分支同步代码，同时更新到本地和远程的 hotfix 分支</span><br><br>git commit -a -m <span class="hljs-string">"comments"</span>            <span class="hljs-comment"># 提交代码</span><br>git push                               <span class="hljs-comment"># 推送代码到远程主分支</span><br><br>git checkout dev                       <span class="hljs-comment"># 切换到 dev 分支</span><br>git pull                               <span class="hljs-comment"># 同步</span><br>git merge --no-ff hotfix               <span class="hljs-comment"># 合并 hotfix 分支到 dev 分支</span><br>git commit -a -m <span class="hljs-string">"merge hotfix branch"</span> <span class="hljs-comment"># 提交代码</span><br>git push                               <span class="hljs-comment"># 推送分支到远程</span><br><br><span class="hljs-comment"># 合并主分支</span><br></code></pre></td></tr></table></figure></p><h1 id="references">References</h1><ul><li><a href="https://blog.csdn.net/zuozewei/article/details/93862974#_92" target="_blank" rel="noopener">持续交付之基于Git Flow代码分支策略实践</a></li><li><a href="https://blog.csdn.net/fw0124/article/details/50426740" target="_blank" rel="noopener">Git 分支最佳实践</a></li><li><a href="https://www.jianshu.com/p/e1129ecdaed4" target="_blank" rel="noopener">git基于远程分支创建本地分支</a></li><li><a href="https://blog.csdn.net/huangjw_806/article/details/78297851" target="_blank" rel="noopener">Git创建本地分支并关联远程分支</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Programming </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C++ Debug in Linux through GDB</title>
      <link href="/2019/06/26/cplusplus-debug-in-linux/"/>
      <url>/2019/06/26/cplusplus-debug-in-linux/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><h1 id="prerequisite">Prerequisite</h1><h2 id="修改-cmakelists.txt">修改 CMakelists.txt</h2><p>Linux 下为了使用 GDB 调试 C++ 项目，在编译的过程中需要加入 <code>-g -ggdb</code> 参数，而习惯上我们使用 CMakelists 来生成 <code>Makefile</code> , 因此我们需要修改 <strong>CMakelists.txt</strong> 来生成符合条件的 <code>Makefile</code> 。</p><p>首先在 <strong>CMakelists.txt</strong> 中加入以下内容： <figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs cmake"><span class="hljs-comment"># The configuration used for construction of Debug Makefile</span><br><span class="hljs-keyword">SET</span>(CMAKE_CXX_FLAGS_DEBUG <span class="hljs-string">"$ENV&#123;CXXFLAGS&#125; -O0 -Wall -g -ggdb"</span>)<br><br><span class="hljs-comment"># The configuration used for construction of Release Makefile</span><br><span class="hljs-keyword">SET</span>(CMAKE_CXX_FLAGS_RELEASE <span class="hljs-string">"$ENV&#123;CXXFLAGS&#125; -O3 -Wall"</span>)<br></code></pre></td></tr></table></figure> 加入这两行的之后，我们就可以分别用不同的命令调用不同的<code>CMAKE_CXX_FLAGS</code>生成不同的<code>Makefile</code>。</p><h2 id="编译">编译</h2><p>使用下面的指令生成用于 <strong>Debug</strong> 的<code>Makefile</code>: <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">cmake -DCMAKE_BUILD_TYPE=Debug<br></code></pre></td></tr></table></figure> 然后用<code>make</code>指令生成可执行文件即可。</p><h1 id="debug">Debug</h1><h2 id="开始调试">开始调试</h2><p>进入到可执行文件的目录下，假设可执行文件名为 <strong>TestClass</strong>, 输入以下命令则进入调试模式： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">gdb TestClass<br></code></pre></td></tr></table></figure> 如果没有错误的话，应当可以看到以下输出： <img src= "/img/loading.gif" data-lazy-src="https://i.imgur.com/ul8ytpA.png" alt="Imgur" /></p><h2 id="窗口相关指令">窗口相关指令</h2><p>gdb 自带的显示界面为 <strong>TUI</strong> , 通过在gdb中输入不同的指令可以开启多个窗口查看不同的内容，方便调试，常用的命令为：</p><table><thead><tr class="header"><th style="text-align: center;">命令</th><th style="text-align: center;">功能</th></tr></thead><tbody><tr class="odd"><td style="text-align: center;"><code>layout src</code></td><td style="text-align: center;">显示源代码窗口</td></tr><tr class="even"><td style="text-align: center;"><code>layout regs</code></td><td style="text-align: center;">显示寄存器窗口</td></tr><tr class="odd"><td style="text-align: center;"><code>layout asm</code></td><td style="text-align: center;">显示汇编代码窗口</td></tr><tr class="even"><td style="text-align: center;"><code>layout split</code></td><td style="text-align: center;">显示源代码和汇编窗口</td></tr><tr class="odd"><td style="text-align: center;"><code>refresh</code></td><td style="text-align: center;">刷新所有窗口</td></tr><tr class="even"><td style="text-align: center;"><code>focus cmd/src</code></td><td style="text-align: center;">切换当前关注窗口</td></tr></tbody></table><h2 id="程序运行指令">程序运行指令</h2><table><thead><tr class="header"><th style="text-align: center;">命令</th><th style="text-align: center;">功能</th></tr></thead><tbody><tr class="odd"><td style="text-align: center;"><code>r</code></td><td style="text-align: center;">运行程序</td></tr><tr class="even"><td style="text-align: center;"><code>c</code></td><td style="text-align: center;">运行程序到下一个断点</td></tr></tbody></table><p>当程序开始运行后，我们可以使用下面的指令逐步运行程序。 <div class="note warning flat"><p>必须是程序运行起来后，才能逐步运行程序，否则会出现 <strong>The program is not being run</strong> 的错误。</p></div></p><table><thead><tr class="header"><th style="text-align: center;">命令</th><th style="text-align: center;">功能</th></tr></thead><tbody><tr class="odd"><td style="text-align: center;"><code>n</code></td><td style="text-align: center;">单行运行</td></tr><tr class="even"><td style="text-align: center;"><code>s</code></td><td style="text-align: center;">单步运行</td></tr></tbody></table><h2 id="断点">断点</h2><p>我们可以设置，查看，删除断点来帮助调试程序。</p><table><thead><tr class="header"><th style="text-align: center;">命令</th><th style="text-align: center;">功能</th></tr></thead><tbody><tr class="odd"><td style="text-align: center;"><code>b {number of line}</code></td><td style="text-align: center;">在某行设置断点</td></tr><tr class="even"><td style="text-align: center;"><code>b {function name}</code></td><td style="text-align: center;">在函数开始处设置断点</td></tr><tr class="odd"><td style="text-align: center;"><code>info b</code></td><td style="text-align: center;">查看断点</td></tr><tr class="even"><td style="text-align: center;"><code>d</code></td><td style="text-align: center;">删除所有断点</td></tr><tr class="odd"><td style="text-align: center;"><code>d {nubmer}</code></td><td style="text-align: center;">删除指定断点</td></tr><tr class="even"><td style="text-align: center;"><code>enable {nubmer}</code></td><td style="text-align: center;">启用指定断点</td></tr><tr class="odd"><td style="text-align: center;"><code>disable {nubmer}</code></td><td style="text-align: center;">禁止指定断点</td></tr></tbody></table><h2 id="显示相关指令">显示相关指令</h2><p>指令 <code>l</code> 可以在窗口显示当前 10 行的源代码， 如果出现 <strong>no read file</strong> 的报错，是因为在 <code>cmake</code> 的时候没有选择加入 <code>-DCMAKE_BUILD_TYPE=Debug</code> 的选项导致生成的可执行文件不能用于调试。 同时，我们还可以利用<code>p</code>打印变量的值，或者利用<code>display</code>方便地跟踪查看变量, 和<code>x</code>查看内存的值。</p><table><thead><tr class="header"><th style="text-align: center;">命令</th><th style="text-align: center;">功能</th></tr></thead><tbody><tr class="odd"><td style="text-align: center;"><code>p {variables}</code></td><td style="text-align: center;">打印输出某个变量的值</td></tr><tr class="even"><td style="text-align: center;"><code>display {variables}</code></td><td style="text-align: center;">跟踪该变量，每次运行都输出该变量的值</td></tr><tr class="odd"><td style="text-align: center;"><code>undisplay {number}</code></td><td style="text-align: center;">取消跟踪该变量</td></tr><tr class="even"><td style="text-align: center;"><code>x {address}</code></td><td style="text-align: center;">跟踪该内存地址的值</td></tr></tbody></table><h1 id="references">References</h1><ul><li><a href="https://blog.csdn.net/lemonaha/article/details/72837561" target="_blank" rel="noopener">CMake生成可用gdb调试的可执行文件</a></li><li><a href="https://blog.csdn.net/LF_2016/article/details/54172864" target="_blank" rel="noopener">GDB调试指南(初级)</a></li><li><a href="https://blog.csdn.net/hiawui/article/details/6173107" target="_blank" rel="noopener">gdb查看源代码</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Programming </category>
          
          <category> C++ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>A Kinematic Simulator of Autonomous Vehicles in Pygame</title>
      <link href="/2019/06/25/kinematic-simulator-of-autonomous-vehicles-of-pygame/"/>
      <url>/2019/06/25/kinematic-simulator-of-autonomous-vehicles-of-pygame/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><h1 id="pygame-initialization">Pygame Initialization</h1><p>在使用<strong>PyGame</strong>模块的所有功能之前，应当使用<code>pygame.init()</code>初始化 <strong>PyGame</strong>。<br> 使用<code>pip</code>安装好对应版本的<strong>PyGame</strong>， 创建一个新的 <code>main.py</code>文件，并输入以下代码初始化 <strong>PyGame</strong>。 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> pygame<br><br><span class="hljs-comment"># For using key value of keyboard</span><br><span class="hljs-keyword">from</span> pygame.locals <span class="hljs-keyword">import</span> *<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>:</span><br>    pygame.init()<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:<br>    main()<br></code></pre></td></tr></table></figure></p><h1 id="pygame-object-construction">Pygame Object Construction</h1><h2 id="screen-object">Screen Object</h2><p>初始化 <strong>PyGame</strong> 后，第一件事情应该是创建一个屏幕对象用以显示接下来仿真环境所需要的各种对象。在使用面向对象的编程方法中，可以设置一个<code>Game</code>的类用于存放 <strong>PyGame</strong> 的各种对象，屏幕对象也以成员变量的方式存放在其中。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Game</span>:</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self)</span>:</span><br>        pygame.init()<br>        pygame.display.set_caption(<span class="hljs-string">"Vehicle Simulation"</span>)<br>        width = <span class="hljs-number">1920</span><br>        height = <span class="hljs-number">960</span><br>        self.screen = pygame.display.set_mode((width, height))<br>        self.clock = pygame.time.Clock()<br>        self.ticks = <span class="hljs-number">30</span><br>        self.exit = <span class="hljs-literal">False</span><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:<br>    game = Game()<br></code></pre></td></tr></table></figure><p>运行上面代码后，可以看到一个黑色的屏幕一闪而过，那是因为代码运行到最后一行便自动结束了程序。因此，我们可以在 <code>Game</code>的类中添加函数作为游戏主循环。</p><h2 id="game-loop">Game Loop</h2><p>所有的事件或者动作，都发生在游戏主循环内（如刷新屏幕，更新对象状态），因此应当确保有合理的手段退出游戏主循环，否则该循环将一直保持下去。我们可以通过捕获键盘的按键或者关闭窗口的事件来终止游戏主循环。为了捕获事件，我们调用<code>pygame.event.get()</code>函数，该函数会返回一个列表，列表内存储了所有发生的事件，我们可以通过轮询该列表然后采取相应的操作。具体<strong>捕获事件并退出游戏主循环</strong>的代码如下所示：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python">   <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">run</span><span class="hljs-params">(self)</span>:</span><br>       <span class="hljs-comment"># Game loop</span><br>       <span class="hljs-keyword">while</span> <span class="hljs-keyword">not</span> self.exit:<br>           <span class="hljs-comment"># Set tick</span><br>           dt = self.clock.get_time() / <span class="hljs-number">1000</span><br>           self.clock.tick(self.ticks)<br><br>           <span class="hljs-comment"># Event queue</span><br>           <span class="hljs-keyword">for</span> event <span class="hljs-keyword">in</span> pygame.event.get():<br>               <span class="hljs-keyword">if</span> event.type == pygame.QUIT:<br>                   self.exit = <span class="hljs-literal">True</span><br>               <span class="hljs-keyword">elif</span> event.type == pygame.KEYDOWN:<br>                   <span class="hljs-keyword">if</span> event.key == pygame.K_ESCAPE:<br>                       self.exit = <span class="hljs-literal">True</span><br>pygame.quit()<br></code></pre></td></tr></table></figure><h2 id="surface-and-rect">Surface and Rect</h2><p>Surface 和 Rect 对象是 <strong>PyGame</strong> 的基础对象。Surface 对象可以被理解为空白画布，我们在 Surface 对象上填充想要的图案，Screen 其实也是一个 Surface 对象。而 Rect 对象则代表了 Surface 对象 的位置及其包含的区域。在后续的汽车对象中，为了显示及刷新车辆的坐标，我们需要用到 Surface 和 Rect 对象。下面代码是一个简单的例子： <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># Create the surface and pass in a tuple with its length and width</span><br>surf = pygame.Surface((<span class="hljs-number">50</span>, <span class="hljs-number">50</span>))<br><span class="hljs-comment"># Give the surface a color to differentiate it from the background</span><br>surf.fill((<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>))<br>rect = surf.get_rect()<br></code></pre></td></tr></table></figure></p><h2 id="blit-and-flip">Blit and Flip</h2><p><code>blit</code> 和 <code>flip</code> 是两个在 <strong>PyGame</strong> 中很重要的方法，<code>blit</code> 方法以 <strong>Surface</strong> 和 <strong>位置</strong> 作为输入，将输入的 <strong>Surface</strong> 显示在指定的<strong>位置</strong>上。<code>pygame.display.flip()</code> 则是所有在屏幕上的对象，以改变上一次<code>pygame.display.flip()</code>显示的内容。 在使用了<code>blit</code>之后还需要调用<code>flip</code>才能刷新图像，但是使用<code>blit</code>看不到想要的结果。 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># This line says "Draw surf onto screen at coordinates x:400, y:300"</span><br>screen.blit(surf, (<span class="hljs-number">400</span>, <span class="hljs-number">300</span>))<br>pygame.display.flip()<br></code></pre></td></tr></table></figure></p><h1 id="vehicle-object-construction">Vehicle Object Construction</h1><h2 id="sprite">Sprite</h2><p><strong>PyGame</strong> 提供了基类<code>Sprite</code>用于构建对象在 Screen 上表示 2D 的图像。我们拓展<code>Sprite</code>类来构建我们自己的对象 <strong>Vehicle</strong> ，该对象只有 <strong>self.image</strong> (其实就是 <strong>Surface</strong> 对象) 和 <strong>self.rect</strong> 两个成员变量。 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Vehicle</span><span class="hljs-params">(pygame.sprite.Sprite)</span>:</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self, </span></span><br><span class="hljs-function"><span class="hljs-params"> image_path)</span>:</span><br>        <span class="hljs-comment"># Call Sprite __init__ function</span><br>        super(Vehicle, self).__init__()<br><br>        <span class="hljs-comment"># Pygame parameters</span><br>        self.image = self.ori_image = pygame.image.load(image_path)  <span class="hljs-comment"># Use origin image for rotation</span><br>        self.rect = self.image.get_rect()<br></code></pre></td></tr></table></figure> 有了 <strong>self.image</strong> 和 <strong>self.rect</strong> ，只要加上<code>blit</code>和<code>flip</code>方法就可以在 Screen 上显示图像。</p><h2 id="vehicle-parameters">Vehicle parameters</h2><p>为了提供车辆运动学的仿真，我们还需要定义车辆的参数，因为没有涉及到动力学的内容，所以不需要定义与力相关的参数。与阿克曼转向几何相关的参数为车的<strong>轴距</strong>和<strong>最大轮胎转向角度</strong>，因此这两个参数是最重要的参数。同时还会有车辆速度，加速度，角速度等参数。完整的 <strong>Vehicle</strong> 类的成员变量定义如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># Vehicle contains parameters of vehicles and provides</span><br><span class="hljs-comment"># a method to update the status of vehicles.</span><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Vehicle</span><span class="hljs-params">(pygame.sprite.Sprite)</span>:</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self, x, y, image_path,</span></span><br><span class="hljs-function"><span class="hljs-params">                 angle=<span class="hljs-number">0.0</span>,</span></span><br><span class="hljs-function"><span class="hljs-params">                 length=<span class="hljs-number">4</span>,</span></span><br><span class="hljs-function"><span class="hljs-params">                 max_steering=<span class="hljs-number">30</span>,</span></span><br><span class="hljs-function"><span class="hljs-params">                 max_acceleration=<span class="hljs-number">5.0</span>)</span>:</span><br>        <span class="hljs-comment"># Call Sprite __init__ function</span><br>        super(Vehicle, self).__init__()<br><br>        <span class="hljs-comment"># Pygame parameters</span><br>        self.image = self.ori_image = pygame.image.load(image_path)  <span class="hljs-comment"># Use origin image for rotation</span><br>        self.rect = self.image.get_rect()<br><br>        <span class="hljs-comment"># Vehicle parameters</span><br>        self.position = Vector2(x, y)<br>        self.velocity = Vector2(<span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>)<br>        self.angle = angle<br>        self.length = length<br>        self.max_acceleration = max_acceleration<br>        self.max_steering = max_steering<br>        self.max_velocity = <span class="hljs-number">20</span><br>        self.brake_deceleration = <span class="hljs-number">10</span><br>        self.free_deceleration = <span class="hljs-number">2</span><br><br>        self.acceleration = <span class="hljs-number">0.0</span><br>        self.steering = <span class="hljs-number">0.0</span><br></code></pre></td></tr></table></figure><h2 id="vehicle-update-logic">Vehicle update logic</h2><p>在进入一次 Game Loop 中，都会调用一次<code>update</code>方法去更新车辆的位置和朝向。 <strong>更新方法：</strong>，通过计算车辆计算加速度与离散时间 dt 的乘积得到车辆速度。然后通过车辆速度，轴距，dt， 根据<a href="https://sophistt.github.io/2019/06/14/ackman-geometrics-and-pure-pursuit-algorithm/"><strong>阿克曼几何</strong></a>计算出车辆位置和车头朝向，最后调用<code>pygame.transform.rotate()</code>方法将Surface旋转合适的角度。 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">update</span><span class="hljs-params">(self, dt)</span>:</span><br>    <span class="hljs-comment"># Logic update</span><br>    self.velocity += (self.acceleration * dt, <span class="hljs-number">0</span>)<br>    self.velocity.x = max(-self.max_velocity, min(self.velocity.x, self.max_velocity))<br><br>    <span class="hljs-keyword">if</span> self.steering:<br>        turning_radius = self.length / tan(radians(self.steering))<br>        angular_velocity = self.velocity.x / turning_radius<br>    <span class="hljs-keyword">else</span>:<br>        angular_velocity = <span class="hljs-number">0</span><br><br>    self.position += self.velocity.rotate(-self.angle) * dt<br>    self.angle += degrees(angular_velocity) * dt<br><br>    <span class="hljs-comment"># Image update</span><br>    self.image = pygame.transform.rotate(self.ori_image, self.angle)<br>    self.rect = self.image.get_rect()<br></code></pre></td></tr></table></figure></p><h1 id="draw-line-fo-lane">Draw Line fo Lane</h1><p>例程构建了一个 1920 * 960 像素的 Screen，同时每 32 个像素代表 1 米的距离，即整个屏幕代表了 60 * 30 的范围。 标准车道宽度为 3.5 米，但是有实线和虚线之分，我们通过调用<code>pygame.gfxdraw.line()</code>方法在 Game Loop 中绘制车道线即可。 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># Draw road line</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">drawRoadLine</span><span class="hljs-params">(self)</span>:</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">20</span>):<br>        pygame.gfxdraw.line(self.screen, <span class="hljs-number">100</span> * i, <span class="hljs-number">480</span>, <span class="hljs-number">100</span> * i + <span class="hljs-number">50</span>, <span class="hljs-number">480</span>, (<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>))<br>    pygame.gfxdraw.line(self.screen, <span class="hljs-number">0</span>, <span class="hljs-number">368</span>, <span class="hljs-number">1920</span>, <span class="hljs-number">368</span>, (<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>))<br>    pygame.gfxdraw.line(self.screen, <span class="hljs-number">0</span>, <span class="hljs-number">592</span>, <span class="hljs-number">1920</span>, <span class="hljs-number">592</span>, (<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>))<br></code></pre></td></tr></table></figure></p><h1 id="full-code-and-example">Full Code and Example</h1><h2 id="part-of-code">Part of code</h2><p>将上面的代码整合一下，可以得到完整的<code>run</code>函数。 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">run</span><span class="hljs-params">(self)</span>:</span><br>    ppu = <span class="hljs-number">32</span>  <span class="hljs-comment"># Pixel per unit</span><br><br>    all_sprites = pygame.sprite.Group()  <span class="hljs-comment"># Create a new sprite group</span><br><br>    <span class="hljs-comment"># Get image path</span><br>    current_dir = os.path.dirname(os.path.abspath(__file__))<br>    image_path = os.path.join(current_dir, <span class="hljs-string">"image/car.png"</span>)<br>    obstacle_path = os.path.join(current_dir, <span class="hljs-string">"image/obstacle.png"</span>)<br><br>    <span class="hljs-comment"># Register sprites</span><br>    vehicle = Vehicle(<span class="hljs-number">2</span>, <span class="hljs-number">16.75</span>, image_path)<br>    all_sprites.add(vehicle)<br><br>    obstacle = Vehicle(<span class="hljs-number">22</span>, <span class="hljs-number">16.75</span>, obstacle_path)<br>    all_sprites.add(obstacle)<br><br>    <span class="hljs-comment"># Pure pursuit for trajectory</span><br>    purepursuit = PurePursuit()<br><br>    <span class="hljs-comment"># Game loop</span><br>    <span class="hljs-keyword">while</span> <span class="hljs-keyword">not</span> self.exit:<br>        <span class="hljs-comment"># Set tick</span><br>        dt = self.clock.get_time() / <span class="hljs-number">1000</span><br>        self.clock.tick(self.ticks)<br><br>        <span class="hljs-comment"># Event queue</span><br>        <span class="hljs-keyword">for</span> event <span class="hljs-keyword">in</span> pygame.event.get():<br>            <span class="hljs-keyword">if</span> event.type == pygame.QUIT:<br>                self.exit = <span class="hljs-literal">True</span><br>            <span class="hljs-keyword">elif</span> event.type == pygame.KEYDOWN:<br>                <span class="hljs-keyword">if</span> event.key == pygame.K_ESCAPE:<br>                    self.exit = <span class="hljs-literal">True</span><br>        <br>        <span class="hljs-comment"># Set velocity of obstacle</span><br>        obstacle.velocity.x = <span class="hljs-number">3</span><br>        <span class="hljs-comment"># Path Plan and purepursuit</span><br><br>        <span class="hljs-comment"># Compute hermite curve</span><br>        curPoint = vehicle.position<br>        aPoint = PathPlan.searchGoalPoint(curPoint, obstacle)<br>        path = PathPlan.hermite(curPoint, aPoint, <span class="hljs-number">0</span>)<br>        <br>        <span class="hljs-comment"># Compute angle to avoid obstacles</span><br>        vehicle.angle = -purepursuit.trajectoryTracking(path, vehicle.position, vehicle.angle)<br>        vehicle.acceleration = <span class="hljs-number">3</span><br><br>        <span class="hljs-comment"># Drawing</span><br>        self.screen.fill((<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>))<br>        self.drawRoadLine()<br><br>        <span class="hljs-keyword">for</span> entity <span class="hljs-keyword">in</span> all_sprites:<br>            entity.update(dt)  <span class="hljs-comment"># Update of logic and image</span><br>            self.screen.blit(entity.image, entity.position * ppu - (entity.rect.width / <span class="hljs-number">2</span>, entity.rect.height / <span class="hljs-number">2</span>))<br><br>        <span class="hljs-comment"># Draw plan path</span><br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(len(path)):<br>            self.screen.set_at([int(ppu * path[i].x), int(ppu * path[i].y)], (<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>))<br><br>        pygame.display.flip()<br>    pygame.quit()<br></code></pre></td></tr></table></figure> 具体效果如下面的 Example 所示。<a href="https://github.com/Sophistt/Small_Projects/blob/master/vehicle_simulator/simulation.py" target="_blank" rel="noopener">完整代码</a></p><h2 id="example">Example</h2><div data-align="center"><p><img height="50%" width="50%" src= "/img/loading.gif" data-lazy-src="https://i.imgur.com/rgfhNGm.gif" title="example"/><br> gif卡顿是因为录制帧率太低，与PyGame和代码无关。</p></div><h1 id="references">References</h1><ul><li><a href="https://realpython.com/pygame-a-primer/" target="_blank" rel="noopener">PyGame – A Primer</a></li><li><a href="http://rmgi.blog/pygame-2d-car-tutorial.html" target="_blank" rel="noopener">pygame 2d car tutorial</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Programming </category>
          
          <category> Python </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Configuration and Bundle Management of vim</title>
      <link href="/2019/06/24/vim-configuration-and-bundle-mangement/"/>
      <url>/2019/06/24/vim-configuration-and-bundle-mangement/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p>Vim是一个高度可配置的文本编辑器，旨在使创建和更改任何类型的文本非常高效。在大多数UNIX系统和Apple OS X中，它都包含为“ vi”。</p><h1 id="configuration">Configuration</h1><h2 id="vim-安装">Vim 安装</h2><p>Ubuntu 默认安装了vim-tiny，在终端中输入<code>vim --version</code>可以查看当前vim的版本。要安装完整版的vim，在bash中输入 <code>sudo apt-get install vim-basic</code> 即可。</p><h2 id="vim-更新">Vim 更新</h2><p>目前最新的vim 版本是8.1,在终端中<strong>添加ppa源</strong>后即可更新vim。 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo add-apt-repository pa:jonathonf/vim<br>sudo apt update<br>sudo apt install vim<br></code></pre></td></tr></table></figure></p><h2 id="vim-基础配置">Vim 基础配置</h2><p>创建<code>~/.vimrc</code>，在该文件内加入相关vim的配置。 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs bash"><br><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><br><span class="hljs-string">"Personal configuration"</span><br><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><br><span class="hljs-string">"Remove consistency of vi"</span><br><span class="hljs-built_in">set</span> nocompatible<br><span class="hljs-built_in">set</span> number <span class="hljs-string">"Display row number"</span><br><span class="hljs-string">"Hide rolling"</span>    <br><span class="hljs-built_in">set</span> guioptions-=r <br><span class="hljs-built_in">set</span> guioptions-=L<br><span class="hljs-built_in">set</span> guioptions-=b<br><span class="hljs-built_in">set</span> showtabline=0 <span class="hljs-string">"Hide top bar"</span><br><span class="hljs-built_in">set</span> guifont=Monaco:h13  <span class="hljs-string">"Set font"</span>  <br>syntax on   <span class="hljs-string">"syntax highlight"</span><br><span class="hljs-built_in">set</span> nowrap  <span class="hljs-string">"Don't hide lines automatically"</span><br><span class="hljs-built_in">set</span> fileformat=unix <span class="hljs-string">"Save file in unix format"</span><br><span class="hljs-built_in">set</span> cindent     <span class="hljs-string">"ÉèÖÃCÑùÊ½µÄËõ½ø¸ñÊ½"</span><br><span class="hljs-built_in">set</span> autoindent<br><span class="hljs-built_in">set</span> showmatch   <span class="hljs-string">"Show the matching pairs"</span><br><span class="hljs-built_in">set</span> scrolloff=5     <br><span class="hljs-built_in">set</span> laststatus=2    <span class="hljs-string">"Set commad line as two lines"</span><br><span class="hljs-built_in">set</span> fenc=utf-8      <span class="hljs-string">"Unicode"</span><br><span class="hljs-built_in">set</span> backspace=2<br><span class="hljs-built_in">set</span> mouse=a     <span class="hljs-string">"Use mouse"</span><br><span class="hljs-built_in">set</span> selection=exclusive<br><span class="hljs-built_in">set</span> selectmode=mouse,key<br><span class="hljs-built_in">set</span> matchtime=5<br><span class="hljs-built_in">set</span> incsearch<br><span class="hljs-built_in">set</span> hlsearch        <span class="hljs-string">"Highlight the searching item"</span><br><span class="hljs-built_in">set</span> noexpandtab     <span class="hljs-string">"Prohibit extend table"</span><br><span class="hljs-built_in">set</span> whichwrap+=&lt;,&gt;,h,l<br><span class="hljs-built_in">set</span> autoread<br><span class="hljs-built_in">set</span> cursorline      <span class="hljs-string">"Highlight current row"</span><br><span class="hljs-built_in">set</span> cursorcolumn        <span class="hljs-string">"Highlight current column"</span><br></code></pre></td></tr></table></figure></p><h2 id="vim-pyhton-配置">Vim Pyhton 配置</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><br><span class="hljs-string">"Python setting"</span><br><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><br>au BufNewFile,BufRead *.py<br>\<span class="hljs-built_in">set</span> tabstop=4<br>\<span class="hljs-built_in">set</span> softtabstop=4<br>\<span class="hljs-built_in">set</span> shiftwidth=4<br>\<span class="hljs-built_in">set</span> textwidth=100<br>\<span class="hljs-built_in">set</span> expandtab<br></code></pre></td></tr></table></figure><h2 id="vim-主题配置">Vim 主题配置</h2><p>vim 的配色方案文件存放在<code>~/.vim/colors</code>文件夹中（没有则创建一个）。以<a href="https://github.com/liuchengxu/space-vim-dark/tree/master/colors" target="_blank" rel="noopener"><strong>space-vim-dark</strong></a>配色方案为例， 下载<strong>space-vim-dark.vim</strong>存放到<code>~/.vim/colors</code>文件夹内，然后修改<code>~/.vimrc</code>启用该配色方案。 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">set</span> background=dark     <span class="hljs-string">"ÉèÖÃ±³¾°É«"</span><br>colorscheme space-vim-dark<br><span class="hljs-string">"change comment color"</span><br><span class="hljs-string">"highlight Comment ctermfg=green guifg=green"</span><br></code></pre></td></tr></table></figure></p><h1 id="insert-template">Insert Template</h1><p>如果想要在新建某类型的文件(如.cpp, .sh)的时候自动插入模板，可以在 <code>~/.vimrc</code> 里面采用 <code>autocmad</code> 命令进行设置。</p><h2 id="cc-模板">C/C++ 模板</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs bash">autocmd BufNewFile *.[ch],*.hpp,*.cpp <span class="hljs-built_in">exec</span> <span class="hljs-string">":call SetTitle()"</span> <br><br><span class="hljs-string">" Title function </span><br><span class="hljs-string">func SetTitle()</span><br><span class="hljs-string">call SetComment()</span><br><span class="hljs-string">if expand("</span>%:e<span class="hljs-string">") == 'hpp' </span><br><span class="hljs-string">call append(line("</span>.<span class="hljs-string">")+10, "</span><span class="hljs-comment">#ifndef _".toupper(expand("%:t:r"))."_H") </span><br>call append(line(<span class="hljs-string">"."</span>)+11, <span class="hljs-string">"#define _"</span>.toupper(expand(<span class="hljs-string">"%:t:r"</span>)).<span class="hljs-string">"_H"</span>) <br>call append(line(<span class="hljs-string">"."</span>)+12, <span class="hljs-string">"#ifdef __cplusplus"</span>) <br>call append(line(<span class="hljs-string">"."</span>)+13, <span class="hljs-string">"extern \"C\""</span>) <br>call append(line(<span class="hljs-string">"."</span>)+14, <span class="hljs-string">"&#123;"</span>) <br>call append(line(<span class="hljs-string">"."</span>)+15, <span class="hljs-string">"#endif"</span>) <br>call append(line(<span class="hljs-string">"."</span>)+16, <span class="hljs-string">""</span>) <br>call append(line(<span class="hljs-string">"."</span>)+17, <span class="hljs-string">"#ifdef __cplusplus"</span>) <br>call append(line(<span class="hljs-string">"."</span>)+18, <span class="hljs-string">"&#125;"</span>) <br>call append(line(<span class="hljs-string">"."</span>)+19, <span class="hljs-string">"#endif"</span>) <br>call append(line(<span class="hljs-string">"."</span>)+20, <span class="hljs-string">"#endif //"</span>.toupper(expand(<span class="hljs-string">"%:t:r"</span>)).<span class="hljs-string">"_H"</span>) <br> <br>elseif expand(<span class="hljs-string">"%:e"</span>) == <span class="hljs-string">'h'</span> <br>  call append(line(<span class="hljs-string">"."</span>)+10, <span class="hljs-string">"#pragma once"</span>) <br>elseif expand(<span class="hljs-string">"%:e"</span>) == <span class="hljs-string">'c'</span> <br>  call append(line(<span class="hljs-string">"."</span>)+10,<span class="hljs-string">"#include \""</span>.expand(<span class="hljs-string">"%:t:r"</span>).<span class="hljs-string">".h\""</span>) <br>elseif expand(<span class="hljs-string">"%:e"</span>) == <span class="hljs-string">'cpp'</span> <br>  call append(line(<span class="hljs-string">"."</span>)+10, <span class="hljs-string">"#include \""</span>.expand(<span class="hljs-string">"%:t:r"</span>).<span class="hljs-string">".h\""</span>) <br>endif<br>endfunc<br><br><span class="hljs-string">" Comment function </span><br><span class="hljs-string">func SetComment()</span><br><span class="hljs-string">call setline(1,"</span>/*================================================================<span class="hljs-string">") </span><br><span class="hljs-string">call append(line("</span>.<span class="hljs-string">"),   "</span>*   Copyright (C) <span class="hljs-string">".strftime("</span>%Y<span class="hljs-string">")."</span> Sangfor Ltd. All rights reserved.<span class="hljs-string">")</span><br><span class="hljs-string">call append(line("</span>.<span class="hljs-string">")+1, "</span>*   <span class="hljs-string">") </span><br><span class="hljs-string">call append(line("</span>.<span class="hljs-string">")+2, "</span>*   @file:<span class="hljs-string">" .expand("</span>%:t<span class="hljs-string">")) </span><br><span class="hljs-string">call append(line("</span>.<span class="hljs-string">")+3, "</span>*   @author: Sophistt<span class="hljs-string">")</span><br><span class="hljs-string">call append(line("</span>.<span class="hljs-string">")+4, "</span>*   @date:<span class="hljs-string">" .strftime("</span>%Y-%m-%d %H:%M<span class="hljs-string">")) </span><br><span class="hljs-string">call append(line("</span>.<span class="hljs-string">")+5, "</span>*   @description: <span class="hljs-string">") </span><br><span class="hljs-string">call append(line("</span>.<span class="hljs-string">")+6, "</span>*<span class="hljs-string">")</span><br><span class="hljs-string">call append(line("</span>.<span class="hljs-string">")+7, "</span>================================================================*/<span class="hljs-string">") </span><br><span class="hljs-string">call append(line("</span>.<span class="hljs-string">")+8, "</span><span class="hljs-string">")</span><br><span class="hljs-string">call append(line("</span>.<span class="hljs-string">")+9, "</span><span class="hljs-string">")</span><br><span class="hljs-string">endfunc</span><br></code></pre></td></tr></table></figure><h2 id="sh-模板">sh 模板</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-string">" Insert title for *.sh file</span><br><span class="hljs-string">autocmd BufNewFile *.sh call AddFileInformation_sh()</span><br><span class="hljs-string">function AddFileInformation_sh()</span><br><span class="hljs-string">      let infor = "</span><span class="hljs-comment">#!/bin/bash\n"</span><br>      \.<span class="hljs-string">"\n"</span><br>      \.<span class="hljs-string">"# ***************************************************************************\n"</span><br>      \.<span class="hljs-string">"# * @Copyright (c)  all right reserved \n"</span><br>      \.<span class="hljs-string">"# * \n"</span><br>      \.<span class="hljs-string">"# * @file:"</span>.expand(<span class="hljs-string">"%"</span>).<span class="hljs-string">" \n"</span><br>      \.<span class="hljs-string">"# * @author: Sophistt \n"</span><br>      \.<span class="hljs-string">"# * @date:"</span>.strftime(<span class="hljs-string">"%Y-%m-%d %H:%M"</span>).<span class="hljs-string">" \n"</span><br>      \.<span class="hljs-string">"# * @description: Shell script \n"</span><br>      \.<span class="hljs-string">"#* \n"</span><br>      \.<span class="hljs-string">"#**************************************************************************/ \n"</span><br>      \.<span class="hljs-string">"\n"</span><br>      \.<span class="hljs-string">"\n"</span><br>      \.<span class="hljs-string">"\n"</span><br>      \.<span class="hljs-string">"\n"</span><br>      \.<span class="hljs-string">"exit 0"</span><br>      silent  put! =infor<br>endfunction<br></code></pre></td></tr></table></figure><h1 id="bundle-management">Bundle Management</h1><p>Vundle 是 Vim 的插件管理器，通过Vundle可以方便的安装和管理其他各种好用的vim 插件。</p><h2 id="vundle-安装">Vundle 安装</h2><p>在终端中输入以下指令克隆vundle仓库到本地。 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git <span class="hljs-built_in">clone</span> https://github.com/VundleVim/Vundle.vim.git ~/.vim/bundle/Vundle.vim<br></code></pre></td></tr></table></figure> 然后加入下面的内容到<code>~/.vimrc</code>，添加vundle支持。最后在终端中打开vim，输入<code>:PluginInstall</code>完成vundle插件安装。 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">"</span><br><span class="hljs-string">"</span>Vundle<span class="hljs-string">"</span><br><span class="hljs-string">"</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><br>filetype off<br><span class="hljs-built_in">set</span> rtp+=~/.vim/bundle/Vundle.vim<br>call vundle<span class="hljs-comment">#begin()</span><br>Plugin <span class="hljs-string">'VundleVim/Vundle.vim'</span><br>call vundle<span class="hljs-comment">#end()</span><br>filetype plugin indent on<br></code></pre></td></tr></table></figure></p><h2 id="利用-vundle-管理插件">利用 Vundle 管理插件</h2><p>利用 vundle 安装别的插件，只需要在<code>~/.vimrc</code>中的 vundle 相关配置的位置加入插件仓库，然后打开 vim，输入<code>:PluginInstall</code>即可。<br> 以 <strong>NerdTree</strong> 为例： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">Plugin <span class="hljs-string">'scrooloose/nerdtree'</span><br></code></pre></td></tr></table></figure> 添加上述代码到<code>~/.vimrc</code>的合适位置，然后打开 vim ，输入<code>:PluginInstall</code>即可完成安装。</p><h1 id="bundle-recommended">Bundle Recommended</h1><h2 id="vim-powerline">vim-powerline</h2><p><strong>vim-powerline</strong> 是一款美化状态栏的插件，安装后可以看到好看的状态栏显示当前文件名，输入模式等。 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">Plugin <span class="hljs-string">'Lokaltog/vim-powerline'</span><br></code></pre></td></tr></table></figure></p><h2 id="nerdtree">NerdTree</h2><p><strong>NerdTree</strong> 是一款目录树插件，安装后可以在 vim 内打开目录树。 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">Plugin <span class="hljs-string">'scrooloose/nerdtree'</span><br></code></pre></td></tr></table></figure> 可以加入以下内容到<code>~/.vimrc</code>修改快捷键和忽略显示的文件后缀。 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><br><span class="hljs-string">"NERDTree"</span><br><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><br><span class="hljs-built_in">let</span> NERDTreeIgnore=[<span class="hljs-string">'\~$'</span>, <span class="hljs-string">'\.pyc$'</span>, <span class="hljs-string">'\.swp$'</span>]<br>map &lt;C-n&gt; :NERDTreeToggle&lt;CR&gt;<br></code></pre></td></tr></table></figure></p><h2 id="auto-pairs">auto-pairs</h2><p><strong>auto-pairs</strong>是自动匹配括号的插件，可以显示当前括号对应的另外一般括号。 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">Plugin <span class="hljs-string">'jiangmiao/auto-pairs'</span><br></code></pre></td></tr></table></figure></p><h2 id="youcompleteme">YouCompleteMe</h2><p><strong>YouCompleteMe</strong> 是 vim 下很好用的一款自动补全插件，但是其配置难度也很高，喜欢折腾的人可以配置，否则可以使用别的自动补全插件。</p><h3 id="安装-youcompleteme">安装 YouCompleteMe</h3><p>在<code>~/.vimrc</code>中加入<code>Plugin 'Valloric/YouCompleteMe'</code>，然后执行<code>:PluginInstall</code>进行安装。</p><h3 id="更新-youcompleteme">更新 YouCompleteMe</h3><p>在安装完成后，可能会出现 <em>no module named future</em> 等报错，此时需要进入到<code>~/.vim/bundle/YouCompleteMe</code>文件夹内，执行以下命令。 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">git submodule update --init --recursive<br></code></pre></td></tr></table></figure> 执行完后，打开 vim 后无 <em>no module named ...</em> 的报错则成功。</p><h3 id="编译-youcompleteme">编译 YouCompleteMe</h3><p>在未编译前，打开 vim 会有提示 <em>YouCompleteMe Server</em> 的错误，此时只需要在<code>~/.vim/bundle/YouCompleteMe</code>的目录下执行编译指令。 加入<code>--clang-completer</code> 是添加<strong>C++</strong>支持。编译成功后，打开 vim 应该再无报错的信息。 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">./install.py --clang-completer<br></code></pre></td></tr></table></figure> <div class="note info flat"><p>编译过程中，可能出现 <em>Download libclang-...-tar.gz2 error</em> 等下载的错误，这是因为网络的原因。 <strong>解决方法：</strong> 打开出现在错误信息中的链接，直接下载然后移动到 <code>./third_party/ycmd/</code> 对应的目录下，然后重新编译。</p></div></p><h3 id="启用-youcompleteme">启用 YouCompleteMe</h3><p>将 YouCompleteMe 相关配置加入到<code>~/.vimrc</code>中。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><br><span class="hljs-string">"YouCompleteMe Setting"</span><br><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><span class="hljs-string">""</span><br><span class="hljs-string">"Set ycm_extra_conf path"</span><br><span class="hljs-built_in">let</span> g:ycm_global_ycm_extra_conf = <span class="hljs-string">'~/.ycm_extra_conf.py'</span><br><span class="hljs-string">"Do not ask whether loading ycm_extra_conf automatically again"</span><br><span class="hljs-built_in">let</span> g:ycm_confirm_extra_conf=0<br><span class="hljs-built_in">set</span> completeopt=longest,menu<br><span class="hljs-string">"Set python interpreter"</span><br><span class="hljs-built_in">let</span> g:ycm_path_to_python_interpreter=<span class="hljs-string">'/usr/bin/python'</span><br><span class="hljs-string">"Set open auto-completer"</span><br><span class="hljs-built_in">let</span> g:ycm_seed_identifiers_with_syntax=1<br><span class="hljs-string">"Set open auto-completer in comments"</span><br><span class="hljs-built_in">let</span> g:ycm_complete_in_comments=1<br><span class="hljs-built_in">let</span> g:ycm_collect_identifiers_from_comments_and_strings = 0<br><span class="hljs-string">"Set the number of characters for situation beginning auto-complete"</span><br><span class="hljs-built_in">let</span> g:ycm_min_num_of_chars_for_completion=2<br><span class="hljs-string">"Set closing window automatically after auto-complete"</span><br><span class="hljs-built_in">let</span> g:ycm_autoclose_preview_window_after_completion=1<br><span class="hljs-string">"Forbid cache"</span><br><span class="hljs-built_in">let</span> g:ycm_cache_omnifunc=0<br><span class="hljs-string">"Set open auto-complete in strings"</span><br><span class="hljs-built_in">let</span> g:ycm_complete_in_strings = 1<br><span class="hljs-string">"Set closing window automatically after leaving insert mode"</span><br>autocmd InsertLeave * <span class="hljs-keyword">if</span> pumvisible() == 0|pclose|endif<br></code></pre></td></tr></table></figure><h3 id="python-自动补全">Python 自动补全</h3><p>编译通过后，正常情况下已经可以自动补全系统内的 Python 库，但是<strong>无法自动补全如 virtualeenv, conda 等环境内的 Python 库</strong>，需要将他们的路径加入到 <strong>PYTHONPATH</strong> 才可以完成自动补全。修改<code>~/.bashrc</code>文件即可。 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">export</span> PYTHONPATH=<span class="hljs-string">'path/to/env/lib/python3.x/site-packages:$PYTHONPATH'</span><br></code></pre></td></tr></table></figure></p><h3 id="c-自动补全">C++ 自动补全</h3><p>YouCompleteMe 的 C++ 自动补全需要利用到<code>.ycm_extra_conf.py</code>文件，当使用 vim 打开一个文件的时候，<strong>YouCompleteMe</strong> 插件会自动在当前目录及其上级目录搜索该文件，我们也可以在<code>~</code>目录下创建该文件备用。</p><p>复制<code>~/.vim/bundle/YouCompleteMe/third_party/ycmd/examples/.ycm_extra_conf.py</code> 到<code>~</code>目录下备用。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">cp ~/.vim/bundle/YouCompleteMe/third_party/ycmd/examples/.ycm_extra_conf.py ~/<br></code></pre></td></tr></table></figure><p>复制后，打开<code>.cpp</code>文件已经可以使用部分自动补全的功能，通过修改该文件<strong>flags</strong>部分可以添加自定义头文件路径。头文件的路径有顺序要求，顺序错误可能有错误发生导致无法自动补全，推荐的顺序如下： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-string">'-x'</span>, <span class="hljs-string">'c++'</span>,<br><span class="hljs-string">'-isystem'</span>, <span class="hljs-string">'/usr/include/c++/7.1.0'</span>,<br><span class="hljs-string">'-isystem'</span>, <span class="hljs-string">'/usr/include/c++/7.1.0/backward'</span>,<br><span class="hljs-string">'-isystem'</span>, <span class="hljs-string">'/usr/local/include'</span>,<br><span class="hljs-string">'-isystem'</span>, <span class="hljs-string">'/usr/include'</span>,<br></code></pre></td></tr></table></figure> 为了使用自定义的类和头文件，可以将<code>.ycm_extra_conf.py</code>复制到 C++ 项目空间内，然后加入头文件路径。</p><h3 id="c-自动跳转">C++ 自动跳转</h3><p>YouCompleteMe 的 C++ 带有自动跳转的功能，可以跳转到声明或者定义处，命令为：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">:YouCompleter GoToDeclaration<br>:YouCompleter GoToDefinition<br></code></pre></td></tr></table></figure><p>使用命令来进行跳转的话十分繁琐，因此可以使用快捷键映射将这两个命令绑定到常用快捷键下。 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">nnoremap gl :YcmCompleter GoToDeclaration&lt;CR&gt;<br>nnoremap gk :YcmCompleter GoToDefinition&lt;CR&gt;<br></code></pre></td></tr></table></figure></p><p>YouCompleteMe 还提供了前后跳转的功能，使用快捷键 <code>ctrl+o</code> 和 <code>ctrl+i</code> 来前后跳转。</p><h1 id="configuration-file-download">Configuration File Download</h1><ul><li><a href="https://github.com/Sophistt/Small_Projects/blob/master/vim_configuration/.vimrc" target="_blank" rel="noopener"><font size="4">.vimrc</font></a></li><li><a href="https://github.com/Sophistt/Small_Projects/blob/master/vim_configuration/.ycm_extra_conf.py" target="_blank" rel="noopener"><font size="4">.ycm_extra_conf.py</font></a></li></ul><h1 id="references">References</h1><ul><li><a href="https://www.jianshu.com/p/8d416ac4ad11" target="_blank" rel="noopener">使用Vim插件管理器Vundle</a></li><li><a href="https://github.com/liuchengxu/space-vim-dark" target="_blank" rel="noopener">space-vim-dark</a></li><li><a href="http://www.voidcn.com/article/p-zgivkggq-ta.html" target="_blank" rel="noopener">YouCompleteMe自动补全C语言大型项目 ycm</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Writing </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vim </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Multiple Publishers and Subscribers in ROS</title>
      <link href="/2019/06/17/ros-multi-publishers-and-subscribers-in-ros/"/>
      <url>/2019/06/17/ros-multi-publishers-and-subscribers-in-ros/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><p>Regularly, it is necessary to subscribe different topic messages and publish one or more messages in one ROS node. Therefore, we need to design a node which owns several publishers and/or subscribers. Sometimes we will even use multi-thread methods in C++.</p><h1 id="python">Python</h1><p>The following codes shows how to subscribe a topic message and publish another topic message in one node. This method utilizes reponsion mechanism, it will publish a message after it receive a topic message and finish dealing with it.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python</span><br><br><span class="hljs-keyword">import</span> rospy<br><span class="hljs-keyword">from</span> std_msgs.msg <span class="hljs-keyword">import</span> Float32<br><span class="hljs-keyword">from</span> customed_msgs.msg <span class="hljs-keyword">import</span> Gpsmsg<br><br>pub = rospy.Publisher(<span class="hljs-string">"/control_info"</span>, Float32, queue_size=<span class="hljs-number">10</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">gps_callback</span><span class="hljs-params">(message)</span>:</span><br>    <span class="hljs-keyword">global</span> pub<br>    lat, lon = message.lat, message.lon<br><br>    <span class="hljs-comment"># do something here</span><br><br>    msg = Float32()<br>    msg.data = <span class="hljs-number">10</span><br>    pub.publish(msg)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>:</span><br>    rospy.init_node(<span class="hljs-string">'talker'</span>, anonymous=<span class="hljs-literal">True</span>)<br><br>    gps_localization_sub = rospy.Subscriber(<span class="hljs-string">"/gps_info"</span>, Gpsmsg, gps_callback)<br><br>    rospy.spin()<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:<br>    <span class="hljs-keyword">try</span>:<br>        main()<br>    <span class="hljs-keyword">except</span> rospy.ROSInterruptException:<br>        <span class="hljs-keyword">pass</span><br></code></pre></td></tr></table></figure><p>If we have a <code>while</code> circulaiton and would like to do somthing periodically in it, meanwhile we have to subscribe different types of messages. We can use the following codes.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python</span><br><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><br><span class="hljs-string">"""</span><br><span class="hljs-string">Subscribe two control signals and use matplotlib to draw them dynamically for comparsion.</span><br><span class="hljs-string">"""</span><br><br><span class="hljs-keyword">import</span> rospy<br><span class="hljs-keyword">from</span> std_msgs.msg <span class="hljs-keyword">import</span> String, Float32<br><br><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">from</span> math <span class="hljs-keyword">import</span> *<br><br><br>count = <span class="hljs-number">0</span><br>angle_list = []<br>time_list = []<br><br>sCount = <span class="hljs-number">0</span><br>sAngle_list = []<br>sTime_list = []<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">draw_angle_callback</span><span class="hljs-params">(angle)</span>:</span><br>    <span class="hljs-keyword">global</span> angle_list, count, time_list<br><br>    <span class="hljs-keyword">if</span> len(angle_list) &gt; <span class="hljs-number">300</span>:<br>        angle_list.pop(<span class="hljs-number">0</span>)<br>        time_list.pop(<span class="hljs-number">0</span>)<br><br>    angle_list.append(angle.data)<br>    time_list.append(count)<br><br>    count += <span class="hljs-number">1</span><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">draw_sAngle_callback</span><span class="hljs-params">(sAngle)</span>:</span><br>    <span class="hljs-keyword">global</span> sCount, sAngle_list, sTime_list<br><br>    <span class="hljs-keyword">if</span> len(sAngle_list) &gt; <span class="hljs-number">300</span>:<br>        sAngle_list.pop(<span class="hljs-number">0</span>)<br>        sTime_list.pop(<span class="hljs-number">0</span>)<br><br>    sAngle_list.append(sAngle.data)<br>    sTime_list.append(sCount)<br><br>    sCount += <span class="hljs-number">1</span><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>:</span><br>    rospy.init_node(<span class="hljs-string">"draw_steering_angle"</span>, anonymous=<span class="hljs-literal">True</span>)<br>    steering_angle_sub = rospy.Subscriber(<span class="hljs-string">"/steering_angle"</span>, Float32, draw_angle_callback)<br>    steering_smooth_angle_sub = rospy.Subscriber(<span class="hljs-string">"/smooth_angle"</span>, Float32, draw_sAngle_callback)<br><br>    plt.ion() <span class="hljs-comment"># Start up the interacitve mode</span><br>    plt.figure(<span class="hljs-number">1</span>)<br><br>    <span class="hljs-keyword">while</span> <span class="hljs-keyword">not</span> rospy.is_shutdown():<br>        plt.clf()<br>        plt.ylim((<span class="hljs-number">-100</span>, <span class="hljs-number">100</span>))<br>        plt.plot(time_list, angle_list, <span class="hljs-string">'r'</span>,  linestyle=<span class="hljs-string">"--"</span>)<br>        plt.plot(sTime_list, sAngle_list, <span class="hljs-string">'-b'</span>)<br>        plt.pause(<span class="hljs-number">0.01</span>)<br><br>    rospy.spin()<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:<br>    <span class="hljs-keyword">try</span>:<br>        main()<br>    <span class="hljs-keyword">except</span> rospy.ROSInterruptException:<br>        <span class="hljs-keyword">pass</span><br></code></pre></td></tr></table></figure><h1 id="c">C++</h1><p>In C++, I think it is a good habit to use a <code>class</code> to represent a Ros node. Various publishers and subscribers are differnt class members in it. In its constuction funciton, all these publishers and subscribers will be initialized. The following codes show the whole procedure of work flow. (<strong>Similar to the first example above.</strong>)</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"ros/ros.h"</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;boost/thread.hpp&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"std_msgs/Float32.h"</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"customed_msg/Gps.h"</span></span><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">WorkNode</span></span><br><span class="hljs-class">&#123;</span><br><span class="hljs-keyword">public</span>:<br>  WorkNode()<br>  &#123;<br>  gpsSub = nh.subscribe(<span class="hljs-string">"gps"</span>, <span class="hljs-number">1</span> &amp;WokrNode::gpsSubCallback, <span class="hljs-keyword">this</span>);<br>  anglePub = nh.advertise&lt;std_msgs::Float32&gt;(<span class="hljs-string">"/angle"</span>, <span class="hljs-number">10</span>);<br>  &#125;;<br>  ~WorkNode();<br><br>  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">gpsSubCallback</span><span class="hljs-params">(<span class="hljs-keyword">const</span> customed_msg::Gps::ConstPtr&amp; gpsMsg)</span></span>;<br><br><span class="hljs-keyword">private</span>:<br>  ros::NodeHandle nh;<br>  ros::Subscriber gpsSub;<br>  ros::Publisher anglePub;<br>  std_msgs::Float32 angle;<br>&#125;;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">WorkNode::gpsSubcallback</span><span class="hljs-params">(<span class="hljs-keyword">const</span> customed_msg::Gps::ConstPtr &amp;gpsMsg)</span></span><br><span class="hljs-function"></span>&#123;<br># Do something here.<br>    <br>angle.data = <span class="hljs-number">10.0</span>;<br>anglePub.publish(angle);<br>&#125;;<br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>  ros::init(argc, argv, <span class="hljs-string">"work_node"</span>);<br><br>  WorkNode *workNode = <span class="hljs-keyword">new</span> WorkNode();<br><br>  <span class="hljs-function">ros::AsyncSpinner <span class="hljs-title">spinner</span><span class="hljs-params">(<span class="hljs-number">2</span>)</span></span>; <span class="hljs-comment">// Use 2 threads</span><br>  spinner.start();<br>  ros::waitForShutdown();<br><br>  <span class="hljs-keyword">delete</span> workNode;<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="references">References</h1><ul><li><a href="http://wiki.ros.org/ROS/Tutorials/WritingPublisherSubscriber%28c%2B%2B%29" target="_blank" rel="noopener">Writing a Simple Publisher and Subscriber (Python)</a></li><li><a href="http://wiki.ros.org/ROS/Tutorials/WritingPublisherSubscriber%28c%2B%2B%29" target="_blank" rel="noopener">Writing a Simple Publisher and Subscriber (C++)</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Robot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ROS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ackermann Geometrics and Pure Pursuit Algorithm</title>
      <link href="/2019/06/14/ackman-geometrics-and-pure-pursuit-algorithm/"/>
      <url>/2019/06/14/ackman-geometrics-and-pure-pursuit-algorithm/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><h1 id="ackermann-geometrics">Ackermann Geometrics</h1><p>如下图，车辆以固定的方向盘转角转弯时，实质为绕圆心在后轴延长线上，半径为 <span class="math inline">\(r\)</span> 的圆弧做圆周运动。</p><p><img src= "/img/loading.gif" data-lazy-src="https://i.imgur.com/V86UOKj.png" title="Ackman image"/></p><p>根据图内关系，可以推算出车辆前轴偏转角与圆心半径 <span class="math inline">\(r\)</span> 的关系, <span class="math inline">\(L\)</span>为车辆轴距。</p><p><span class="math display">\[\delta = arctan(\frac{L}{r})\]</span></p><h1 id="pure-pursuit-algorithm">Pure Pursuit Algorithm</h1><p>Pure Pursuit Algorithm 是一种车辆跟踪的简单算法，具体方法为根据车辆当前点与一系列的waypoints，与当前车辆距离合适的一个目标点，计算车辆从当前位置驾驶到目标点位置的期望轮胎转角。</p><p><img src= "/img/loading.gif" data-lazy-src="https://i.imgur.com/V86UOKj.png" title="Ackman image"/></p><p>由上图，以车辆后轴为圆心建立车辆坐标系，经过几何运算可以得到车辆圆周运动的圆弧曲率 <span class="math inline">\(\kappa\)</span> 与目标点位置的关系。</p><p><span class="math display">\[d = r-x \\(r-x)^2 + y^2 = r^2 \\r^2 - 2rx + x^2 + y^2 = r^2 \\2rx = l^2 \\r = \frac{l^2}{2x} \\\kappa = \frac{2x}{l^2}\]</span></p><p>Pure Pursuit 是一种很直观的算法，因此该算法的关键从 Tracking Path Points 中选取一个合理的目标点，目标点与车辆的距离用 <span class="math inline">\(l\)</span> (look ahead distance) 来表示。如果 <span class="math inline">\(l\)</span> 取值太小，则跟踪曲线会在实际路径附近来回振荡，如果 <span class="math inline">\(l\)</span> 取值太大，则会跟踪得太慢而影响跟踪效果。</p><p><img src= "/img/loading.gif" data-lazy-src="https://i.imgur.com/th59YZi.png" title="look ahead distance"/></p><h1 id="references">References</h1><ul><li><a href="https://en.wikipedia.org/wiki/Ackermann_steering_geometry" target="_blank" rel="noopener">Ackermann steering geometry</a></li><li><a href="https://www.ri.cmu.edu/pub_files/pub3/coulter_r_craig_1992_1/coulter_r_craig_1992_1.pdf" target="_blank" rel="noopener">Implementation of the Pure Pursuit Path Tracking Algorithm</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Study </category>
          
          <category> Autonomous Driving </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Use Customed Python Environment in ROS</title>
      <link href="/2019/06/14/ros-use-python3/"/>
      <url>/2019/06/14/ros-use-python3/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><h1 id="install-denpendent-packages">Install Denpendent Packages</h1><p>In ROS, if we use our special python environment under <code>conda</code> or <code>virtualenv</code> instead of the basic python environment, there will be something wrong when we use ROS package. This is because ROS packages cannot be found in our special environment. In order to resolve this problem, we need to install ROS packages in our python enviornment. Open a terminal and enter the following codes to install ROS dependencies.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ conda activate yourEnv<br>$ pip install catkin-tools<br>$ pip install rospkg<br></code></pre></td></tr></table></figure><h1 id="specify-the-python-interpreter">Specify the Python Interpreter</h1><p>In order to use our special environment, we have to assign the python interpreter in our python file. Add the following code on the first line of your python file.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#! /path/to/python3</span><br></code></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Robot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ROS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>data-visualization-through-matplotlib-1</title>
      <link href="/2019/06/12/data-visualization-through-matplotlib-1/"/>
      <url>/2019/06/12/data-visualization-through-matplotlib-1/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><h1 id="line-chart">Line Chart</h1><p>In order to show data dyanmically, it's necessary to use interactive mode of <strong>matplotlib</strong>. The following codes show a sine line dynamically.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">from</span> math <span class="hljs-keyword">import</span> *<br><br>count = <span class="hljs-number">0</span><br>time_list = []<br>data_list = []<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>:</span><br>    plt.ion()  <span class="hljs-comment"># Use interactive mode</span><br>    plt.figure(<span class="hljs-number">1</span>)<br><br>    <span class="hljs-keyword">for</span>:i range(<span class="hljs-number">2000</span>):<br>        plt.clf()  <span class="hljs-comment"># clear the canvas</span><br>        time_list.append(<span class="hljs-number">0.1</span> * i)<br>        data_list.append(sin(<span class="hljs-number">0.1</span> * i))<br>        plt.plot(time_list, data_list, <span class="hljs-string">'-r'</span>)<br>        plt.pause(<span class="hljs-number">0.01</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:<br>    main()<br></code></pre></td></tr></table></figure><h1 id="scatter-graph">Scatter Graph</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">from</span> math <span class="hljs-keyword">import</span> *<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>:</span><br>    plt.ion()  <span class="hljs-comment"># Use interactive mode</span><br>    plt.figure(<span class="hljs-number">1</span>)<br><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">2000</span>):<br>        plt.scatter(i * <span class="hljs-number">0.1</span>, sin(i * <span class="hljs-number">0.1</span>))<br>        plt.pause(<span class="hljs-number">0.01</span>)<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:<br>    main()<br></code></pre></td></tr></table></figure><h1 id="receive-and-show-data-from-ros-topic">Receive and Show Data from ROS Topic</h1><p>In my ROS project, I need to receive messages from topic and analyze them, so I write down the following codes to remind myself how to finish the whole procedure.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/env python</span><br><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><br><span class="hljs-keyword">import</span> rospy<br><span class="hljs-keyword">from</span> std_msgs.msg <span class="hljs-keyword">import</span> String, Float32<br><br><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">from</span> math <span class="hljs-keyword">import</span> *<br><br>count = <span class="hljs-number">0</span><br>angle_list = []<br>time_list = []<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">draw_angle_callback</span><span class="hljs-params">(angle)</span>:</span><br>    <span class="hljs-keyword">global</span> angle_list, count, time_list<br>    <br>    <span class="hljs-comment"># Pop history data</span><br>    <span class="hljs-keyword">if</span> len(angle_list) &gt; <span class="hljs-number">300</span>:<br>        angle_list.pop(<span class="hljs-number">0</span>)<br>        time_list.pop(<span class="hljs-number">0</span>)<br><br>    angle_list.append(angle.data)<br>    time_list.append(count)<br><br>    count += <span class="hljs-number">1</span><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>:</span><br>    <span class="hljs-comment"># Initialize a ros subscribe node</span><br>    rospy.init_node(<span class="hljs-string">"draw_steering_angle"</span>, anonymous=<span class="hljs-literal">True</span>)<br>    steering_angle_sub = rospy.Subscriber(<span class="hljs-string">"angle"</span>, Float32, draw_angle_callback)<br><br>    plt.ion()    <span class="hljs-comment"># Interacitve mode</span><br>    plt.figure(<span class="hljs-number">1</span>)<br><br>    <span class="hljs-keyword">while</span> <span class="hljs-keyword">not</span> rospy.is_shutdown():<br>        plt.clf()<br>        plt.ylim((<span class="hljs-number">-100</span>, <span class="hljs-number">100</span>))<br>        plt.plot(time_list, angle_list, <span class="hljs-string">'r'</span>,  linestyle=<span class="hljs-string">"--"</span>)<br>        plt.pause(<span class="hljs-number">0.01</span>)<br><br>    rospy.spin()<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:<br>    <span class="hljs-keyword">try</span>:<br>        main()<br>    <span class="hljs-keyword">except</span> rospy.ROSInterruptException:<br>        <span class="hljs-keyword">pass</span><br></code></pre></td></tr></table></figure><h1 id="references">References:</h1><ul><li><a href="https://blog.csdn.net/u013468614/article/details/58689735" target="_blank" rel="noopener">python中plot实现即时数据动态显示方法</a></li><li><a href="https://blog.csdn.net/u013180339/article/details/77002254" target="_blank" rel="noopener">Matplotlib 画动态图: animation模块的使用</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Programming </category>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> visualization </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Compute Distance and Angle between Two GPS Points</title>
      <link href="/2019/06/10/compute-distance-and-angle-between-two-gps-points/"/>
      <url>/2019/06/10/compute-distance-and-angle-between-two-gps-points/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><h1 id="背景知识">背景知识</h1><h2 id="经纬线的产生与定义">经纬线的产生与定义</h2><p>地球是一个椭球体，其赤道半径要比极半径更大。赤道半径 $ a = 6378.1730 km$ , 极半径 $ b = 6356.7523 km$ ，平均半径 $ R =  = 6371.0088km $ 。 经纬线则是人们为了清晰表达地球上任意一点而定义出来的辅助线。 纬线定义为地球表面某点随地球自转而形成的轨迹，因此纬线与赤道平行，其周长等于赤道的周长乘以纬线的维度的余弦。 经线定义为地球表面连接南北两极点的半圆弧，任意两经线长度相等，$ Length = 20003.93km$。</p><h2 id="经纬度的定义">经纬度的定义</h2><ul><li>经度：已知经线是连接两极点的圆弧，那么地球上任意一点的经度坐标等于：该点所在经线与地球圆心组成的平面与本初子五线平面的夹角的度数。</li><li>纬度：已知纬线是与赤道平行的圆弧，因此地球上任意一点的维度坐标等于：该点与球心连接的线段和投影在赤道平面组成的线段的夹角的度数。</li></ul><table><thead><tr class="header"><th style="text-align: center;">维度度量</th><th style="text-align: center;">相差距离</th></tr></thead><tbody><tr class="odd"><td style="text-align: center;">1°</td><td style="text-align: center;">111.13km</td></tr><tr class="even"><td style="text-align: center;">1'</td><td style="text-align: center;">1.85km</td></tr><tr class="odd"><td style="text-align: center;">1''</td><td style="text-align: center;">30.87km</td></tr><tr class="even"><td style="text-align: center;">0.1°</td><td style="text-align: center;">11.11km</td></tr><tr class="odd"><td style="text-align: center;">0.01°</td><td style="text-align: center;">1111.33m</td></tr></tbody></table><p>因此，如果想要距离误差达到米级的话，GPS的精度必须达到 <span class="math inline">\(0.00001°\)</span> 的范围。</p><h1 id="计算两点距离">计算两点距离</h1><p>目前使用较为广泛的根据GPS计算两点距离的模型为简化模型和球面模型，这两种模型都是对椭球体进行了一定程度的简化。</p><h2 id="简化模型">简化模型</h2><p>简化模型适用于两点距离较近的情形，同时越靠近极地效果越差。简化模型将球面简化为平面，认为经纬线互相垂直。如下图所示，求A，B两点的距离可以被分解为先求A，B两点的横向距离与纵向距离，再根据三角形定律求出A，B的距离。</p><div data-align="center"><p><img src= "/img/loading.gif" data-lazy-src="https://i.imgur.com/Oy9qej6.png" title="simplified image"/></p></div><h3 id="纵向距离">纵向距离</h3><p>A，B 两点的纵向距离即它们在经线上的差值，通过弧长公式 $ L = $ 分别求出 A，B 两点到赤道线的弧长然后相减即可得到它们的纵向距离。</p><p><span class="math display">\[\begin{align*} long_{AB} = \bar{R} * rad({\alpha}^A_{lat} - {\alpha}^B_{lat})\end{align*}\]</span></p><h3 id="横向距离">横向距离</h3><p>A, B 两点的横向距离的计算要纵向的复杂，这是因为纬线的长度随着纬度的增加而减少，所以计算出A，B的横向距离之后还需要乘以角度的余弦值。</p><p><span class="math display">\[\begin{align*} lat_{AB} = \bar{R} * cos({\alpha^{\bar{AB}}_{lat}}) * rad({\alpha}^A_{long} - {\alpha}^B_{long})\end{align*}\]</span></p><h3 id="实现代码c">实现代码(C++)</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;cmath&gt;</span></span><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> R 6378.137</span><br><br><span class="hljs-function"><span class="hljs-keyword">double</span> <span class="hljs-title">getDistance</span><span class="hljs-params">(<span class="hljs-keyword">double</span> lat1, <span class="hljs-keyword">double</span> lng1, <span class="hljs-keyword">double</span> lat2, <span class="hljs-keyword">double</span> lng2)</span></span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-keyword">double</span> lngDistance = R * rad(lat2 - lat1);<br><span class="hljs-keyword">double</span> avgLat = rad(lat1 + lat2) / <span class="hljs-number">2</span>;<br><span class="hljs-keyword">double</span> latDistance = R * <span class="hljs-built_in">cos</span>(avgLat) * rad(lng2 -lng1);<br><br><span class="hljs-keyword">return</span> <span class="hljs-built_in">sqrt</span>(lngDistance * lngDistance + latDistance * latDistance);<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="球面模型">球面模型</h2><p>原理推导过程比较麻烦，看参考1。</p><h3 id="实现代码c-1">实现代码(C++)</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;cmath&gt;</span></span><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PI 3.14926535</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> R 6378.137</span><br><br><span class="hljs-function"><span class="hljs-keyword">double</span> <span class="hljs-title">rad</span><span class="hljs-params">(<span class="hljs-keyword">double</span> x)</span></span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-keyword">return</span> x * PI / <span class="hljs-number">180.0</span>;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">double</span> <span class="hljs-title">getDistance</span><span class="hljs-params">(<span class="hljs-keyword">double</span> lat1, <span class="hljs-keyword">double</span> lng1, <span class="hljs-keyword">double</span> lat2, <span class="hljs-keyword">double</span> lng2)</span></span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-keyword">if</span> (lat1 == lat2 &amp;&amp; lng1 == lng2) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br><br><span class="hljs-keyword">double</span> havLat = <span class="hljs-built_in">sin</span>(rad(lat1 - lat2) / <span class="hljs-number">2</span>);<br><span class="hljs-keyword">double</span> havLng = <span class="hljs-built_in">sin</span>(rad(lng1 - lng2) / <span class="hljs-number">2</span>);<br><span class="hljs-keyword">double</span> a = havLat * havLat + <span class="hljs-built_in">cos</span>(rad(lat1)) * <span class="hljs-built_in">cos</span>(rad(lat2)) * havLng * havLng;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">* Simplified</span><br><span class="hljs-comment">* distance = 2 * R * asin(sqrt(a))</span><br><span class="hljs-comment">**/</span><br>distance = <span class="hljs-number">2</span> * R * <span class="hljs-built_in">atan2</span>(<span class="hljs-built_in">sqrt</span>(a), <span class="hljs-built_in">sqrt</span>(<span class="hljs-number">1</span> - a));<br><br><span class="hljs-keyword">return</span> distance;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="计算两点方位角">计算两点方位角</h1><p>A, B两点方位角的含义为：从A，B任一点的指北经线起，按照顺时针的方向旋转到另外一点，期间所转过的角度。可以简单理解为A，B两点连线与指北经线的夹角。 <div class="note info flat"><p>经纬度分正负，东经为正，西经为负；北纬为正，南纬为负。</p></div></p><h2 id="实现代码c-2">实现代码(C++)</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;cmath&gt;</span></span><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> PI 3.14926535</span><br><br><span class="hljs-function"><span class="hljs-keyword">double</span> <span class="hljs-title">rad</span><span class="hljs-params">(<span class="hljs-keyword">double</span> x)</span></span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-keyword">return</span> x * PI / <span class="hljs-number">180.0</span>;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">double</span> <span class="hljs-title">getAngle</span><span class="hljs-params">(<span class="hljs-keyword">double</span> lat1, <span class="hljs-keyword">double</span> lng1, <span class="hljs-keyword">double</span> lat2, <span class="hljs-keyword">double</span> lng2)</span></span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-keyword">if</span>(lat1 == lat2 &amp;&amp; lng1 == lng2)<br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br><br><span class="hljs-keyword">double</span> a = rad(lat1 - lat2);<br><span class="hljs-keyword">double</span> b = rad(lng1 - lng2) * <span class="hljs-built_in">cos</span>(rad(lat1));<br><span class="hljs-keyword">double</span> angle;<br><br><span class="hljs-keyword">if</span> (a == <span class="hljs-number">0</span>)<br>&#123;<br><span class="hljs-keyword">if</span>(b &gt; <span class="hljs-number">0</span>)  angle = PI / <span class="hljs-number">2</span>;<br><span class="hljs-keyword">else</span>  angle = -PI / <span class="hljs-number">2</span>;<br>&#125;<br><span class="hljs-keyword">else</span>  angle = <span class="hljs-built_in">atan</span>(b / a);<br><span class="hljs-keyword">if</span> (a &lt; <span class="hljs-number">0</span>)  angle += PI<br><br><span class="hljs-keyword">return</span> angle * <span class="hljs-number">180.0</span> / PI;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="将经纬点转到汽车坐标系下">将经纬点转到汽车坐标系下</h1><p>假设存在A，B两点，A点为车辆自身定位点，B点为车辆外的另外一点，已知A，B两点的经纬度，且知道车辆当前的航向角（航向角定义为车辆当前朝向与正北方向夹角。）根据前面的数据可以推算出B点在车辆坐标系下的位置。具体关系图如下：</p><div data-align="center"><p><img src= "/img/loading.gif" data-lazy-src="https://i.imgur.com/s0nCJGM.png" title="Vehicle coordinate image"/></p></div><p>如图，<span class="math inline">\({\delta}_1\)</span> 为A，B两点的夹角，可以由前面的方法计算得到，<span class="math inline">\({\delta}_2\)</span> 为车辆航向角，可以由GPS+IMU获取，B点在车辆坐标系下的 <span class="math inline">\(x\)</span> , <span class="math inline">\(y\)</span> 坐标为：</p><p><span class="math display">\[\begin{align*}  B_x = Dis_{AB} * cos({\delta}_2 - {\delta}_1 + 90) \\  A_x = Dis_{AB} * sin({\delta}_2 - {\delta}_1 + 90)\end{align*}\]</span></p><h2 id="实现代码c-3">实现代码(C++)</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;cmath&gt;</span></span><br><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">MapPoint</span></span><br><span class="hljs-class">&#123;</span><br><span class="hljs-keyword">double</span> x;<br><span class="hljs-keyword">double</span> y;<br>&#125;;<br><br><span class="hljs-function"><span class="hljs-keyword">double</span> <span class="hljs-title">gpsConvertMap</span><span class="hljs-params">(<span class="hljs-keyword">double</span> lat1, <span class="hljs-keyword">double</span> lng1, <span class="hljs-keyword">double</span> lat2, doulbe lng2, <span class="hljs-keyword">double</span> dir)</span></span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-keyword">double</span> angle = getAngle(lat1, lng1, lat2, lng2);<br><span class="hljs-keyword">double</span> radAngle = rad(dir - angle + <span class="hljs-number">90</span>);<br><span class="hljs-keyword">double</span> distance = getDistance(lat1, lng1, lat2, lng2);<br><br><br>MapPoint <span class="hljs-built_in">point</span>;<br><span class="hljs-built_in">point</span>.x = distance * <span class="hljs-built_in">cos</span>(radAngle);<br><span class="hljs-built_in">point</span>.y = distance * <span class="hljs-built_in">sin</span>(radAngle);<br><br><span class="hljs-keyword">return</span> <span class="hljs-built_in">point</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="参考">参考</h1><ul><li><a href="https://johnnyqian.net/blog/gps-locator/" target="_blank" rel="noopener">使用GPS坐标来计算距离和方位角</a></li><li><a href="https://blog.csdn.net/gatieme/article/details/45599581" target="_blank" rel="noopener">根据两点经纬度坐标计算距离</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Study </category>
          
          <category> Autonomous Driving </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Internal Netwrok Penetration</title>
      <link href="/2019/05/30/ineternal-network-penetration/"/>
      <url>/2019/05/30/ineternal-network-penetration/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><h1 id="dependencies">Dependencies</h1><ul><li>A computer in internal network environment</li><li>A server in public network environment(Own a public IP address)</li><li>A personal computer</li></ul><h1 id="principle">Principle</h1><p>Personal computer --&gt; Public Server --&gt; Interal computer</p><h1 id="procedure">Procedure</h1><ul><li>Open the 8086 port in of Public server. In <strong>Security Group</strong>, add a <em>Custom TCP Rule</em>(Protocol: TCP, Port: 8086)</li><li>Open a terminal in Public server, and import the following commands. <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo vim /etc/ssh/ssh_config<br><span class="hljs-comment"># Add the following line in it</span><br>GatewayPorts yes<br><span class="hljs-comment"># Import the following command</span><br>sudo systemctl restart ssh.service<br></code></pre></td></tr></table></figure></li><li>Open a terminal in the internal computer and import the following command. <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ssh -i /path/to/publicKey.gem -gfnNTR 0.0.0.0:8086:localhost:22 serverName@serverIP -o ServerAliveInterval=300<br></code></pre></td></tr></table></figure></li><li>Access the internal computer in the personal computer through <code>ssh internalName@serverIP -p 8086</code>.</li></ul><h1 id="autossh">Autossh</h1><ul><li>Sometimes ssh service is unstable and the conection will break off, so we can use <code>autossh</code> and <code>expect</code> to reconnect to server automatically. <code>autossh</code> provides a method to reconnect to the server and <code>expect</code> is responsible for entering password.</li><li>Install <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo apt-get install autossh<br>sudo apt-get install expect<br></code></pre></td></tr></table></figure></li><li>Create a new script <code>sshpass.sh</code> to connect to the server. <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br>HOST=<span class="hljs-string">"serverIP"</span><br>USER=<span class="hljs-string">"serverName"</span><br>PASS=<span class="hljs-string">"serverPassword"</span><br>CMD=<span class="hljs-variable">$@</span><br><br>VAR=$(expect -c <span class="hljs-string">"</span><br><span class="hljs-string">spawn /usr/bin/autossh -M 5555 -gnNTR 0.0.0.0:8086:localhost:22 <span class="hljs-variable">$USER</span>@<span class="hljs-variable">$HOST</span> <span class="hljs-variable">$CMD</span></span><br><span class="hljs-string">match_max 100000</span><br><span class="hljs-string">expect \"*?assword:*\"</span><br><span class="hljs-string">send -- \"<span class="hljs-variable">$PASS</span>\r\"</span><br><span class="hljs-string">send -- \"\r\"</span><br><span class="hljs-string">expect eof</span><br><span class="hljs-string">"</span>)<br><br><span class="hljs-built_in">echo</span> <span class="hljs-string">"================="</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$VAR</span>"</span><br></code></pre></td></tr></table></figure></li><li><code>-M</code> means autossh service monitor the connection status on port 5555, if the connection break off, it will reconnect to the server automatically.</li></ul><h1 id="execute-autossh-automatically">Execute autossh automatically</h1><ul><li>In order to run autossh service automatically when the computer boots, we add it in StartUP Service.</li><li>Use <code>chmod u+x sshpass.sh</code> to change its authority.</li><li>Use <code>sudo cp sshpass.sh /etc/init.d</code> to cp the script to /etc/init.d folder.</li><li><code>cd /etc/init.d</code> and run <code>sudo update-rc.d sshpass.sh defaults 90</code> to add this script in StartUP Service.</li><li>If we would like to remove this script from StartUP Service, just run the command <code>sudo update-rc.d f sshpass.sh remove</code></li></ul><h1 id="references">References</h1><ul><li><a href="https://blog.csdn.net/quantumenergy/article/details/78244003" target="_blank" rel="noopener">ssh内网穿透</a></li><li><a href="https://www.linuxidc.com/Linux/2017-09/147166.htm" target="_blank" rel="noopener">Ubuntu 16.04设置rc.local开机启动命令/脚本的方法</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Network </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ros Qt Install and Configuration on Ubuntu</title>
      <link href="/2019/05/23/ros-qt-install-on-ubuntu/"/>
      <url>/2019/05/23/ros-qt-install-on-ubuntu/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><h1 id="download-and-install">Download and Install</h1><ul><li><p>Dependencies: Qt depends on C/C++. Meanwhile, Qt's 3D interface depends on OpenGL lib. Therefore, <strong>gcc/g++ complier</strong> and <strong>OpenGL lib</strong> are required. Open a terminal and enter the following commands so that these dependencies will be installed. <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ sudo apt-get install mesa-common-dev<br>$ sudo apt-get install ligblul-mesa-dev -y<br></code></pre></td></tr></table></figure></p></li><li><p>Download: Download the <code>.run</code> file in your required version.</p><ul><li><a href="https://www.qt.io/download" target="_blank" rel="noopener">Official download link</a></li><li><a href="http://download.qt.io/archive/qt/" target="_blank" rel="noopener">Mirror download link</a></li></ul></li><li><p>Install: Go into the download folder, open a terminal and enter the following command. After that, a GUi Setup interface will be opened. Choose your expected path and just click <em>next</em>, Qt5 will be installed automatically. <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ chmod +x qt-opensource-linux-x64-5.x.x.run<br>$ ./qt-opensource-linux-x64-5.x.x.run<br></code></pre></td></tr></table></figure></p></li></ul><h1 id="configure-environment-path">Configure Environment Path</h1><p>Add Qt5 path to environment path so that we can use it to complie our projects.</p><ol type="1"><li><p>open ~/.bashrc in the terminal and add the following commands. <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">export</span> QTDIR=/install/path/QT5/5.x.x/gcc64<span class="hljs-variable">$QTDIR</span><br><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$QTDIR</span>/bin:<span class="hljs-variable">$PATH</span><br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=<span class="hljs-variable">$QTDIR</span>/lib:<span class="hljs-variable">$LD_LIBRARY_PATH</span><br><span class="hljs-built_in">export</span> PATH=/install/path/QT5/Tools/QtCreator/bin:<span class="hljs-variable">$PATH</span><br></code></pre></td></tr></table></figure></p></li><li><p>Open <strong>qtcreater</strong> by terminal each time.</p></li></ol><h1 id="configure-ros-workspace">Configure ROS Workspace</h1><ul><li><p>Install <strong>qt-ros-plugin</strong>: <a href="https://ros-qtc-plugin.readthedocs.io/en/latest/_source/How-to-Install-Users.html" target="_blank" rel="noopener">Download link</a>: Download the Xenial Offline Installer and execute it to open the GUI Setup interface.</p></li><li><p>Execute <strong>qt-ros-plugin</strong>: open a terminal and enter the following command. <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ qtcreator-ros<br></code></pre></td></tr></table></figure></p></li><li><p>Create a ROS node with GUI</p><ul><li>Create Workspace Open <em>qtcreator-ros</em> and click <strong>New Project</strong> <img src= "/img/loading.gif" data-lazy-src="https://i.imgur.com/IuEmubt.png" title="Create Workspace" width="438" height="273" /><br/> Choose Workspace name and its path.<br/> <img src= "/img/loading.gif" data-lazy-src="https://i.imgur.com/UN4PSXO.png" title="source: imgur.com" width="438" height="273" /><br/> Finally, we will get this file structure.<br/> <a href="https://imgur.com/BSR8sSx" target="_blank" rel="noopener"><img src= "/img/loading.gif" data-lazy-src="https://i.imgur.com/BSR8sSx.png" title="source: imgur.com" /></a></li><li>Create Package<ul><li>Qt4 Use <em>qt_ros</em> tool, go into the <strong>src</strong> folder and enter the following commands in terminal to install and create qt package. After execute these commands, a package will be created and its CMakelist.txt contains commands that use Qt4. <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ sudo apt-get install ros-kinetic-qt-ros<br>$ catkin_create_qt_pkg<br></code></pre></td></tr></table></figure></li><li>Qt5<ul><li>Use <em>qt_ros</em> tool to create package as Qt4, and then change its CMakelist.txt</li><li>Modify <strong>CMakelist.txt</strong> Change the CMakelist.txt contents as followed. <figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><code class="hljs cmake"><span class="hljs-keyword">CMAKE_MINIMUM_REQUIRED</span>(VERSION <span class="hljs-number">2.8</span>.<span class="hljs-number">11</span>)<br><span class="hljs-keyword">PROJECT</span>(<span class="hljs-keyword">test</span>)<br><br><span class="hljs-keyword">SET</span>(CMAKE_INCLUDE_CURRENT_DIR <span class="hljs-keyword">ON</span>)<br><br><span class="hljs-comment">## Compile as C++11, supported in ROS Kinetic and newer</span><br><span class="hljs-keyword">add_compile_options</span>(-std=c++<span class="hljs-number">11</span>)<br><br><span class="hljs-comment">## Find catkin macros and libraries</span><br><span class="hljs-keyword">find_package</span>(catkin REQUIRED COMPONENTS<br>roscpp<br>)<br><br><span class="hljs-comment">###################################</span><br><span class="hljs-comment">## catkin specific configuration ##</span><br><span class="hljs-comment">###################################</span><br>catkin_package(<br><span class="hljs-comment">#  INCLUDE_DIRS include</span><br><span class="hljs-comment">#  LIBRARIES gacui</span><br><span class="hljs-comment">#  CATKIN_DEPENDS roscpp message_runtime</span><br><span class="hljs-comment">#  DEPENDS system_lib</span><br>)<br><br><span class="hljs-comment">##############################################################################</span><br><span class="hljs-comment"># Qt Environment</span><br><span class="hljs-comment">##############################################################################</span><br><span class="hljs-keyword">find_package</span>(Qt5 REQUIRED COMPONENTS<br>    Widgets<br>    WebEngineWidgets<br>    )<br><br><span class="hljs-comment">##############################################################################</span><br><span class="hljs-comment"># Sections and Resources</span><br><span class="hljs-comment">##############################################################################</span><br><br><span class="hljs-comment"># Rename Path</span><br><span class="hljs-keyword">file</span>(GLOB QT_FORMS RELATIVE <span class="hljs-variable">$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;</span> ui/*.ui)<br><span class="hljs-keyword">file</span>(GLOB QT_RESOURCES RELATIVE <span class="hljs-variable">$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;</span> resources/*.qrc)<br><span class="hljs-keyword">file</span>(GLOB_RECURSE QT_MOC RELATIVE <span class="hljs-variable">$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;</span> FOLLOW_SYMLINKS <span class="hljs-keyword">include</span>/gacui/*.h)<br><br>QT5_ADD_RESOURCES(QT_RESOURCES_CPP <span class="hljs-variable">$&#123;QT_RESOURCES&#125;</span>)<br>QT5_WRAP_UI(QT_FORMS_HPP <span class="hljs-variable">$&#123;QT_FORMS&#125;</span>)<br><span class="hljs-keyword">QT5_WRAP_CPP</span>(QT_MOC_HPP <span class="hljs-variable">$&#123;QT_MOC&#125;</span>)<br><br><br><span class="hljs-comment">##############################################################################</span><br><span class="hljs-comment"># Sources</span><br><span class="hljs-comment">##############################################################################</span><br><br><span class="hljs-keyword">file</span>(GLOB_RECURSE QT_SOURCES RELATIVE <span class="hljs-variable">$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;</span> FOLLOW_SYMLINKS src/*.cpp)<br><br><span class="hljs-comment">###########</span><br><span class="hljs-comment">## Build ##</span><br><span class="hljs-comment">###########</span><br><br><span class="hljs-comment">## Specify additional locations of header files</span><br><span class="hljs-keyword">INCLUDE_DIRECTORIES</span>(<br><span class="hljs-comment"># include</span><br><span class="hljs-variable">$&#123;catkin_INCLUDE_DIRS&#125;</span><br>)<br><br><span class="hljs-comment">## Add cmake target dependencies of the library</span><br><span class="hljs-comment"># add_dependencies($&#123;PROJECT_NAME&#125; $&#123;$&#123;PROJECT_NAME&#125;_EXPORTED_TARGETS&#125; $&#123;catkin_EXPORTED_TARGETS&#125;)</span><br><br><span class="hljs-comment">## Declare a C++ executable</span><br><span class="hljs-keyword">ADD_EXECUTABLE</span>(<span class="hljs-variable">$&#123;PROJECT_NAME&#125;</span>_node <span class="hljs-variable">$&#123;QT_SOURCES&#125;</span> <span class="hljs-variable">$&#123;QT_RESOURCES_CPP&#125;</span> <span class="hljs-variable">$&#123;QT_FORMS_HPP&#125;</span> <span class="hljs-variable">$&#123;QT_MOC_HPP&#125;</span>)<br><span class="hljs-keyword">ADD_DEPENDENCIES</span>(<span class="hljs-variable">$&#123;PROJECT_NAME&#125;</span>_node <span class="hljs-variable">$&#123;$&#123;PROJECT_NAME&#125;</span>_EXPORTED_TARGETS&#125; <span class="hljs-variable">$&#123;catkin_EXPORTED_TARGETS&#125;</span>)<br><span class="hljs-keyword">TARGET_LINK_LIBRARIES</span>(<span class="hljs-variable">$&#123;PROJECT_NAME&#125;</span>_node<br><span class="hljs-variable">$&#123;catkin_LIBRARIES&#125;</span><br>)<br><br><span class="hljs-keyword">qt5_use_modules</span>(<span class="hljs-variable">$&#123;PROJECT_NAME&#125;</span>_node Widgets WebEngine WebEngineWidgets)<br></code></pre></td></tr></table></figure></li></ul></li></ul></li><li>Compile package Open a terminal in root folder of workspace and then execute the following command. <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ catkin_make<br></code></pre></td></tr></table></figure></li></ul></li></ul><h1 id="install-qt-on-px2-or-tx2-platform">Install Qt on PX2 or TX2 Platform</h1><p>Because PX2 or TX2 use different CPU framework(Arm64) from PC(i386), another install package is necessary to install on these platforms. <strong>levi-armstrong</strong> has provided a useful ppa repository for Ubuntu on Arm64 framework, so that we can use this repository to install Qt conveniently.</p><p>Use the following commands to install: <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo add-apt-repository ppa:levi-armstrong/qt-libraries-xenial<br>sudo add-apt-repository ppa:levi-armstrong/ppa<br>sudo apt-get update<br>sudo apt install qt59creator<br><span class="hljs-comment"># install qt-creator-plugin-ros(optional)</span><br>sudo apt-get install qt57creator-plugin-ros<br></code></pre></td></tr></table></figure> After installing Qt by the previous commands, a folder named <code>qt59</code> can be found at <code>/opt/</code>. In order to use it, it's necessary to add this directory to <strong>ENV PATH</strong>. <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">export</span> PATH=/opt/qt59/bin:<span class="hljs-variable">$PATH</span><br><span class="hljs-built_in">export</span> LD_LIBRARY_PATH=/opt/qt59/lib:<span class="hljs-variable">$LD_LIBRARY_PATH</span><br></code></pre></td></tr></table></figure></p><h1 id="references">References</h1><ul><li><a href="https://www.cnblogs.com/zengcv/p/6378799.html" target="_blank" rel="noopener">Ubuntu下ROS开发环境搭建(QT+ros_qtc_plugin)</a><br /></li><li><a href="https://github.com/ros-industrial/ros_qtc_plugin" target="_blank" rel="noopener">ros-qtc-plugin</a></li><li><a href="https://blog.csdn.net/u013453604/article/details/52167213" target="_blank" rel="noopener">如何用Qt对ROS项目进行调试及创建GUI界面</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Robot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ROS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Two Classes Call each other (C++)</title>
      <link href="/2019/05/22/cplusplus-two-classes-call-each-other/"/>
      <url>/2019/05/22/cplusplus-two-classes-call-each-other/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><script class="meting-secondary-script-marker" src="/assets/js/Meting.min.js"></script><h1 id="两个对象互相访问成员函数及成员变量">两个对象互相访问成员函数及成员变量</h1><h2 id="头文件">头文件</h2><p>父类的头文件应当 include 子类的头文件，同时声明指向子类的指针。</p><p><code>Parent.h</code></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"Son.h"</span></span><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Parent</span></span><br><span class="hljs-class">&#123;</span><br><span class="hljs-keyword">public</span>:<br>    Parent();<br>    ~Parent();<br><br>    Son* sonPtr;     <span class="hljs-comment">// 声明指向子对象的指针</span><br><br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-keyword">int</span> a;<br>&#125;<br></code></pre></td></tr></table></figure><p>在C++中，如果两个头文件互相调用，将会发生循环检测引用的编译错误。为了避免编译错误，在子类的头文件中，<strong><font size="4">不应该</font></strong> include 父类的头文件，而是直接声明父类。</p><p><code>Son.h</code></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs c++"><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Parent</span>;</span><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Son</span></span><br><span class="hljs-class">&#123;</span><br><span class="hljs-keyword">public</span>:<br>    Son(Parent* ptr);<br>    ~Son();<br><br>    Parent* parentPtr;  <span class="hljs-comment">// 声明指向父类的指针</span><br><br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">getParentA</span><span class="hljs-params">()</span></span>;   <span class="hljs-comment">// 声明获取父类成员变量的函数</span><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="源文件">源文件</h2><p>父类的源文件应当包含其自身的头文件, 可以在构造函数中生成子类的对象，将该对象的地址赋值给指针sonPtr。</p><p><code>Parent.cpp</code></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"Parent.h"</span></span><br><br>Parent::Parent()<br>&#123;<br>    sonPtr = <span class="hljs-keyword">new</span> Son(<span class="hljs-keyword">this</span>);   <span class="hljs-comment">// 初始化父对象的同时，初始化子对象，并将父对象的指针存放到子对象中</span><br>    a = <span class="hljs-number">10</span>;<br>&#125;<br><br>Parent::~Parent()<br>&#123;<br>    <span class="hljs-keyword">delete</span> sonPtr;<br>&#125;<br></code></pre></td></tr></table></figure><p>子类的源文件中应当包含<strong>父类的头文件</strong>，而不是包含自身的头文件，否则会发生编译错误。</p><p><code>Son.cpp</code></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"Parent.h"</span></span><br><br>Son::Son(Parent* ptr)<br>&#123;<br>     parentPtr = ptr;      <span class="hljs-comment">// 构造子对象时，将父对象的指针保存</span><br>&#125;<br><br>Son::~Son() &#123;&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">Son::getParentA</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">return</span> parentPtr-&gt;a;   <span class="hljs-comment">// 通过指向父类对象的指针获取到父对象内的成员变量a</span><br>&#125;<br></code></pre></td></tr></table></figure><h1 id="references">References</h1><ul><li><a href="https://blog.csdn.net/qq_27278957/article/details/77967672" target="_blank" rel="noopener">C++ 两个包含类互相调用彼此的类成员变量和方法</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Programming </category>
          
          <category> C++ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> OOP </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
